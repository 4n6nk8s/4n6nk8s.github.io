{
    "version": "https://jsonfeed.org/version/1",
    "title": "4n6 & k8s • All posts by \"writeups\" category",
    "description": "We are a Forensics Duo at SOter14 CTF Team & Network Engineering Students at INSAT. Enjoy our Kubernetes Articles and Write-ups!",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2023/08/06/Writeups/quals23/",
            "url": "http://example.com/2023/08/06/Writeups/quals23/",
            "title": "Securinets Quals CTF 23 Forensics & Misc Challenges Writeup",
            "date_published": "2023-08-06T18:00:00.000Z",
            "content_html": "<h2 id=\"the-ctf\"><a class=\"markdownIt-Anchor\" href=\"#the-ctf\">#</a> The CTF</h2>\n<p>Securinets Quals CTF was this Securinets generation’s first CTF event on CTFTime where all the big teams have demonstrated therir skills to get to the finals in Tunisia this late-September.</p>\n<p>We present four challenging tasks, two forensics involving Containerization and Kubernetes, Hiberfil.sys, Restore Point, and Crypto-currency Wallet, and two Misc involving Steganography and Reverse Engineering a set-top-box firmware and analyzing its memory dump.</p>\n<p>Congratulations to SKSD, r3kapig, Hexagon for earning the top 3 spots in the CTF, and we deliver a special apperciation to the Securinets masterminds for their hard work and dedication to make this event a huge success, and we hope to see you all in the finals.</p>\n<p>Scoreboard:</p>\n<p><img data-src=\"https://i.imgur.com/eYBMvzh.jpg\" alt=\"\"></p>\n<h2 id=\"the-betrayers\"><a class=\"markdownIt-Anchor\" href=\"#the-betrayers\">#</a> The Betrayers</h2>\n<p><img data-src=\"https://i.imgur.com/lAWQkqM.png\" alt=\"\"></p>\n<h3 id=\"description\"><a class=\"markdownIt-Anchor\" href=\"#description\">#</a> Description:</h3>\n<p>An IT company provides a critical service to customers. One day, the service is attacked by DDoS. The Attack is originated from within the company’s internal network, and that each compromised host was sending a large number of requests to the server.</p>\n<p>The attack occurred shortly after the company installed a new patch to one of its software programs. Every new version should be hosted by a special web server with DNS record in the private network but this time the new version is hosted by the Technical Director server!!!</p>\n<p>The Technical Director is in trouble and he said that is not the attacker!</p>\n<p>The strange thing is that the program is deleted directly after the blue team figure out the attack!</p>\n<p>We need to get a release from that version and figure out how the attack occur!</p>\n<blockquote>\n<p>The binary expect to do DDoS attack on specifc IP. In this challenge we changed the IP and the rate of send requests</p>\n</blockquote>\n<p>Author: <strong>Raf²</strong></p>\n<p>File: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xUU5VbmQ0Q0VYWHJxQUM5Y252bFVFLUFXLWFlV0RzemQvdmlldz91c3A9c2hhcmluZw==\">Download</span></p>\n<h3 id=\"write-up\"><a class=\"markdownIt-Anchor\" href=\"#write-up\">#</a> Write-up</h3>\n<p>Ok Let’s figure out what is happen. We get the disk image of the Technical Director system. The system that host the new program patch. (It must not be this one)</p>\n<p>Let’s start figure out what softwares are installed and check the history of the system.</p>\n<p>Oh as expected there is a mail software. It’s thunderbird. We will check it later.<br>\n<img data-src=\"https://i.imgur.com/y6i9bfK.png\" alt=\"\"></p>\n<p>Let’s Check the browsing history of the system and check what is going on here! We found Edge only here!</p>\n<p>Go to  <code>C:\\Users\\Kong Office\\AppData\\Local\\Edge\\UserData\\Default</code>  and check the  <code>History</code>  database</p>\n<p><img data-src=\"https://i.imgur.com/E1oNXEo.png\" alt=\"\"></p>\n<p>After checking every single link and search. we found searchs about whatsapp desktop how to install it and official whatsapp download website is visited.</p>\n<p><img data-src=\"https://i.imgur.com/geAQL42.png\" alt=\"\"></p>\n<p>Thunderbird is installed for sure. But still no clue for whatsapp for now. Let’s see what we have on the inbox now! It’s time to check the mails! To check the inbox you can go to  <code>C:\\Users\\Kong Office\\AppData\\Roaming\\Thunderbird\\Profiles\\0ppw4tlt.default-release\\ImapMail\\imap.gmail.com</code>  and investigate the  <code>INBOX</code>  file</p>\n<p><img data-src=\"https://i.imgur.com/1J4A8Bx.png\" alt=\"\"></p>\n<p>You can open the file using any text editor to check the mails but it’s the worst way. you’ll find the attachements encoded to base 64 and many trashy details</p>\n<p>You’ll get an ugly view like this if you open it with vscode.<br>\n<img data-src=\"https://i.imgur.com/bH5fHr5.png\" alt=\"\"></p>\n<p>But you can choose any thunderbird inbox viewer available in the internet. I tried a random one and i got a better exeperience to understand what happen.</p>\n<p><img data-src=\"https://i.imgur.com/6T7zVMC.png\" alt=\"\"></p>\n<p>Let’s summerize what we found. One mail telling that the kubernetes cluster is updgraded successfully from the platform engineer, another one from a system adminstration telling the Technical Director about the security updates. Another one from  <code>Securinets INSAT</code>  asking for sponsorship to the National Cyber Security Congress! And the suspicision one is from a dummy mail  <code>4n6nk8s@gmail.com</code> . In this mail we found a clue!<br>\nA stranger tell the Technical Director about deploying a malicious binary and send a mega link! Ahhh Protected one</p>\n<p><img data-src=\"https://i.imgur.com/zalrPXh.png\" alt=\"\"></p>\n<p>The link lead you to a wordlist that have strong and secure passwords. The mail talks about subsystem!! What a subsystem? Is it a  <code>WSL</code>  ??</p>\n<p><img data-src=\"https://i.imgur.com/1Sfnhxu.png\" alt=\"\"></p>\n<p>and here we finished mail browser history and mail investigation. still the whatsapp thing! Where is whatsapp hide his data?? good question. Checking AppData don’t help us. We didn’t find any WhatsApp directory!</p>\n<p>After googling we found that there is some whatsapp version can store his data inside  <code>%AppData%\\Local\\Packages</code> . Let’s check that folder and Bingoo!! We found whatsapp directory! WhatsApp was installed here! Let’s see what we can do here!</p>\n<p><img data-src=\"https://i.imgur.com/4x79Dni.png\" alt=\"\"></p>\n<p>You can find some conversation inside  <code>messages.db</code>  file. It might be encrypted and it might be decrypted. Let’s try to open this database and see what we can find here!</p>\n<p><img data-src=\"https://i.imgur.com/mfM1duI.png\" alt=\"\"></p>\n<p>I am chocked!! Two employees were behind all this!!<br>\nTwo employees hate the director and they want to be in a trouble!</p>\n<p>The attackers talks about encryption and subsystem password and they are shocked because the system is windows! and yes the mega decryption key is shared in this discussion. They send the mail to the director to make it in trouble!!</p>\n<p><img data-src=\"https://i.imgur.com/8ATiHDP.png\" alt=\"\"></p>\n<p>Let’s download that wordlist and check the powershell history commands! I am sure there is something there. Because I found Hyber-V directory in random place while investigating. The history is stored in  <code>%userprofile%\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history. txt</code></p>\n<p><img data-src=\"https://i.imgur.com/GnecotB.png\" alt=\"\"></p>\n<p>Yeah! Everything is cleared now! subsytem, subsystem! They are talking about WSL. WSL is installed here! and it used to host the malicious program! But what they does mean by encryption and the password. Mmmmm I guess we will face some cracking in the few next minutes!</p>\n<p>Let’s check WSL now! Where is windows store the WSL? Just check  <code>%userprofile%\\AppData\\Local\\Packages</code></p>\n<p><img data-src=\"https://i.imgur.com/wIfONXj.png\" alt=\"\"></p>\n<p>Let’s mount this vhdx disk now in our Linux/WSL and check the files in this system. You can use  <code>libguestfs-tools</code>  to achieve this.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s:~$ sudo apt-get install libguestfs-tools</span><br></pre></td></tr></table></figure>\n<p>Then, you can mount now the wsl disk image:<br>\n<img data-src=\"https://i.imgur.com/0QqjpLl.png\" alt=\"\"></p>\n<p>We found a user named  <code>Kong</code>  and have a home directory. Let’s check his files and bash history!</p>\n<p><img data-src=\"https://i.imgur.com/W7p1CnE.png\" alt=\"\"></p>\n<p>Let’s start with  <code>.bash_history</code>  first. It’s my number one rule!<br>\n<img data-src=\"https://i.imgur.com/7kXO7nj.png\" alt=\"\"></p>\n<p>Wow! The attacker configure wsl.conf then install docker! Mmm He configure it to be boot with systemd!<br>\nThen he installed something called kind, After that he download  <code>kubectl</code> ! Kubectl??? Ah It’s  <code>Kubernetes</code>  time!</p>\n<p>But what is kind? Searching on it. I found that kind is Kubernetes inside Docker. It’s a lightweight kubernetes cluster.</p>\n<p>There is 3 yaml files. For sure there are worth to check! Let’s see what is inside these files!</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### k-config.yaml content ####</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Cluster</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kind.x-k8s.io/v1alpha4</span></span><br><span class=\"line\"><span class=\"attr\">networking:</span></span><br><span class=\"line\">  <span class=\"attr\">podSubnet:</span> <span class=\"string\">&quot;10.244.0.0/16&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">serviceSubnet:</span> <span class=\"string\">&quot;10.96.0.0/12&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># the default CNI will not be installed</span></span><br><span class=\"line\">  <span class=\"attr\">disableDefaultCNI:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">           </span><br><span class=\"line\"><span class=\"attr\">nodes:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">role:</span> <span class=\"string\">control-plane</span></span><br><span class=\"line\">  <span class=\"comment\"># add a mount from /path/to/my/files on the host to /files on the node</span></span><br><span class=\"line\">  <span class=\"attr\">extraMounts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span> <span class=\"string\">/etc/crio/crio.conf</span></span><br><span class=\"line\">    <span class=\"attr\">containerPath:</span> <span class=\"string\">/etc/crio/crio.conf</span></span><br><span class=\"line\">    <span class=\"comment\"># optional: if set, the mount is read-only.</span></span><br><span class=\"line\">    <span class=\"comment\"># default false</span></span><br><span class=\"line\">    <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\"># default false</span></span><br><span class=\"line\">    <span class=\"attr\">selinuxRelabel:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span> <span class=\"string\">/etc/kubernetes</span></span><br><span class=\"line\">    <span class=\"attr\">containerPath:</span> <span class=\"string\">/etc/kubernetes</span></span><br><span class=\"line\">    <span class=\"comment\"># optional: if set, the mount is read-only.</span></span><br><span class=\"line\">    <span class=\"comment\"># default false</span></span><br><span class=\"line\">    <span class=\"attr\">readOnly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\"># default false</span></span><br><span class=\"line\">    <span class=\"attr\">selinuxRelabel:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span> <span class=\"string\">/var/lib/netcd</span></span><br><span class=\"line\">    <span class=\"attr\">containerPath:</span> <span class=\"string\">/var/lib/etcd</span></span><br><span class=\"line\">    <span class=\"comment\"># optional: if set, the mount is read-only.</span></span><br><span class=\"line\">    <span class=\"comment\"># default false</span></span><br><span class=\"line\">    <span class=\"attr\">readOnly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\"># default false</span></span><br><span class=\"line\">    <span class=\"attr\">selinuxRelabel:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">role:</span> <span class=\"string\">worker</span></span><br><span class=\"line\">  <span class=\"attr\">kubeadmConfigPatches:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    kind: JoinConfiguration</span></span><br><span class=\"line\"><span class=\"string\">    nodeRegistration:</span></span><br><span class=\"line\"><span class=\"string\">      kubeletExtraArgs:</span></span><br><span class=\"line\"><span class=\"string\">        node-labels: &quot;app-type=web-app&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>  <span class=\"attr\">extraPortMappings:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">30999</span></span><br><span class=\"line\">    <span class=\"attr\">hostPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"comment\"># optional: set the bind address on the host</span></span><br><span class=\"line\">    <span class=\"comment\"># 0.0.0.0 is the current default</span></span><br><span class=\"line\">    <span class=\"attr\">listenAddress:</span> <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># optional: set the protocol to one of TCP, UDP, SCTP.</span></span><br><span class=\"line\">    <span class=\"comment\"># TCP is the default</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br></pre></td></tr></table></figure>\n<p>It’s a kind cluster configuration file!! This fiel is used to declare the specification of your cluster! And as you see  <code>/etc/kubernetes</code>  and  <code>/var/lib/etcd</code>  are mounted. We have 2-node cluster and a  <code>extraPortMappings</code>  to expose a service. In addition there is node-labels on the worker-node</p>\n<blockquote>\n<p>This challenge requires some kubernetes knowledge. You must be familiar with the basics of the kubernetes. Like nodes, deployements, pods, services, etc…</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### content deploy.yaml ###</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">creationTimestamp:</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">update-app</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">update-app</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">update-app</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span> &#123;&#125;</span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">creationTimestamp:</span> <span class=\"literal\">null</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">update-app</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">imagePullSecrets:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">regcred</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">medrafk8s/kubersex</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">update-app</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">&quot;64Mi&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;250m&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">limits:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">&quot;128Mi&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;500m&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">            <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">                <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">                    <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app-type</span></span><br><span class=\"line\">                      <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                      <span class=\"attr\">values:</span></span><br><span class=\"line\">                      <span class=\"bullet\">-</span> <span class=\"string\">web-app</span></span><br><span class=\"line\">                      <span class=\"bullet\">-</span> <span class=\"string\">front-end</span></span><br><span class=\"line\"><span class=\"attr\">status:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>This is a deployment manifest that pull a private image  <code>medrafk8s/kubersex</code>  using the imagePullSecrets fields! The nodeAffinity is used for some scheduling specification. In this example the deployment will be deployed in node with labels  <code>app-type=web-app</code></p>\n<p>Let’s summerize now! The attacker installed Kind to deploy the web app that hosts the malicious inside a kubernetes cluster!</p>\n<p>So our objective is to recover the webapp that contains the malicious binary! But how can we restore that container! It’s a private container! What we should to do?</p>\n<p>To get the private container we need to get the pull secret. The credential that allow us to pull the container image! The credential are stored inside a  <code>secret</code>  (Kubernetes Object).</p>\n<p>According to the bash history we have this commands:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">USER=XXXXXXXXXXXXXXXXXXXX</span><br><span class=\"line\">PASSWORD=XXXXXXXXXXXXXXXXXXX</span><br><span class=\"line\">SERVER=XXXXXXXXXXXXXXXXXX</span><br><span class=\"line\">kubectl create secret docker-registry regcred --docker-server=<span class=\"variable\">$SERVER</span> --docker-username=<span class=\"variable\">$USER</span> --docker-password=<span class=\"variable\">$PASSWORD</span></span><br><span class=\"line\">kubectl get secrets</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>The attacker store the credential inside environement and create a pull secret using  <code>kubectl</code>  command</p>\n</blockquote>\n<p>The only way to get the credential is to extract the secret from the  <code>etcd</code> . But We have a problem! The etcd is protected!</p>\n<p>Let’s Back to the bash history you’ll find that the attacker edit a  <code>kube-apiserver.yaml</code>  and  <code>enc.yaml</code> .</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### enc.yaml ###</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiserver.config.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">EncryptionConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">secrets</span></span><br><span class=\"line\">    <span class=\"attr\">providers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">identity:</span> &#123;&#125;</span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">secretbox:</span></span><br><span class=\"line\">          <span class=\"attr\">keys:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">key1</span></span><br><span class=\"line\">              <span class=\"attr\">secret:</span> <span class=\"string\">&lt;BASE64</span> <span class=\"string\">ENCODED&gt;</span></span><br></pre></td></tr></table></figure>\n<p>Let’s talk a little about the  <code>Encryption Configuration</code>  in Kubernetes.</p>\n<p><img data-src=\"./images/https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg\" alt=\"\"></p>\n<p>As known. Etcd is a distributed key-value store that is used by Kubernetes to store and retrieve the configuration data for the cluster. The Kubernetes API server interacts with etcd to read and write configuration data, such as the current state of the cluster and the desired state. The etcd data store serves as the single source of truth for the Kubernetes cluster’s configuration data, and the API server ensures that this data is always up to date and consistent across the cluster.</p>\n<p>The API server accepts an argument  <code>--encryption-provider-config</code>  that controls how API data is encrypted in etcd. In other words, API server can store the data inside etcd but not in plain text! It’s encrypted to secure the data inside the database! for more details check this <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL2RvY3MvdGFza3MvYWRtaW5pc3Rlci1jbHVzdGVyL2VuY3J5cHQtZGF0YS8=\">link</span></p>\n<p>So our mission now is to find the secret value of the  <code>EncryptionConfiguration</code>  to use it after restoring the etcd by setting up a new api server that can read the encrypted data from the  <code>etcd</code> .</p>\n<p><img data-src=\"https://i.imgur.com/XEB64Su.png\" alt=\"\"></p>\n<p>Getting back to the whatsapp discussion. The attacker use the same password for the encryption key and subsystem password!</p>\n<p>Bingo!! Crack time! We know that the encryption key must be 32 bytes. So this information will help us filtering the downloaded wordlist!</p>\n<p>Linux stores user passwords hashes in  <code>/etc/shadow</code> . Great, we have the hash and the wordlist! Let’s do it!</p>\n<p><img data-src=\"https://i.imgur.com/SanopKU.png\" alt=\"\"></p>\n<p>Let’s start filter out the passwords with 32 characters from the wordlist using grep and tail to pick from the bottom:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -E <span class=\"string\">&#x27;^.&#123;32&#125;$&#x27;</span> passwords.txt | <span class=\"built_in\">tail</span> -n 100000 &gt; pass.txt</span><br></pre></td></tr></table></figure>\n<p>Now it’s time to extract the user information from  <code>/etc/shadow</code>  and  <code>/etc/password</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep kong etc/passwd &gt; passwd.txt</span><br><span class=\"line\">grep kong etc/shadow &gt; shadow.txt</span><br></pre></td></tr></table></figure>\n<p>Before start cracking using  <code>John The Ripper</code> . We need to combine the passwd and shadow into a format that john can read.  <code>unshadow</code>  can do this work!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unshadow passwd.txt shadow.txt &gt; crack-me.txt</span><br></pre></td></tr></table></figure>\n<p>Now our hash is ready for crack. Let’s use john with  <code>--format=crypt</code>  to specify that we are trying to crack yescrypt hash</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">john --wordlist=pass.txt crack-me.txt --format=crypt</span><br></pre></td></tr></table></figure>\n<p>After some minutes we got the password!! The password is :  <code>@a*Hd~u32@q1Db/LUiOFxC*W2THm5p*V</code></p>\n<p><img data-src=\"https://i.imgur.com/c1mV0ef.png\" alt=\"\"></p>\n<p>Now it’s time to resotre the  <code>etcd</code> . Restoring a Kubernetes cluster in case of a disaster can be accomplished using etcd snapshots. However, the process of restoring an etcd snapshot is not straightforward and requires expertise. Actually in kubernetes etcd can take snapshot automatically. So we will count on that.</p>\n<p>In this case i will use Kind to generate a lightweight cluster. In case you will use your own cluster you must to know that restoring etcd can lead you to lost your cluster data. So be careful!</p>\n<p>To keep it simple I’ll use the same configuration as  <code>k-config.yaml</code> .</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kind create cluster --config=k-config.yaml</span><br><span class=\"line\">Creating cluster <span class=\"string\">&quot;kind&quot;</span> ...</span><br><span class=\"line\"> ✓ Ensuring node image (kindest/node:v1.25.3) 🖼</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl cluster-info --context kind-kind</span><br><span class=\"line\"></span><br><span class=\"line\">Have a <span class=\"built_in\">nice</span> day! 👋</span><br></pre></td></tr></table></figure>\n<p>In Kind each node will be represented as a container</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s:~$ docker ps</span><br><span class=\"line\">CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS</span><br><span class=\"line\">  NAMES</span><br><span class=\"line\">eba4afe51855   kindest/node:v1.25.3   <span class=\"string\">&quot;/usr/local/bin/entr…&quot;</span>   2 minutes ago   Up 2 minutes   127.0.0.1:43323-&gt;6443/tcp   kind-control-plane</span><br><span class=\"line\">13d7b697ba1f   kindest/node:v1.25.3   <span class=\"string\">&quot;/usr/local/bin/entr…&quot;</span>   2 minutes ago   Up 2 minutes   0.0.0.0:80-&gt;30999/tcp       kind-worker</span><br></pre></td></tr></table></figure>\n<p>After making sure that the api-server works correctly we need to add the  <code>Encryption Configuration</code>  to make sure that the api server can read the encrypted data after restoring etcd.</p>\n<p>Go and put this file on  <code>/etc/kubernetes/enc/enc.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiserver.config.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">EncryptionConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">secrets</span></span><br><span class=\"line\">    <span class=\"attr\">providers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">identity:</span> &#123;&#125;</span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">secretbox:</span></span><br><span class=\"line\">          <span class=\"attr\">keys:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">key1</span></span><br><span class=\"line\">              <span class=\"attr\">secret:</span> <span class=\"string\">QGEqSGR+dTMyQHExRGIvTFVpT0Z4QypXMlRIbTVwKlY=</span></span><br></pre></td></tr></table></figure>\n<p>Then go to  <code>/etc/kubernetes/manifests/api-server.yaml</code>  to add these lines.</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">kubeadm.kubernetes.io/kube-apiserver.advertise-address.endpoint:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.2</span><span class=\"string\">:6443</span></span><br><span class=\"line\">  <span class=\"attr\">creationTimestamp:</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">component:</span> <span class=\"string\">kube-apiserver</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">control-plane</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-apiserver</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">command:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">kube-apiserver</span></span><br><span class=\"line\">    <span class=\"string\">...</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">--encryption-provider-config=/etc/kubernetes/enc/enc.yaml</span>  <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"string\">...</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">enc</span>                           <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/kubernetes/enc</span>      <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">      <span class=\"attr\">readonly:</span> <span class=\"literal\">true</span>                      <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">    <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">enc</span>                             <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">    <span class=\"attr\">hostPath:</span>                             <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">      <span class=\"attr\">path:</span> <span class=\"string\">/etc/kubernetes/enc</span>           <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">DirectoryOrCreate</span>             <span class=\"comment\"># &lt;-- add this line</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br></pre></td></tr></table></figure>\n<p>After changing the manifest the api-server will be stopped and down. If you did it corretly, you need to wait a few seconds until the api-server works again!</p>\n<p>After configuring the api-server correctly let’s take the content  <code>/var/lib/netcd</code>  and try to use the  <code>db</code>  as our snapshot that we want to restore it!</p>\n<p><img data-src=\"https://i.imgur.com/fu0HEsS.png\" alt=\"\"></p>\n<p>I suggest to copy  <code>db</code>  inside the control-plane node (in this case container). I will copy it to one of the extraMounts of kind.</p>\n<p>Now let’s open a shell inside the control-plane container:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">exec</span> -it kind-control-plane bash</span><br></pre></td></tr></table></figure>\n<p>Now we need to use an utility called etcdctl that will help us to interact with the etcd server.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update </span><br><span class=\"line\">apt install etcd-client</span><br></pre></td></tr></table></figure>\n<p>After install it succesfully. An important thing it must be done. Don’t skip this step! you must export an env variable to make etcdctl behave as we need!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> ETCDTL_API=3</span><br></pre></td></tr></table></figure>\n<p>now it’s time to use this utility! There is a resotre command in this utility that allow us to restore the backup or the snapshot</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">etcdctl --endpoints=https://[etcd-server] \\</span><br><span class=\"line\">--cacert=&lt;path-to-ca-certification&gt; \\</span><br><span class=\"line\">--cert=&lt;path-to-etcd-server-cert&gt; \\</span><br><span class=\"line\">--key=&lt;path-to-etcd-server-key&gt; \\</span><br><span class=\"line\">--data-dir &lt;path-to-restored-data&gt; \\ </span><br><span class=\"line\">snapshot restore &lt;path-to-snapshot&gt;</span><br></pre></td></tr></table></figure>\n<p>You need to fill this arguments with your own. you can get theses information from  <code>/etc/kubernetes/manifests/etcd.yaml</code></p>\n<p>In my case the command it will be like this:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ETCDTL_API=3 etcdctl --endpoints=https://[127.0.0.1:2379] \\</span><br><span class=\"line\">--cacert=/etc/kubernetes/pki/etcd/ca.crt \\</span><br><span class=\"line\">--cert=/etc/kubernetes/pki/etcd/server.crt \\</span><br><span class=\"line\">--key=/etc/kubernetes/pki/etcd/server.key \\</span><br><span class=\"line\">--data-dir /var/lib/etcd-backup \\</span><br><span class=\"line\">snapshot restore ./db</span><br></pre></td></tr></table></figure>\n<p>You migth get an error or warning about hash stuff after running this command. Skip it! Let’s check if  <code>/var/lib/etcd-backup</code>  directory is created and if it contains  <code>member</code>  directory!</p>\n<p>If you got it! Then you are on the right way! Now it’s time to do the crazy thing! Let’s replace our new data placed in  <code>/var/lib/etcd-backup/member/snap</code>  to the original etcd database!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span> /var/lib/etcd-backup/member/snap/db /var/lib/etcd/member/snap/</span><br></pre></td></tr></table></figure>\n<p>Just wait few seconds! and try a kubectl command!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get nodes</span><br><span class=\"line\">NAME                  STATUS     ROLES           AGE   VERSION</span><br><span class=\"line\">kind-control-plane    NotReady   &lt;none&gt;          51m   v1.25.3</span><br><span class=\"line\">kind-worker           NotReady   &lt;none&gt;          51m   v1.25.3</span><br><span class=\"line\">quals-control-plane   Ready      control-plane   26h   v1.25.3</span><br><span class=\"line\">quals-worker          Ready      &lt;none&gt;          26h   v1.25.3</span><br></pre></td></tr></table></figure>\n<p>Bingo! It works fine! but as you see here we have nodes naming issues cause of the data of the etcd!</p>\n<p>Let’s check if we have a secret object or not!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get secrets</span><br><span class=\"line\">NAME      TYPE                             DATA   AGE</span><br><span class=\"line\">regcred   kubernetes.io/dockerconfigjson   1      26h</span><br></pre></td></tr></table></figure>\n<p>And Yes!!! We got our secret! Let’s now inspect the data inside it!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> kubectl get secret regcred -o jsonpath=<span class=\"string\">&#x27;&#123;.data.\\.dockerconfigjson&#125;&#x27;</span> | <span class=\"built_in\">base64</span> -d</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;auths&quot;</span>:&#123;<span class=\"string\">&quot;docker.io&quot;</span>:&#123;<span class=\"string\">&quot;username&quot;</span>:<span class=\"string\">&quot;medrafk8s&quot;</span>,<span class=\"string\">&quot;password&quot;</span>:<span class=\"string\">&quot;dckr_pat_MLkRjYtjdk7dwT80W_dx3VTuac8&quot;</span>,<span class=\"string\">&quot;auth&quot;</span>:<span class=\"string\">&quot;bWVkcmFmazhzOmRja3JfcGF0X01Ma1JqWXRqZGs3ZHdUODBXX2R4M1ZUdWFjOA==&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>\n<p>And finally! The registry is  <code>docker.io</code> , the username is  <code>medrafk8s</code>  and the password is  <code>dckr_pat_MLkRjYtjdk7dwT80W_dx3VTuac8</code></p>\n<p>With this creds we can pull the container that host the malicious binary and analyse his traffic! Let’s do it!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s:~$ docker login docker.io -u medrafk8s -p dckr_pat_MLkRjYtjdk7dwT80W_dx3VTuac8</span><br><span class=\"line\">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class=\"line\">Login Succeeded</span><br></pre></td></tr></table></figure>\n<p>Let’s pull this image now!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s:~$ docker pull medrafk8s/kubersex</span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from medrafk8s/kubersex</span><br><span class=\"line\">c158987b0551: Pull complete</span><br><span class=\"line\">1e35f6679fab: Pull complete</span><br><span class=\"line\">cb9626c74200: Pull complete</span><br><span class=\"line\">b6334b6ace34: Pull complete</span><br><span class=\"line\">f1d1c9928c82: Pull complete</span><br><span class=\"line\">9b6f639ec6ea: Pull complete</span><br><span class=\"line\">ee68d3549ec8: Downloading [=======&gt;                                           ]  1.813MB/11.49MB</span><br><span class=\"line\">4caa31e6cbc5: Download complete</span><br><span class=\"line\">a1434f597582: Waiting</span><br></pre></td></tr></table></figure>\n<p>The 1st i used to do when I pull a container image in forensics challenges is to check the layers of the image!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s:~$ docker <span class=\"built_in\">history</span> medrafk8s/kubersex</span><br><span class=\"line\">IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT</span><br><span class=\"line\">77a3b3f4c35c   13 minutes ago   /bin/sh -c <span class=\"comment\">#(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon…   0B</span></span><br><span class=\"line\">0b383b70426b   13 minutes ago   /bin/sh -c <span class=\"built_in\">rm</span> Serial-Key.txt                    0B</span><br><span class=\"line\">b6ca15406c7d   13 minutes ago   /bin/sh -c <span class=\"comment\">#(nop)  EXPOSE 80                    0B</span></span><br><span class=\"line\">64eaf6945cd1   13 minutes ago   /bin/sh -c <span class=\"comment\">#(nop) COPY file:ed75fc1a725ff91b…   20B</span></span><br><span class=\"line\">748d1b219207   13 minutes ago   /bin/sh -c <span class=\"comment\">#(nop) COPY dir:48e5409ee398a470a…   5.4MB</span></span><br><span class=\"line\">4937520ae206   6 weeks ago      /bin/sh -c <span class=\"built_in\">set</span> -x     &amp;&amp; apkArch=<span class=\"string\">&quot;<span class=\"subst\">$(cat /etc…   29.6MB</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">&lt;missing&gt;      6 weeks ago      /bin/sh -c #(nop)</span>  ENV NJS_VERSION=0.7.12       0B</span></span><br><span class=\"line\"><span class=\"string\">&lt;missing&gt;      6 weeks ago      /bin/sh -c #(nop)  CMD [&quot;</span>nginx<span class=\"string\">&quot; &quot;</span>-g<span class=\"string\">&quot; &quot;</span>daemon…   0B</span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop)  STOPSIGNAL SIGQUIT           0B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop)  EXPOSE 80                    0B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop)  ENTRYPOINT [&quot;/docker-entr…   0B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop) COPY file:e57eef017a414ca7…   4.62kB</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop) COPY file:36429cfeeb299f99…   3.01kB</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop) COPY file:d4375883ed5db364…   276B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop) COPY file:5c18272734349488…   2.12kB</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop) COPY file:7b307b62e82255f0…   1.62kB</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"built_in\">set</span> -x     &amp;&amp; addgroup -g 101 -S …   4.74MB</span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop)  ENV PKG_RELEASE=1            0B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop)  ENV NGINX_VERSION=1.25.1     0B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop)  LABEL maintainer=NGINX Do…   0B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop)  CMD [&quot;/bin/sh&quot;]              0B</span></span><br><span class=\"line\">&lt;missing&gt;      6 weeks ago      /bin/sh -c <span class=\"comment\">#(nop) ADD file:828b07e74c184e7f2…   7.05MB</span></span><br></pre></td></tr></table></figure>\n<p>This is a webserver! Something important is here. No one can ignore the  <code>Serial-Key.txt</code>  file<br>\nWe will get it later! Let’s run the web app now</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s:~$ sudo docker run --name kubersex -p 81:80 medrafk8s/kubersex</span><br><span class=\"line\">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class=\"line\">/docker-entrypoint.sh: Looking <span class=\"keyword\">for</span> shell scripts <span class=\"keyword\">in</span> /docker-entrypoint.d/</span><br><span class=\"line\">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class=\"line\">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class=\"line\">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class=\"keyword\">in</span> /etc/nginx/conf.d/default.conf</span><br><span class=\"line\">/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</span><br><span class=\"line\">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class=\"line\">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class=\"line\">/docker-entrypoint.sh: Configuration complete; ready <span class=\"keyword\">for</span> start up</span><br><span class=\"line\">2023/08/02 17:37:52 [notice] 1<span class=\"comment\">#1: using the &quot;epoll&quot; event method</span></span><br><span class=\"line\">2023/08/02 17:37:52 [notice] 1<span class=\"comment\">#1: nginx/1.25.1</span></span><br><span class=\"line\">2023/08/02 17:37:52 [notice] 1<span class=\"comment\">#1: built by gcc 12.2.1 20220924 (Alpine 12.2.1_git20220924-r4)</span></span><br></pre></td></tr></table></figure>\n<p>Mmm there is a Download button! Press it and you will get a binary! Bingo! This is the malicious release!</p>\n<p><img data-src=\"https://i.imgur.com/jDkGJef.png\" alt=\"The web app\"></p>\n<p>After checking the binary and run it, we found that the binary requires a serial key! Let’s recover that file!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s:~$ docker save medrafk8s/medraf &gt; image.tar </span><br><span class=\"line\">raf@4n6nk8s:~$ tar -xf image.tar </span><br><span class=\"line\">raf@4n6nk8s:~$ <span class=\"built_in\">cd</span> aae4861ba6bde0fbe820ba547bbe794c7c7e9c8be14c8972a6691eaa584161bc</span><br><span class=\"line\">raf@4n6nk8s:~$ tar -xf layer.tar &amp;&amp; <span class=\"built_in\">ls</span></span><br><span class=\"line\">Serial-Key.txt  VERSION  json  layer.tar</span><br></pre></td></tr></table></figure>\n<p>And this is the content of the file !</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I will put the serial key in the container image in case you forget! YOU FOOOOL YOU USED TO FORGET IT! GO AND DESTROY THE SERVICE WITH THE BOSS HOST!</span><br><span class=\"line\"></span><br><span class=\"line\">KEY:</span><br><span class=\"line\">KFTV-RCFL-VC5W-HX3X</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>At this point you can reverse the binary and get the flag! or patch the binary to change a IP server with your choice! In this step reversing is the main idea so i put a public IP of a reachable server to make the binary send packets when players decice to run it !</p>\n</blockquote>\n<p>Let’s continue:</p>\n<p>Run the binary again and insert that key! It seems the binary works! I bet this is the responsible binary for the DDoS attack! So, I will check the behavior of this binary and open Wireshark while this one is running!</p>\n<p><img data-src=\"https://i.imgur.com/Opesxe5.png\" alt=\"Record Traffic with Wireshark\"></p>\n<p>Mmmm this is http flow! Let’s check the requests!</p>\n<p><img data-src=\"https://i.imgur.com/tzWSbjW.png\" alt=\"We got the flag!\"></p>\n<p>Binggo we got the flag! The flag is on the http header</p>\n<p>FLAG:  <code>Securinets&#123;c03cefb79791e431011d0f86de9dd83aee67aebcec946bfefad00cd4807fc9c3&#125;</code></p>\n<h2 id=\"jackpot\"><a class=\"markdownIt-Anchor\" href=\"#jackpot\">#</a> Jackpot</h2>\n<p><img data-src=\"https://i.imgur.com/GONLlyG.png\" alt=\"\"></p>\n<p>We were able to find a left-behind cranky old cartel laptop in hibernation state. We believe that this device can help us retrieve the cartel’s crypto-currency wallet and withdraw their future gains.</p>\n<p>We know that the cartel uses an intranet to communicate their news within couple of blocks in the city undergrounds.</p>\n<p>Provided this intellisense, can you win us the jackpot? Wrap your finding in Securinets as indicated below.</p>\n<p drug-enforcement-administration-for-the-win-style=\"\">Flag format: Securinets</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9hZG1pZGEwdWk=\">adm &amp; mida0ui</span></p>\n<h3 id=\"attachment\"><a class=\"markdownIt-Anchor\" href=\"#attachment\">#</a> Attachment</h3>\n<p>Given a disk image,  <code>disk.img</code> . The disk image is a raw disk image, and can be investigated using FTK Imager.<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xU3M0UVRRaTRYYlJYYlRmeTNGVTBuRGJxZVBGaHVSRkkvdmlldz91c3A9c2hhcmluZw==\">https://drive.google.com/file/d/1Ss4QTQi4XbRXbTfy3FU0nDbqePFhuRFI/view?usp=sharing</span></p>\n<h3 id=\"writeup\"><a class=\"markdownIt-Anchor\" href=\"#writeup\">#</a> Writeup</h3>\n<p>The disk image is a raw disk image, and can be investigated using FTK Imager. The disk image contains a single partition, which is a Windows XP installation.</p>\n<p>Looking at the root of the disk image, we can see a few interesting files:</p>\n<p><img data-src=\"https://i.imgur.com/Qx1z5zy.png\" alt=\"\"></p>\n<ul>\n<li><code>Documents and Settings</code>  - Contains the user profiles of the system</li>\n<li><code>Program Files</code>  - Contains the installed programs</li>\n<li><code>Windows</code>  - Contains the Windows installation files</li>\n<li><code>pagefile.sys</code>  - The page file of the system, aka swap file, which holds the memory of the system when it is not in use or when it is not enough RAM to hold the memory of the system.</li>\n<li><code>hiberfil.sys</code>  - The hibernation file of the system, which contains the memory of the system when it is hibernated.</li>\n<li><code>System Volume Information</code>  - Contains the shadow copies of the system, which is a backup of the system files. It is used to restore the system in case of a system failure. It is also used by the Windows Backup utility to create a backup of the system. It is also used by the Windows Restore utility to restore the system to a previous state. This folder is present in all disk images, people are usually not interested in it. However, it is very interesting in this case, as it contains a folder named  <code>_restore&#123;xxxxxx&#125;</code> . This folder contains a file named  <code>RPx</code> , this cleary a restore point of the system. We will investigate it later as well.</li>\n</ul>\n<p>and the rest of the stuff that would really find in any Windows disk…</p>\n<p>Let’s start with the fact that the laptop was in hibernation mode, we know for a fact that the hiberfil.sys stores the memory content at hibernation, maybe we can treat it as an actual memory and find the intranet chat!!?</p>\n<p>Googling a bit, I found this (Superuser question)[<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBlcnVzZXIuY29tL3F1ZXN0aW9ucy82NjA2NDkvaG93LXRvLXJlYWQtd2luZG93cy1oaWJlcm5hdGlvbi1maWxlLWhpYmVyZmlsLXN5cy10by1leHRyYWN0LWRhdGE=\">https://superuser.com/questions/660649/how-to-read-windows-hibernation-file-hiberfil-sys-to-extract-data</span>] and it says that if we convert the hiberfile.sys file to a raw image, we can use Volatility to analyze it!</p>\n<p>and this is the command to use, as indicated:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vol -f hiberfil.sys --profile WinXPSP3x86 imagecopy -O hiberfil.raw</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://i.imgur.com/AgJlPlG.png\" alt=\"\"></p>\n<p>Cool, we hope now we can use Volatility to analyze the hiberfil.raw file. Let’s start by checking the processes and commands history.</p>\n<p><img data-src=\"https://i.imgur.com/MGjHNpu.png\" alt=\"\"></p>\n<p>Cmdscan now maybe!</p>\n<p><img data-src=\"https://i.imgur.com/8KCPq36.png\" alt=\"\"></p>\n<p>There we go, we can see what they meant by the legacy, old school chat. They were using  <code>msg.exe</code>  to communicate with each other. This is a very old program, and it is used to send messages to other users in the same network. It is very similar to the LAN messenger that we found earlier, but it is a command line program.  <code>msg</code>  can also be used to transmit files as well.</p>\n<p>The chat goes with the description and indicates that our guy got some kind of password that was placed in a certain registry key and permanetly deleted it after.</p>\n<p>Now, let’s further investigate the programs now to build an understanding around this situation</p>\n<p><img data-src=\"https://i.imgur.com/NGRW8VU.png\" alt=\"\"></p>\n<p>We only see Chrome to be the only interesting thing in this disk evidence.</p>\n<p>We know the crypto-currency part might need some searching to know that Metamask the most famous crypto wallet is a browser extension!!</p>\n<p>And yeah, Metamask is being used in Chrome. Metamask is a browser extension that allows you to use Ethereum, Binance Chain, and more. It is a very popular extension, and it is used by a lot of people. Metamask gives you a wallet address, and you can use it to send and receive cryptocurrencies whether in the Ethereum network, BSC network, or custom networks. But an address is only the public key you use to send and receive, we are looking further than that, we want the private one to be able to control the wallet completely.</p>\n<p>Metamask Extension for Chrome</p>\n<p><img data-src=\"https://i.imgur.com/wWzkTjZ.png\" alt=\"\"></p>\n<p>Could there be an active wallet within Metamask? Let’s check it out.</p>\n<p>Usually the extension data is stored within the ‘Local Extension Settings’ folder. And as expected, that folder contains some interesting files.</p>\n<p><img data-src=\"https://i.imgur.com/t8T8lYY.png\" alt=\"\"></p>\n<p>The  <code>Local Extension Settings</code>  folder contains a folder named  <code>nkbihfbeogaeaoehlefnkodbefgpgknn</code> , which is the ID of the Metamask extension. This folder contains a file named 0000xx.ldb, which is a DB file. Let’s check it out.</p>\n<p>According to this <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldGhlcmV1bS5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvNTI2NTgvd2hlcmUtZG9lcy1tZXRhbWFzay1zdG9yZS10aGUtd2FsbGV0LXNlZWQtZmlsZS1wYXRo\">Ethereum Stackexchange question</span>. We could be able to completely control the existing wallet if we have the password. Could the challenge be all about that? and how to get the wallet password?</p>\n<p>Yes it is possible, and we will get back to it later, for now, finding password is the priority!! We know it is a registry key, that was deleted.</p>\n<p>Let’s think how we can RESTORE it xD</p>\n<p>Is it the time, to investigate the  <code>_restore&#123;xxxxxx&#125;</code>  folder? right?</p>\n<p>We can make use of a VM, however (OP: says the disk must not be converted back to vmdk whether by using a different file format or breaking the boot files). This way we can’t use a VM to check the restore point. So, we have to do it manually. My idea is to spin my own Windows XP on VMware, you can get the ISO officially by Microsoft with serial number from the WayBackMachine SP3 and x86 of course. After that we create a dummy restore point and modify its files by copying the RP folders from  <code>System Volume Information</code>  and then we can proceed to perform a restore point to see what is inside. I hope you can understand what I mean here.</p>\n<p>(OP Note: for order I guess I will accept any provided order or make the user follow the order as shown in the leaked chat.)</p>\n<p>Let’s do it.</p>\n<ul>\n<li>Spinning a new Windows XP machine</li>\n</ul>\n<p><img data-src=\"https://i.imgur.com/gAJWn0m.png\" alt=\"\"></p>\n<ul>\n<li>Creating a dummy restore point or just get the disk UUID, anyways we need Windows to create a restore point folder for us, so let’s do it.</li>\n</ul>\n<p><img data-src=\"https://i.imgur.com/hoZj5DU.png\" alt=\"\"></p>\n<ul>\n<li>Copying the RP folders from the Disk image  <code>System Volume Information</code>  to the new VM’s  <code>System Volume Information</code></li>\n</ul>\n<p>Export the restore folder from System Volume Information to your desktop or some folder.</p>\n<p>Adjust these folder options on Windows XP VM</p>\n<p><img data-src=\"https://i.imgur.com/LH8W47T.png\" alt=\"\"></p>\n<p>Then use this command to gain access to the System Volume Information folder</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cacls <span class=\"string\">&quot;C:\\System Volume Information&quot;</span> /E /G Administrator:F</span><br></pre></td></tr></table></figure>\n<p>It can be administrator, Everyone or your specific VM username.</p>\n<p><img data-src=\"https://i.imgur.com/6JWtrGQ.png\" alt=\"\"></p>\n<p>Then copy the restore folder contents to the System Volume Information folder</p>\n<p>This is the current dummy restore point we made</p>\n<p><img data-src=\"https://i.imgur.com/ReEeaE9.png\" alt=\"\"></p>\n<p>We add the exported RP5 and RP6 folders from the disk image with them</p>\n<p>In each of the folders there is a  <code>drivetable.txt</code>  file that contains the old disk UUID, we need to replace it with the new one.</p>\n<ul>\n<li>Modifying Disk UUID in the restore point</li>\n</ul>\n<p>You can also modify the  <code>domain.txt</code>  since it contains the old user-id but I believe the Restore point utility can very much detect the change.</p>\n<ul>\n<li>Restoring the system like if it was a real restore point we made.</li>\n</ul>\n<p><img data-src=\"https://i.imgur.com/NW9lTab.png\" alt=\"\"></p>\n<p>We can see a new entry added called “restore_point”, so let’s proceed with it!</p>\n<p>This is the domain thing, hit ‘OK’</p>\n<p><img data-src=\"https://i.imgur.com/VMADEqo.png\" alt=\"\"></p>\n<p>We wait for a quick restart.</p>\n<p><img data-src=\"https://i.imgur.com/X1drpyr.png\" alt=\"\"></p>\n<p>And that’s a success!</p>\n<p>Let’s open the registry now, shall we?</p>\n<p><img data-src=\"https://i.imgur.com/ynNyJqX.png\" alt=\"\"></p>\n<p>And there we go, a key named password containing a string named deleteMe! Bingo!</p>\n<p>At this point, there is only one thing left, let’s get the flag!</p>\n<p>Remember that Ethereum stack exchange question I mentioned earlier? here is the link again, also bring the content of the ldb file’s vault which is near the word “keyring”, you can CTRL+F that in the ldb files and adjust the format if some letters are escaped or encoded because data is never lost, you can also upload the whole file to the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXRhbWFzay5naXRodWIuaW8vdmF1bHQtZGVjcnlwdG9yLw==\">tool</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldGhlcmV1bS5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvNTI2NTgvd2hlcmUtZG9lcy1tZXRhbWFzay1zdG9yZS10aGUtd2FsbGV0LXNlZWQtZmlsZS1wYXRo\">https://ethereum.stackexchange.com/questions/52658/where-does-metamask-store-the-wallet-seed-file-path</span>.</p>\n<p><img data-src=\"https://i.imgur.com/FxNDjWP.png\" alt=\"\"></p>\n<p><img data-src=\"https://i.imgur.com/Mhm1M63.png\" alt=\"\"></p>\n<p>Let’s get our flag now</p>\n<p><img data-src=\"https://i.imgur.com/3tK5T2J.png\" alt=\"\"></p>\n<p>Done, we have some critical information here. The seed phrase! We wrap it in Securinets</p>\n<p><code>Securinets&#123;female-fire-strong-accuse-spring-update-bird-exchange-home-embark-latin-mom&#125;</code></p>\n<p>Thanks for reading, we hope you enjoyed it, and we will be happy to hear your feedback and suggestions.</p>\n<p>GGs <strong>itunderground</strong> for solving this challenge</p>\n<h3 id=\"idea-and-final-words\"><a class=\"markdownIt-Anchor\" href=\"#idea-and-final-words\">#</a> Idea and Final Words</h3>\n<p>Just wanted to use pagefile.sys, hiberfile.sys, the Metamask thing, and Restore points because nobody used them like this in a CTF. So don’t know if that’s a great thing or rather will make players frustrated. Yet, tried to make everything as clear as possible for the players to understand and enjoy the challenge as a whole.</p>\n<h2 id=\"raf-hide\"><a class=\"markdownIt-Anchor\" href=\"#raf-hide\">#</a> Raf Hide</h2>\n<p><img data-src=\"https://i.imgur.com/QRKzGoO.png\" alt=\"\"></p>\n<h3 id=\"description-2\"><a class=\"markdownIt-Anchor\" href=\"#description-2\">#</a> Description:</h3>\n<blockquote Secrect=\"\">\n<p>My friend write a tool that can hide data inside an image. He give me this tool with an anime video without any source code and challenge me to get the secret! . Can you help me extract the flag?<br>\nFlag format: Securinets</p>\n</blockquote>\n<blockquote>\n<p>In this Challenge you will get a go binary and a video! I will not explain how to reverse the binary. The main Idea is to understand what the binary do and extract the data from the video</p>\n</blockquote>\n<p>Author: <strong>Raf²</strong></p>\n<p>Binary: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzRuNm5rOHMvcXVhbHMtMjAyMy13cml0ZS11cHMvcmF3L21haW4vUmFmLUhpZGUvcmFmaGlkZQ==\">Download</span></p>\n<p>This is a python version of what the binary can do :</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Create an ArgumentParser object</span></span><br><span class=\"line\">parser = argparse.ArgumentParser(description=<span class=\"string\">&#x27;Example program using options and arguments&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Add options and arguments</span></span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-i&#x27;</span>, <span class=\"string\">&#x27;--input&#x27;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;select cover-image&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-e&#x27;</span>, <span class=\"string\">&#x27;--embedfile&#x27;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;select image to be embedded&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-o&#x27;</span>, <span class=\"string\">&#x27;--output&#x27;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;The output&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Parse the arguments</span></span><br><span class=\"line\">args = parser.parse_args()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Check if the options and arguments are correct</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> args.<span class=\"built_in\">input</span> <span class=\"keyword\">and</span> args.embedfile <span class=\"keyword\">and</span> args.output:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Starting Hiding ...&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    <span class=\"comment\"># Provide an usage message if the input is incorrect</span></span><br><span class=\"line\">    parser.print_usage()</span><br><span class=\"line\">    exit()</span><br><span class=\"line\"></span><br><span class=\"line\">image=Image.<span class=\"built_in\">open</span>(args.<span class=\"built_in\">input</span>)</span><br><span class=\"line\">embed=Image.<span class=\"built_in\">open</span>(args.embedfile).convert(<span class=\"string\">&#x27;1&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> image.size != embed.size:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;The Images are not in the same size!&#x27;</span>)</span><br><span class=\"line\">    exit()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">embed_data=embed.load()</span><br><span class=\"line\">image_data=image.load()</span><br><span class=\"line\">index=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(image.height):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(image.width):</span><br><span class=\"line\">        flag_pix=<span class=\"built_in\">int</span>(embed_data[i,j])</span><br><span class=\"line\">        flag_pix &amp;=<span class=\"number\">1</span></span><br><span class=\"line\">        im_pix=<span class=\"built_in\">list</span>(image_data[i,j])</span><br><span class=\"line\">        data = ((flag_pix &lt;&lt; index%<span class=\"number\">2</span>) | (<span class=\"number\">254</span>-index%<span class=\"number\">2</span>)) </span><br><span class=\"line\">        <span class=\"keyword\">if</span> flag_pix ==<span class=\"number\">1</span> :</span><br><span class=\"line\">            im_pix[index%<span class=\"number\">3</span>]|= data &amp; (<span class=\"number\">1</span>+index%<span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            im_pix[index%<span class=\"number\">3</span>]&amp;= data</span><br><span class=\"line\">        image_data[i,j]=<span class=\"built_in\">tuple</span>(im_pix)</span><br><span class=\"line\">        index+=<span class=\"number\">1</span></span><br><span class=\"line\">image.save(args.output)</span><br></pre></td></tr></table></figure>\n<p>This is a golang version of what the binary can do :</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;image&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;image/color&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;image/png&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Create a new FlagSet to parse command line arguments</span></span><br><span class=\"line\">\tflagSet := flag.NewFlagSet(<span class=\"string\">&quot;steganography&quot;</span>, flag.ExitOnError)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Define command line options and arguments</span></span><br><span class=\"line\">\tinputFileName := flagSet.String(<span class=\"string\">&quot;i&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;select cover-image&quot;</span>)</span><br><span class=\"line\">\tembedFileName := flagSet.String(<span class=\"string\">&quot;e&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;select image to be embedded&quot;</span>)</span><br><span class=\"line\">\toutputFileName := flagSet.String(<span class=\"string\">&quot;o&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;The output&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Parse the command line arguments</span></span><br><span class=\"line\">\tflagSet.Parse(os.Args[<span class=\"number\">1</span>:])</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Check if the options and arguments are correct</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> *inputFileName == <span class=\"string\">&quot;&quot;</span> || *embedFileName == <span class=\"string\">&quot;&quot;</span> || *outputFileName == <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\tflagSet.Usage()</span><br><span class=\"line\">\t\tos.Exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Open the input file</span></span><br><span class=\"line\">\tinputFile1, err := os.Open(*embedFileName)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> inputFile1.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Decode the PNG image</span></span><br><span class=\"line\">\tinputImage1, _, err := image.Decode(inputFile1)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Check if the image is grayscale</span></span><br><span class=\"line\">\tgrayImage, ok := inputImage1.(*image.Gray)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;Error: input image is not grayscale&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Get the width and height of the image</span></span><br><span class=\"line\">\tembed_width := grayImage.Bounds().Size().X</span><br><span class=\"line\">\tembed_height := grayImage.Bounds().Size().Y</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Open the input file</span></span><br><span class=\"line\">\tinputFile, err := os.Open(*inputFileName)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> inputFile.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Decode the image as a generic Image interface value</span></span><br><span class=\"line\">\tinputImage, _, err := image.Decode(inputFile)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Assert the image to an *image.RGBA or *image.NRGBA value</span></span><br><span class=\"line\">\trgba, ok := inputImage.(*image.RGBA)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\tnrgba, ok := inputImage.(*image.NRGBA)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;Input image format not supported&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\trgba = image.NewRGBA(nrgba.Bounds())</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Get the width and height of the image</span></span><br><span class=\"line\">\tbounds := rgba.Bounds()</span><br><span class=\"line\">\twidth := bounds.Size().X</span><br><span class=\"line\">\theight := bounds.Size().Y</span><br><span class=\"line\">\tindex:=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> width!=embed_width || height!=embed_height &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;The Images are not in the same size!&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// Invert the colors of the image by subtracting each RGB component from 255</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> y := <span class=\"number\">0</span>; y &lt; height; y++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> x := <span class=\"number\">0</span>; x &lt; width; x++ &#123;</span><br><span class=\"line\">\t\t\tintensity := grayImage.GrayAt(x, y).Y &amp; <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\ti:=<span class=\"type\">uint8</span>(index%<span class=\"number\">2</span>)</span><br><span class=\"line\">\t\t\tdata:= ((intensity &lt;&lt; i) | (<span class=\"number\">254</span>-i))</span><br><span class=\"line\">\t\t\tr, g, b, a := rgba.At(x, y).RGBA()</span><br><span class=\"line\">\t\t\tim_pix:= [<span class=\"number\">3</span>]<span class=\"type\">uint8</span>&#123;<span class=\"type\">uint8</span>(r),<span class=\"type\">uint8</span>(g),<span class=\"type\">uint8</span>(b)&#125;</span><br><span class=\"line\">\t\t\tj:= <span class=\"type\">uint</span>(index%<span class=\"number\">3</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> intensity == <span class=\"number\">1</span> &#123;</span><br><span class=\"line\">\t\t\t\tim_pix[j] = im_pix[j] | (data &amp; (<span class=\"number\">1</span>+i))</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tim_pix[j] = im_pix[j] &amp; data</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tnewColor := color.RGBA&#123;</span><br><span class=\"line\">\t\t\t\tR: <span class=\"type\">uint8</span>(im_pix[<span class=\"number\">0</span>]),</span><br><span class=\"line\">\t\t\t\tG: <span class=\"type\">uint8</span>(im_pix[<span class=\"number\">1</span>]),</span><br><span class=\"line\">\t\t\t\tB: <span class=\"type\">uint8</span>(im_pix[<span class=\"number\">2</span>]),</span><br><span class=\"line\">\t\t\t\tA: <span class=\"type\">uint8</span>(a),</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\trgba.SetRGBA(x, y, newColor)</span><br><span class=\"line\">\t\t\tindex++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Create the output file</span></span><br><span class=\"line\">\toutputFile, err := os.Create(*outputFileName)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> outputFile.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Encode the output image as PNG</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := png.Encode(outputFile, rgba); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;Output image saved successfully&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>As we see here this script try to hide image inside another image in a specific way. We need to understand how he hide data.</p>\n<p>The tool take a black-white image that have only 2 values in his pixels and try to inject this pixels in the LSB of RGB channels of the other image!<br>\nBut be carefull is not a traditional or simple LSB steganoraphy here! In each iteration it take a single channel. For example the 1st pixel will use the Red value, 2nd will use the Green value, 3rd will use the Blue and so on.</p>\n<p>We need to reverse this algorithm and write a script that can extract from images used by this tool.</p>\n<p>Let’s use this one!</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">INPUT_FILFE=<span class=\"string\">&quot;input.png&quot;</span></span><br><span class=\"line\">EXTRACTED_DATA=<span class=\"string\">&quot;extracted.png&quot;</span></span><br><span class=\"line\">image=Image.<span class=\"built_in\">open</span>(INPUT_FILFE)</span><br><span class=\"line\">image_data = image.load()</span><br><span class=\"line\">extracted = Image.new(<span class=\"string\">&#x27;1&#x27;</span>, (image.width,image.height), <span class=\"number\">1</span>)</span><br><span class=\"line\">index=<span class=\"number\">0</span></span><br><span class=\"line\">output_data=extracted.load()</span><br><span class=\"line\"><span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(image.height):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(image.width):  </span><br><span class=\"line\">        im_pix=<span class=\"built_in\">list</span>(image_data[i,j])</span><br><span class=\"line\">        flag_pix = (im_pix[index%<span class=\"number\">3</span>]&amp;(<span class=\"number\">1</span>+index%<span class=\"number\">2</span>)) </span><br><span class=\"line\">        <span class=\"keyword\">if</span> flag_pix &gt;= <span class=\"number\">1</span>:</span><br><span class=\"line\">            flag_pix=<span class=\"number\">255</span></span><br><span class=\"line\">        output_data[i,j]=flag_pix</span><br><span class=\"line\">        index+=<span class=\"number\">1</span></span><br><span class=\"line\">extracted.save(EXTRACTED_DATA)</span><br></pre></td></tr></table></figure>\n<p>To make sure that everything is ok now! We can use the given tool and hide a black-white image and try to extract it with our new script.</p>\n<p>We assume that everything is fine. Let’s take a look now how can we extract data from the video!</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/video-gif.gif\" alt=\"\"></p>\n<p>Let’s extract every frame from this video and try to extract a data from it using our last script. Maybe we will find something here!</p>\n<h3 id=\"extract-all-the-frames-using-ffmpeg\"><a class=\"markdownIt-Anchor\" href=\"#extract-all-the-frames-using-ffmpeg\">#</a> Extract all the frames using ffmpeg</h3>\n<p>After running this command. we get 383 frames.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@Securinets:~$ <span class=\"built_in\">mkdir</span> frames</span><br><span class=\"line\">raf@Securinets:~$ ffmpeg -i challenge.mp4 frames/%3d.png</span><br></pre></td></tr></table></figure>\n<h3 id=\"extract-data-from-each-frame-using-our-solver\"><a class=\"markdownIt-Anchor\" href=\"#extract-data-from-each-frame-using-our-solver\">#</a> Extract data from each frame using our solver</h3>\n<p>Let’s use our solver to try extracting data from each frame.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@Securinets:~$ <span class=\"built_in\">mkdir</span> data</span><br></pre></td></tr></table></figure>\n<p>We will put our solver inside a function and use a for loop to run it on each frame</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">extract</span>(<span class=\"params\">frame,output</span>):</span><br><span class=\"line\">    image=Image.<span class=\"built_in\">open</span>(frame)</span><br><span class=\"line\">    image_data = image.load()</span><br><span class=\"line\">    extracted = Image.new(<span class=\"string\">&#x27;1&#x27;</span>, (image.width,image.height), <span class=\"number\">1</span>)</span><br><span class=\"line\">    index=<span class=\"number\">0</span></span><br><span class=\"line\">    output_data=extracted.load()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(image.height):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(image.width):  </span><br><span class=\"line\">            im_pix=<span class=\"built_in\">list</span>(image_data[i,j])</span><br><span class=\"line\">            flag_pix = (im_pix[index%<span class=\"number\">3</span>]&amp;(<span class=\"number\">1</span>+index%<span class=\"number\">2</span>)) </span><br><span class=\"line\">            <span class=\"keyword\">if</span> flag_pix &gt;= <span class=\"number\">1</span>:</span><br><span class=\"line\">                flag_pix=<span class=\"number\">255</span></span><br><span class=\"line\">            output_data[i,j]=flag_pix</span><br><span class=\"line\">            index+=<span class=\"number\">1</span></span><br><span class=\"line\">    extracted.save(output)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">383</span>):</span><br><span class=\"line\">    index=<span class=\"string\">&quot;0&quot;</span>*(<span class=\"number\">3</span>-<span class=\"built_in\">len</span>(<span class=\"built_in\">str</span>(i+<span class=\"number\">1</span>)))+<span class=\"built_in\">str</span>(i+<span class=\"number\">1</span>)+<span class=\"string\">&quot;.png&quot;</span></span><br><span class=\"line\">    extract(<span class=\"string\">&quot;frames/&quot;</span>+index,<span class=\"string\">&quot;data/&quot;</span>+index)</span><br></pre></td></tr></table></figure>\n<p>Let’s now check the result and what we get!<br>\nOf couse we will get 383 images. But is all the images are usefull or not? Let’s check.</p>\n<p>We find this image extracted from the 1st frame of the image!</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/000.png\" alt=\"\"></p>\n<p>Bingo! We are on the right way! The author told us to check the last images! Yeah we will but let’s check what we got in all the images!</p>\n<p>We found a big number of image that have a black line in random position of the image!</p>\n<p float=\"left\">\n  <img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/015.png\" width=\"450\" style=\"margin-right:50px;\" />\n  <img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/210.png\" width=\"450\" /> \n</p>\n<p>Ok Let’s focus on the last images as the author said. This is will be better for us. Wait what?! We found a 2 pastebin links and 2 images putted as hint for us. And of couse a rabbit hole(Fake Flag)</p>\n<p float=\"center\">\n  <img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/372.png\" width=\"320\"style=\"margin-right:10px;\" />\n  <img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/377.png\" width=\"320\"style=\"margin-right:10px;\" /> \n  <img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/381.png\" width=\"320\"style=\"margin-right:10px;\" /> \n</p>\n<p>Let’s check the content of the 2 pastebin links and see what we have!</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Advertising flash, it&#x27;s time to relax and rest.</span><br><span class=\"line\">This pastebin is the solution to your problem </span><br><span class=\"line\">Those links will Absolutely help you </span><br><span class=\"line\"> </span><br><span class=\"line\">https://4n6nk8s.tech</span><br><span class=\"line\">https://anas-cherni.me/</span><br><span class=\"line\">https://ironbyte.me/</span><br><span class=\"line\">https://yassine-belkhadem.tech/ ( Don&#x27;t waste your time with this link)</span><br><span class=\"line\">https://github.com/M0ngi</span><br><span class=\"line\">https://soter14.tech/</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">Thi is the FLAG: GG_Tr0ll1ng_1s_MY_G4mE_!</span><br><span class=\"line\"> </span><br><span class=\"line\">https://github.com/Mohamed-Rafraf</span><br><span class=\"line\">https://github.com/adamlahbib</span><br><span class=\"line\">https://www.linkedin.com/in/mohamed-rafraf/</span><br><span class=\"line\">https://www.linkedin.com/in/adamlahbib/</span><br><span class=\"line\">https://www.linkedin.com/in/anascherni/</span><br><span class=\"line\">https://www.linkedin.com/in/yassine-belkhadem-396266204/</span><br><span class=\"line\">https://www.linkedin.com/in/m0ngi/</span><br><span class=\"line\">https://www.linkedin.com/in/mohamed-ali-ouachani-00a452237/</span><br><span class=\"line\">https://www.linkedin.com/in/rania-midaoui-b0163a1bb/</span><br><span class=\"line\">https://www.linkedin.com/in/mohamed-ayadi-5a10621a4/</span><br><span class=\"line\">https://www.linkedin.com/in/yassine-belarbi-853303208/</span><br></pre></td></tr></table></figure>\n<p>There is another fake flag &amp; links for the blogs of the author and his team members! Yeah It’s SOter14 team. Let’s Check the other one. Maybe it will help</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">6 &lt;--&gt; 29</span><br><span class=\"line\">15 &lt;--&gt; 25</span><br><span class=\"line\">11 &lt;--&gt; 34</span><br><span class=\"line\">10 &lt;--&gt; 24</span><br><span class=\"line\">1 &lt;--&gt; 23</span><br><span class=\"line\">14 &lt;--&gt; 35</span><br><span class=\"line\">2 &lt;--&gt; 19</span><br><span class=\"line\">17 &lt;--&gt; 33</span><br><span class=\"line\">3 &lt;--&gt; 32</span><br><span class=\"line\">8 &lt;--&gt; 27</span><br><span class=\"line\">13 &lt;--&gt; 31</span><br><span class=\"line\">0 &lt;--&gt; 18</span><br><span class=\"line\">7 &lt;--&gt; 20</span><br><span class=\"line\">5 &lt;--&gt; 28</span><br><span class=\"line\">12 &lt;--&gt; 30</span><br></pre></td></tr></table></figure>\n<p>Absolutely this thing will help but we still didn’t know how this text file will help us! Let’s understand the explanation putted on the other frames.</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/377.png\" alt=\"\"></p>\n<p>The author told us that he split the image to many slices and put each slice in an empty unique image!!! We get it! The random lines are tiny pieces of unique image!</p>\n<p>But how can we collect this slice and re-order them to get the original? The lines are ordered randomly? Let’s think.</p>\n<h3 id=\"collect-the-pieces-and-recover-the-orginal-image\"><a class=\"markdownIt-Anchor\" href=\"#collect-the-pieces-and-recover-the-orginal-image\">#</a> collect the pieces and recover the orginal image</h3>\n<p>The solution is simple. That’s assume that the white color have a  <code>0 value</code>  and the black color have  <code>1 value</code> . We can sum the pixels of all the images with this concept to recover the image, right?</p>\n<blockquote>\n<p>We know that our image size is 720x720 (The resolution of our video) and from our extracted images we know that we have 360 images that splitted to slices. which mean that every line present 2px (width) from the original image.</p>\n</blockquote>\n<p>Take a look at this script then!</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">img=Image.new(<span class=\"string\">&#x27;1&#x27;</span>,(<span class=\"number\">720</span>,<span class=\"number\">720</span>),<span class=\"number\">255</span>)</span><br><span class=\"line\">imgpixs=img.load()</span><br><span class=\"line\"><span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">360</span>):</span><br><span class=\"line\">    name=<span class=\"string\">&quot;0&quot;</span>*(<span class=\"number\">3</span>-<span class=\"built_in\">len</span>(<span class=\"built_in\">str</span>(n+<span class=\"number\">1</span>)))+<span class=\"built_in\">str</span>(n+<span class=\"number\">1</span>)+<span class=\"string\">&quot;.png&quot;</span></span><br><span class=\"line\">    image=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;data/&quot;</span>+name)</span><br><span class=\"line\">    image_pixs=image.load()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Image Number : &quot;</span>,n)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">720</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">720</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> image_pixs[i,j]!=<span class=\"number\">255</span>:</span><br><span class=\"line\">                imgpixs[i,j]=image_pixs[i,j]</span><br><span class=\"line\"></span><br><span class=\"line\">img.save(<span class=\"string\">&quot;Recovered.png&quot;</span>)</span><br></pre></td></tr></table></figure>\n<p>In this script we collect all the black pixels and ignore the white pixels. Because we generate a white image and we will fill it with the black color. Let’s recover the image now!!</p>\n<p>Bingo! There is a progress, we got this image!</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/recoverd.png\" alt=\"\"></p>\n<p>Oh god! It’s a broken QR code. How can we deal with this thing. Oh yeah! We have another clue! The author left this hint for us!</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/381.png\" alt=\"\"></p>\n<p>Oh cool! The author split the QRCode to small square and shuffle them in random order! We need to recover them. The squares are numeroted from 0 to n-1 pieces. This order will help us. Now We get the utility of the pastebin link!</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">6 &lt;--&gt; 29</span><br><span class=\"line\">15 &lt;--&gt; 25</span><br><span class=\"line\">11 &lt;--&gt; 34</span><br><span class=\"line\">10 &lt;--&gt; 24</span><br><span class=\"line\">1 &lt;--&gt; 23</span><br><span class=\"line\">14 &lt;--&gt; 35</span><br><span class=\"line\">2 &lt;--&gt; 19</span><br><span class=\"line\">17 &lt;--&gt; 33</span><br><span class=\"line\">3 &lt;--&gt; 32</span><br><span class=\"line\">8 &lt;--&gt; 27</span><br><span class=\"line\">13 &lt;--&gt; 31</span><br><span class=\"line\">0 &lt;--&gt; 18</span><br><span class=\"line\">7 &lt;--&gt; 20</span><br><span class=\"line\">5 &lt;--&gt; 28</span><br><span class=\"line\">12 &lt;--&gt; 3</span><br></pre></td></tr></table></figure>\n<p>This is will help us how re-order the QRCode. Let’s take a deep look now the the broken QRCode!.</p>\n<p>The QRCode is splitted by 6 in width and 6 in height. So each piece’s size is 120x120. And we have 36 pieces. It’s impossible to recover the image without the help of pastebin link. Let’s take this line for example  <code>0 &lt;--&gt; 18</code> , this link told us that the author switch the 1st piece with the 19th piece. (We Start counting from 0 due to the explanation). So we need to write a script that can order this QRCode! We need to recover it!</p>\n<p>Let’s put the content of the pastebin inside a textfile named  <code>help.txt</code>  and start write our solver.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">W_SPLIT=<span class=\"number\">6</span></span><br><span class=\"line\">H_SPLIT=<span class=\"number\">6</span></span><br><span class=\"line\"></span><br><span class=\"line\">ASSEMBLED_IMAGE=<span class=\"string\">&quot;Assembled.png&quot;</span></span><br><span class=\"line\">SPLITTED_IMAGE=<span class=\"string\">&quot;Recovered.png&quot;</span></span><br><span class=\"line\">image= Image.<span class=\"built_in\">open</span>(SPLITTED_IMAGE)</span><br><span class=\"line\">width, height = image.size</span><br><span class=\"line\">pixels = image.load()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">change_chunk</span>(<span class=\"params\">index1,index2</span>):</span><br><span class=\"line\">    pos1=[]</span><br><span class=\"line\">    pos1.append(index1 % W_SPLIT)</span><br><span class=\"line\">    pos1.append(index1 // W_SPLIT)</span><br><span class=\"line\">    pos2=[]</span><br><span class=\"line\">    pos2.append(index2 % W_SPLIT)</span><br><span class=\"line\">    pos2.append(index2 // W_SPLIT)</span><br><span class=\"line\">    height_chunk=height // H_SPLIT</span><br><span class=\"line\">    width_chunk= width // W_SPLIT</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span> (width_chunk):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span> (height_chunk):</span><br><span class=\"line\">            aux= pixels[pos1[<span class=\"number\">0</span>]*width_chunk+i,pos1[<span class=\"number\">1</span>]*height_chunk+j]</span><br><span class=\"line\">            pixels[pos1[<span class=\"number\">0</span>]*width_chunk+i,pos1[<span class=\"number\">1</span>]*height_chunk+j]= pixels[pos2[<span class=\"number\">0</span>]*width_chunk+i,pos2[<span class=\"number\">1</span>]*height_chunk+j]</span><br><span class=\"line\">            pixels[pos2[<span class=\"number\">0</span>]*width_chunk+i,pos2[<span class=\"number\">1</span>]*height_chunk+j]= aux</span><br><span class=\"line\"></span><br><span class=\"line\">data=<span class=\"built_in\">open</span>(<span class=\"string\">&quot;help.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>).read().split(<span class=\"string\">&quot;\\n&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(data)-<span class=\"number\">1</span>):</span><br><span class=\"line\">    position=data[i].split(<span class=\"string\">&quot;&lt;--&gt;&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(position)</span><br><span class=\"line\">    change_chunk(<span class=\"built_in\">int</span>(position[<span class=\"number\">0</span>]),<span class=\"built_in\">int</span>(position[<span class=\"number\">1</span>]))</span><br><span class=\"line\"></span><br><span class=\"line\">image.save(ASSEMBLED_IMAGE)</span><br></pre></td></tr></table></figure>\n<p>Yeah It works fine!! We recover the QRCode!</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/Assembled.png\" alt=\"\"></p>\n<p>But something is wrong here! It sills broken and We can’t scan it 😦. But why? are we have any problem with our solver?</p>\n<p>Ah No. I get it! We have 36 pieces and each line from  <code>help.txt</code>  have correspond to 2 pieces! So we have to find 18 lines, right ?</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@Securinets:~$ <span class=\"built_in\">wc</span> -l help.txt</span><br><span class=\"line\">15</span><br></pre></td></tr></table></figure>\n<p>Oh no we have 15 lines, So we have 6 pieces we need to re-order them by ourselves! Now I get why the Author said Help  <code>LITTLE BIIT</code> . He left the 6 pieces to deal with it.</p>\n<p>In this case we need to do a bruteforce to all the combinasions. We have 6 pieces, so we have 6! possibility<br>\nand 6! = 720 which is possible to deal with it using a python script. Let’s re-order the 6 pieces each time and try to scan the QRCode. Once the QRCode is readable, we will stop our program!</p>\n<p>Let’s get the flag now !!! Let’s DO IT NOW! We’re so close!</p>\n<p>So the 1st thing that we need to do it is that we need to get the index of missed pieces. The  <code>help.txt</code>  is the key!</p>\n<p>Let’s generate an array that have the order (index) of the missed pieces. Then we use our  <code>change_chunck()</code>  method and try all the combinaisons using the  <code>itertools</code> . Finally try to scan the QRCode each time using the  <code>qrtools</code></p>\n<p>Let’s install the qrtools first</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@Securinets:~$ sudo apt-get install python3-qrtools</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Now let’s write down our last script (I Hope) :</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"><span class=\"keyword\">import</span> qrtools</span><br><span class=\"line\"><span class=\"keyword\">from</span> itertools <span class=\"keyword\">import</span> permutations</span><br><span class=\"line\"></span><br><span class=\"line\">qr=qrtools.QR()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">missed_data</span>():</span><br><span class=\"line\">    not_missed=[]</span><br><span class=\"line\">    data=<span class=\"built_in\">open</span>(<span class=\"string\">&quot;help.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>).read().split(<span class=\"string\">&quot;\\n&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(data)-<span class=\"number\">1</span>):</span><br><span class=\"line\">        position=data[i].split(<span class=\"string\">&quot;&lt;--&gt;&quot;</span>)</span><br><span class=\"line\">        not_missed.append(<span class=\"built_in\">int</span>(position[<span class=\"number\">0</span>]))</span><br><span class=\"line\">        not_missed.append(<span class=\"built_in\">int</span>(position[<span class=\"number\">1</span>]))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(not_missed)</span><br><span class=\"line\">    missed=[]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">36</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (i <span class=\"keyword\">in</span> not_missed):</span><br><span class=\"line\">            missed.append(i)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> missed</span><br><span class=\"line\"></span><br><span class=\"line\">chuncks=missed_data()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(chuncks)</span><br><span class=\"line\">H_SPLIT=<span class=\"number\">6</span></span><br><span class=\"line\">W_SPLIT=<span class=\"number\">6</span></span><br><span class=\"line\">SPLITTED_IMAGE=<span class=\"string\">&quot;Assembled.png&quot;</span></span><br><span class=\"line\">height,width=<span class=\"number\">720</span>,<span class=\"number\">720</span></span><br><span class=\"line\"></span><br><span class=\"line\">permutations=<span class=\"built_in\">list</span>(permutations(chuncks,<span class=\"number\">6</span>))</span><br><span class=\"line\">image=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;Assembled.png&quot;</span>)</span><br><span class=\"line\">pixels=image.load()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">change_chunk</span>(<span class=\"params\">index1,index2</span>):</span><br><span class=\"line\">    pos1=[]</span><br><span class=\"line\">    pos1.append(index1 % W_SPLIT)</span><br><span class=\"line\">    pos1.append(index1 // W_SPLIT)</span><br><span class=\"line\">    pos2=[]</span><br><span class=\"line\">    pos2.append(index2 % W_SPLIT)</span><br><span class=\"line\">    pos2.append(index2 // W_SPLIT)</span><br><span class=\"line\">    height_chunk=height // H_SPLIT</span><br><span class=\"line\">    width_chunk= width // W_SPLIT</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span> (width_chunk):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span> (height_chunk):</span><br><span class=\"line\">            aux= pixels[pos1[<span class=\"number\">0</span>]*width_chunk+i,pos1[<span class=\"number\">1</span>]*height_chunk+j]</span><br><span class=\"line\">            pixels[pos1[<span class=\"number\">0</span>]*width_chunk+i,pos1[<span class=\"number\">1</span>]*height_chunk+j]= pixels[pos2[<span class=\"number\">0</span>]*width_chunk+i,pos2[<span class=\"number\">1</span>]*height_chunk+j]</span><br><span class=\"line\">            pixels[pos2[<span class=\"number\">0</span>]*width_chunk+i,pos2[<span class=\"number\">1</span>]*height_chunk+j]= aux</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;[-] Trying to fix the QRCode and Getting the flag ...&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(permutations)):</span><br><span class=\"line\">    comb=<span class=\"built_in\">list</span>(permutations[i])</span><br><span class=\"line\">    change_chunk(comb[<span class=\"number\">0</span>],comb[<span class=\"number\">1</span>])</span><br><span class=\"line\">    change_chunk(comb[<span class=\"number\">2</span>],comb[<span class=\"number\">3</span>])</span><br><span class=\"line\">    change_chunk(comb[<span class=\"number\">4</span>],comb[<span class=\"number\">5</span>])</span><br><span class=\"line\">    image.save(<span class=\"string\">&quot;Final.png&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> qr.decode(<span class=\"string\">&quot;Final.png&quot;</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(qr.data)</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure>\n<p>And we got the flag as an output Here!!! BINGO! We get the flag!</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/finally.png\" alt=\"\"></p>\n<p>And of course the QRCode is saved! And this is our QRCode!</p>\n<p><img data-src=\"https://github.com/4n6nk8s/quals-2023-write-ups/raw/main/Raf-Hide/Final.png\" alt=\"\"></p>\n<blockquote Every_Fr4Me_H4S_HiS_own_S7ory=\"\">\n<p>The Final flag is : Securinets</p>\n</blockquote>\n<h2 id=\"couch-potato\"><a class=\"markdownIt-Anchor\" href=\"#couch-potato\">#</a> Couch Potato</h2>\n<p><img data-src=\"https://i.imgur.com/jHut52F.png\" alt=\"\"></p>\n<p>It’s past one, I was probably sleeping in front of my screen, I’m not even sure if I was awake for a bit or not, I’m not even sure if I’m dreaming or not… All I know is that I left the device on my favorite channel and that piece of crap failed me. Agh I need to fix it now. It is no longer responding to the commands I give it, and it is no longer showing my favorite channel! I hate my life, can you help me fix it?</p>\n<p>I am looking for three stuff:</p>\n<ul>\n<li><em>What nonsense was I watching the night the device failed me?</em></li>\n<li><em>I might need the Up and Down key codes in NEC 32-bit format?</em></li>\n<li><em>The expiration date of my IPTV subscription.</em></li>\n</ul>\n<p>Flag formal: <strong>Securinets{show_name_00UP1234_DOWN1234_YYYYMMDD}</strong></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9hZG1pZGEwdWk=\">adm &amp; mida0ui</span></p>\n<h3 id=\"attachment-2\"><a class=\"markdownIt-Anchor\" href=\"#attachment-2\">#</a> Attachment</h3>\n<p>A file called  <code>dump.bin</code>  was provided in a zip. Weighing 8 MB. Dating back to February the 1st, 2020. 1:07 AM.</p>\n<p>Another file is what seems to be an updated firmware for the device,  <code>Firmware.bin</code>  weighing 4 MB. And dating back to August the 25th, 2020.</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2RyaXZlL2ZvbGRlcnMvMVRHTkFPV0taWmJDelp1Vklta2xBMThJSF9jVXZ0a055P3VzcD1zaGFyaW5n\">Download Link</span></p>\n<h3 id=\"analysis\"><a class=\"markdownIt-Anchor\" href=\"#analysis\">#</a> Analysis</h3>\n<p>A Couch potato is a lazy guy that sits in front of the TV screen, indicating that we are dealing with a console, set-top-box STB or Digital Video Recorder DVR and not a PCI card satellite/Tuner card or a computer. The user mentioned that he was watching his favorite channel when he fall asleep which make it more likely an STB, or a receiver for simplicity.<br>\nThis also means that the show name we are looking for was broadcasted in his favorite channel.</p>\n<p>The user also mentioned that the device failed him, which means that the device is not responding to the commands he is sending to it. Kind of talking about a control unit, or that’s clearly a remote control that has some keys malfunctioning, specifically the UP and DOWN arrow keys as we know.</p>\n<p>On other hand, the user is suspecting that the IPTV subscription was the thing behind the interruption of his channel. This means that the IPTV subscription was a service provided by the device itself or maybe a third party service. This also means that the STB we’re dealing with is a hybrid device, meaning that it can receive satellite signals and also IPTV, making it a 2nd generation STB and there are plenty in the market today, for third world countries.</p>\n<p>However, the user could be mistaken as the channels that you can shortlist in the favorites are more likely to be satellite channels, hence the IPTV subscription is not the reason behind the interruption of his favorite channel rather than the satellite signal itself or the cardsharing service he is using.</p>\n<p>With all that in mind, we can start our information gathering phase.</p>\n<h3 id=\"information-gathering\"><a class=\"markdownIt-Anchor\" href=\"#information-gathering\">#</a> Information Gathering</h3>\n<p>TL;DR.</p>\n<p>The thing is devices like this are hard to find in UK, Europe and the US. Unlike Africa and Asia. That’s because in European countries and the US, they are mostly banned due to the fact that they are used for cardsharing and IPTV piracy. However, in Africa and Asia, they are still widely used and sold.</p>\n<p>So where to look? These devices are not open source nor they have some kind of documentation is to where to look in their ROMs. Satellite forums, subreddits, and Facebook groups are good resources and some deep search would yield some useful tools and details to deal with dump. We kind of need to know how the memory is splitted. The file is indeed a ROM/EEPROM snapshot, so it has a mapping of the memory. We just need to know where the information part is, channel list is, and applications or services are.</p>\n<p>The mapping generally includes the following:</p>\n<ul>\n<li>Bootloader</li>\n<li>Kernel or maincode</li>\n<li>User data</li>\n<li>Menu</li>\n<li>…</li>\n</ul>\n<p>Each at specific offsets and specific lengths. The user data is the most important part as it contains the channel list.</p>\n<p>Keep in mind that if the IPTV subscription was provided by the device itself, then the expiration date could be stored in the device itself or their renewal website. If the IPTV subscription was provided by a third party service, then the expiration date is stored in the third party service database or user panel. In both cases, we need to find the device serial number or MAC address to be able to identify the device and the user. I believe that how they are likely to be stored in the memory dump rather than a plain expiration date.</p>\n<h3 id=\"resources\"><a class=\"markdownIt-Anchor\" href=\"#resources\">#</a> Resources</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2F0ZWxsaXRlcy5jby51ay9mb3J1bXMv\">https://www.satellites.co.uk/forums/</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yL3NhdGVsbGl0ZS8=\">https://www.reddit.com/r/satellite/</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHVuaXNpYS1zYXQuY29tL2ZvcnVtcy8=\">https://www.tunisia-sat.com/forums/</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zYXQtdW5pdmVyc2UuY29tLw==\">https://sat-universe.com/</span></li>\n</ul>\n<h3 id=\"tools\"><a class=\"markdownIt-Anchor\" href=\"#tools\">#</a> Tools</h3>\n<p>HexWorkshop / HxD Editor is a good tool to start with. It is a hex editor that can be used to view and edit files in hexadecimal and binary formats. It is a good tool to start with as it can be used to view the memory dump and search for strings. It can also be used to search for patterns and hex values.</p>\n<h3 id=\"writeup-2\"><a class=\"markdownIt-Anchor\" href=\"#writeup-2\">#</a> Writeup</h3>\n<p>First, let’s investigate the dump file.</p>\n<p><code>NCRCBootloader</code>  is the start point, which is the bootloader used for these chipsets as indicated in the Hex Editor screen:</p>\n<ul>\n<li>ALI3329</li>\n<li>ALI3606</li>\n<li>ALI3601</li>\n<li>ALI3511</li>\n<li>ALI3510</li>\n<li>ALI3516</li>\n<li>ALI3618</li>\n<li>ALI3821</li>\n</ul>\n<p><img data-src=\"https://i.imgur.com/vSB9IGX.png\" alt=\"\"></p>\n<p>Devices with those chipset have these brands <em>Starsat, Sunplus, Tiger, StarMax, Geant, Mediastar, QMAX, AzAmerica, Samsat and many more…</em></p>\n<p>And all of their built-in subscriptions are part of <strong>Gosat</strong>.</p>\n<p>Now, to actually find the specific brand and model, we need to inspect the firmware update file.</p>\n<p>To clear things up, the memory dump serves for user data mainly the channels and services as I said while the firmware update file will indicate the remote control being used.</p>\n<p>The memory dump is a mapping and can be splitted manually and further investigated. However the firmware is encrypted, you can tell by a first glance, no strings or something in there, and can’t help us much to delve into the remote control unit in use.</p>\n<p>Time to google for a way to decrypt such chipset firmware. Let’s use the keyword  <code>ALI3329</code>  or  <code>ALI3511</code>  as they are the most common chipset used in these devices and combine the search with decrypt or unpack tool.</p>\n<p>For example:</p>\n<p><img data-src=\"https://i.imgur.com/DfscXB4.png\" alt=\"\"></p>\n<p>And in Arabic:</p>\n<p><img data-src=\"https://i.imgur.com/rdG9k09.png\" alt=\"\"></p>\n<p>Using the tool, we determine that the model is SR-2000HD HYPER and the remote control is SR-2000HD HYPER. Hence the brand is Starsat.</p>\n<p><img data-src=\"https://i.imgur.com/uWfBYaJ.png\" alt=\"\"></p>\n<p>The unpack and repack features are used to decrypt and extract parts of the firmware like the bootloader, maincode, user data if any was supplied by the manufacturer, the menu, the remote, and sometimes a softcam (that’s out of our scope today, maybe in another challenge!). And the repack to insert modified parts and RSA encrypt the whole thing again. Like for instance, we can insert the main menu (including themes and applications) or the remote control unit of a different model or brand and repack it to be used with the device we have, as long as they are using the very same chipset. Well this time, rest assured it is the Hyper remote control and when we talk about key code we mean the IR Infrared key code.</p>\n<p>So the whole memory dump thing and the firmware kind of contain similar stuff at least, one being encrypted and the other not.</p>\n<p>See here, the content of the folder when unpacked.</p>\n<p><img data-src=\"https://i.imgur.com/P8IBsRt.png\" alt=\"\"></p>\n<p>So why not, giving the dump a try and unpack it as well, we are chasing the user data part anyway. And the tool might very much help. Otherwise I will show how to proceed manually knowing the offsets and lengths found on a forum.</p>\n<h3 id=\"finding-the-show\"><a class=\"markdownIt-Anchor\" href=\"#finding-the-show\">#</a> Finding the show</h3>\n<p>As we said before, we can deal with this part either using the tool or manually.<br>\nWell, the tool was able to yield this:</p>\n<p><img data-src=\"https://i.imgur.com/f1fon6N.png\" alt=\"\"></p>\n<p>Very nice, we can see  <code>database.sdx</code>  file there!</p>\n<p>Well, to proceed manullay you need to know the offsets and lengths beforehand.<br>\nThis is what we meant:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">Name : Bootloader.bin</span><br><span class=\"line\">SIZE : 128,00 KB</span><br><span class=\"line\">CRC : 0x00AF7F6C</span><br><span class=\"line\">offset : 0x00000128</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">Name : maincode.bin</span><br><span class=\"line\">SIZE : 3,25 MB</span><br><span class=\"line\">CRC : 0x19E8C348</span><br><span class=\"line\">offset : 0x00020128</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">Name : menu.bin</span><br><span class=\"line\">SIZE : 1,38 MB</span><br><span class=\"line\">CRC : 0x10934143</span><br><span class=\"line\">offset : 0x00360128</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">Name : Database.sdx</span><br><span class=\"line\">SIZE : 9,80 KB</span><br><span class=\"line\">CRC : 0x00146C71</span><br><span class=\"line\">offset : 0x004C0128</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">Name : softcam.bin</span><br><span class=\"line\">SIZE : 42,38 KB</span><br><span class=\"line\">CRC : 0x008D5F15</span><br><span class=\"line\">offset : 0x004C2860</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">Name : sattp.bin</span><br><span class=\"line\">SIZE : 12,54 KB</span><br><span class=\"line\">CRC : 0x00097FDA</span><br><span class=\"line\">offset : 0x004CD1E8</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br><span class=\"line\">Name : Padding.bin</span><br><span class=\"line\">SIZE : 522,06 KB</span><br><span class=\"line\">CRC : 0x040E1F6B</span><br><span class=\"line\">offset : 0x004D040C</span><br><span class=\"line\">++++++++++++++++++++++++++++++++++++++</span><br></pre></td></tr></table></figure>\n<p>Found here: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHVuaXNpYS1zYXQuY29tL2ZvcnVtcy90aHJlYWRzLzMyNDI3NjEvcGFnZS00Nw==\">https://www.tunisia-sat.com/forums/threads/3242761/page-47</span></p>\n<p>We know  <code>database.sdx</code>  holds the user data meaning the channels. sattp is another file that holds the different satellites and their frequencies aka transponders.</p>\n<p>When we open the file in a hex editor, We can’t read any useful information out of it. This means that there should be a tool in place to view and edit the channels for the specific chipset family we are dealing with as the file seems highly compressed.</p>\n<p>Here’s a view from hex editor first.</p>\n<p>Starts off like this</p>\n<p><img data-src=\"https://i.imgur.com/7FHWF6K.png\" alt=\"\"></p>\n<p>And ends padded with 0xFF</p>\n<p><img data-src=\"https://i.imgur.com/xqvWPxc.png\" alt=\"\"></p>\n<p>Let’s google a bit…</p>\n<p><img data-src=\"https://i.imgur.com/P5bXWY4.png\" alt=\"\"></p>\n<p>We got this</p>\n<p><img data-src=\"https://i.imgur.com/hVzUWC9.png\" alt=\"\"></p>\n<p>When trying to first open the database, we got this error message</p>\n<p><img data-src=\"https://i.imgur.com/ASWzJB9.png\" alt=\"\"></p>\n<p>And the issue is that the Userdata has a static size as indicated before. As the receiver’s capacity fits a maximum of 6100 channels. So the database file is padded with 0xFF to reach the maximum size. Let’s get rid of the padded data and try again…</p>\n<p><img data-src=\"https://i.imgur.com/NUIk82u.png\" alt=\"\"></p>\n<p>Now, it’s working like charm, and I already see some familiar TV channels on Astra 1 (19.2 East).</p>\n<p>Let’s expand the favorites section</p>\n<p><img data-src=\"https://i.imgur.com/AmkpQPE.png\" alt=\"\"></p>\n<p>And there is Sky Sports Main Event, UK-based sports channel that is part of BSkyB or Sky Group, pay-television channel and availble for satellite subsribers via Eurobird 1, Astra 2 (28.2 East). Sky Sports Main Event broadcasts the biggest events of sports in the UK.</p>\n<p>Now, great work to reach this point, but we are not done yet. We need to find the right show at that past date, meaning at 1:07 AM on February the 1st, 2020.</p>\n<p>Well, Sky TV Guide won’t keep such data for more than a week or two, so we need to find another way.</p>\n<p>Guess you know what we mean, what else than the way back machine!</p>\n<p>Head over to <span class=\"exturl\" data-url=\"aHR0cDovL2FyY2hpdmUub3Jn\">archive.org</span> and submit the link for the Sky TV Guide and try to narrow your search to a date that’s equal or close to the date in question, as shown below!</p>\n<p><img data-src=\"https://i.imgur.com/B5scqzJ.png\" alt=\"\"></p>\n<p>And that is the first part of the flag:  <code>live_rugby_7's</code>  or  <code>live_rugby_7s</code></p>\n<h3 id=\"finding-the-keycodes\"><a class=\"markdownIt-Anchor\" href=\"#finding-the-keycodes\">#</a> Finding the keycodes</h3>\n<p>We know it is Starsat SR-2000HD Hyper’s remote control, well unless you have the same remote control or probably a remote of the same brand and an Arduino card embedded with an IR receiver, you will need to improvise! Like check online there GitHub repos that keep track of IR key codes for different remotes. Or you can use a forum like <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmVtb3RlY2VudHJhbC5jb20v\">https://www.remotecentral.com/</span> to find the key codes for the remote control.</p>\n<p>However for this part, we will use an Android app like IRplus or any alternatives and pick the device in question from the list then head over to check the keys, we will provide screenshots for what we’ve found. Since it is the simplest and fastest way.</p>\n<p>This is the LIRC protcol of Starsat <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saXJjLnNvdXJjZWZvcmdlLm5ldC9yZW1vdGVzL3N0YXJzYXQvMTIw\">https://lirc.sourceforge.net/remotes/starsat/120</span></p>\n<p>We are looking for NEC, so we found an app for that.</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9pcnBsdXMtcmVtb3RlLmdpdGh1Yi5pby8=\">net.binarymode.android.irplus</span></p>\n<ol>\n<li>Selecting the remote control from the list:</li>\n</ol>\n<p><img data-src=\"https://i.imgur.com/3hjuMYS.png\" alt=\"\"></p>\n<ol start=\"2\">\n<li>Exporting the remote config and checking the Channel Up arrow and Channel Down arrow</li>\n</ol>\n<p><img data-src=\"https://i.imgur.com/lsXXO6K.png\" alt=\"\"></p>\n<p>And that is the second part of the flag:  <code>00ff30cf_00ff8877</code></p>\n<p>we can make sure that is the correct format using a website like <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueWFtYWhhLmNvbS95cGFiL2lyaGV4X2NvbnZlcnRlci5hc3A=\">https://www.yamaha.com/ypab/irhex_converter.asp</span><br>\nconverting NEC 32-bit to Pronto hex format (RAW HEX) and then to global caché to see the full sendIR command…</p>\n<h3 id=\"finding-the-expiration-date\"><a class=\"markdownIt-Anchor\" href=\"#finding-the-expiration-date\">#</a> Finding the expiration date</h3>\n<p>Now for the fun part, if you dig around the web about Starsat 2000 Hyper you will end up with one official built in service, Apollo that offers IPTV as well as VOD Video on Demand.</p>\n<p>And there is an online service to renew and check your current subscription by just providing the serial number.</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5yZW5ld2JveC5uZXQvaW5kZXgucGhw\">www.renewbox.net</span></p>\n<p>The serial number in most cases is a long number like consists of maybe more than 10 digits. And it can’t be in the firmware since it is released to the public to update their devices. So it must be within the memory of the device itself.</p>\n<p>Let’s grep that easily!</p>\n<p><img data-src=\"https://i.imgur.com/XmWhATI.png\" alt=\"\"></p>\n<p>And there it is, the serial number, let’s query the IPTV validity.</p>\n<p><img data-src=\"https://i.imgur.com/lTGDuFS.png\" alt=\"\"></p>\n<p>And the last part of the flag is  <code>20141105</code></p>\n<h3 id=\"final-words\"><a class=\"markdownIt-Anchor\" href=\"#final-words\">#</a> Final Words</h3>\n<p>Flag: <strong>Securinets{live_rugby_7s_00ff30cf_00ff8877_20141105}</strong></p>\n<p>GGs <strong>th3_r0n1ns</strong> for solving this challenge</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2023/03/23/Writeups/ncsc2023/",
            "url": "http://example.com/2023/03/23/Writeups/ncsc2023/",
            "title": "NCSC'2023 Writeup Challenges",
            "date_published": "2023-03-23T10:33:37.000Z",
            "content_html": "<p>The National Cyber Security Congress (NCSC) is a three-day event that brings together cyber security enthusiasts and experts. The event features a wide range of activities, including workshops, talks, conferences, and two exciting CTF competitions.</p>\n<p><img data-src=\"https://imgur.com/LJslRYb.png\" alt=\"\"></p>\n<p>As a technical team member, I had the chance to create challenges in Kubernetes, Digital Forensics, Misc, Hardware, and Game Hacking categories.</p>\n<p>The NCSC CTF provided a unique opportunity for cyber security enthusiasts to demonstrate their problem-solving abilities, teamwork, and technical proficiency in a fun and competitive environment. Overall, the event was an exciting and rewarding experience for all involved.</p>\n<p>In this blog, I will share some write-ups that players have requested!</p>\n<h1 id=\"digital-forensics-mokni-seals\"><a class=\"markdownIt-Anchor\" href=\"#digital-forensics-mokni-seals\">#</a> Digital Forensics : Mokni &amp; Seals</h1>\n<p><img data-src=\"https://i.imgur.com/i231apB.png\" alt=\"\"></p>\n<p>We got a zip file! I bet that file is a memory dump! So i tried to run the volatility imageinfo plugin but it takes a long time. So I tried to figure out if this file is Linux memory dump or not!</p>\n<figure class=\"highlight bash\"><figcaption><span>linux or win ?</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raf@4n6nk8s: strings data.raw | grep <span class=\"string\">&quot;Linux version&quot;</span> </span><br><span class=\"line\">Linux version 5.8.0-43-generic (buildd@lcy01-amd64-018) (gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0, GNU ld (GNU Binutils <span class=\"keyword\">for</span> Ubuntu) 2.34) 49~20.04.1-Ubuntu SMP Fri Feb 5 09:57:56 UTC 2021 (Ubuntu 5.8.0-43.49~20.04.1-generic 5.8.18)</span><br></pre></td></tr></table></figure>\n<p>And yes it’s a Linux Memory dump! I guess its time to start finding/making a profile but let me check that is memory dump can be analyzed with a profile or not!</p>\n<figure class=\"highlight bash\"><figcaption><span>checking</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings data.raw | grep -i insmod       </span><br><span class=\"line\">sudo insmod ./lime-5.8.0-43-generic.ko path=../../Linux64.mem format=raw</span><br><span class=\"line\">sudo insmod ./lime-5.8.0-43-generic.ko <span class=\"string\">&quot;path=../../Linux64.mem format=raw&quot;</span></span><br><span class=\"line\">sudo insmod ./lime-5.8.0-43-generic.ko <span class=\"string\">&quot;path=../../Linux64.mem format=raw&quot;</span></span><br></pre></td></tr></table></figure>\n<p>Oh! The format is ram! which means that even if we get the correct profile volatility can’t analyze this memory dump! Strings time! The author want us to solve this mem dump using strings !</p>\n<p>Let’s try to figure out some command lines! Bash history! Let me show you this trick!</p>\n<figure class=\"highlight bash\"><figcaption><span>extract bash history</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings data.raw | grep -Ei <span class=\"string\">&quot;@*:~\\\\$&quot;</span>     </span><br><span class=\"line\">raf-square@ubuntu:~$ vim /etc/containers/registries.conf</span><br><span class=\"line\">raf-square@ubuntu:~$</span><br><span class=\"line\">raf-square@ubuntu:~$ <span class=\"built_in\">echo</span> <span class=\"string\">&quot;This Is My Secret&quot;</span> &gt; secret.txt</span><br><span class=\"line\">raf-square@ubuntu:~$</span><br><span class=\"line\">raf-square@ubuntu:~$ podman login -u $(<span class=\"built_in\">head</span> -n 2 secret.txt | <span class=\"built_in\">tail</span> -n 1 | awk <span class=\"string\">&#x27;&#123; print $4 &#125;&#x27;</span>) -p $(<span class=\"built_in\">head</span> -n 3 secret.txt | <span class=\"built_in\">tail</span> -n 1 | awk <span class=\"string\">&#x27;&#123; print $4 &#125;&#x27;</span>)</span><br><span class=\"line\">raf-square@ubuntu:~$ podman pull nginx</span><br><span class=\"line\">^Craf-square@ubuntu:~$ <span class=\"built_in\">cd</span> LiME/src/</span><br><span class=\"line\">raf-square@ubuntu:~$ vim /etc/containers/registries.conf</span><br><span class=\"line\">raf-square@ubuntu:~$</span><br><span class=\"line\">raf-square@ubuntu:~$ vim /etc/containers/registries.conf</span><br><span class=\"line\">raf-square@ubuntu:~$</span><br><span class=\"line\">u:~$ podman login -u $(<span class=\"built_in\">head</span> -n 2 secret.txt | <span class=\"built_in\">tail</span> -n 1 | awk <span class=\"string\">&#x27;&#123; print $4 &#125;&#x27;</span>) -p $(<span class=\"built_in\">head</span> -n 3 secret.txt | <span class=\"built_in\">tail</span> -n 1 | awk <span class=\"string\">&#x27;&#123; print $4 &#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p>Mmmm nice! now at least we got some commands and we got the user-name and host-name !<br>\nFrom these commands we can understand that the user edit  <code>/etc/containers/registries.conf</code> , then create a  <code>secret.txt</code> . Then logged in with podman using that secret.txt. But we don’t have any information about the content of the creds in these commands!.</p>\n<p>We have 2 methods to figure out what’s happen and get the creds!</p>\n<p>either running a strings and grepping on  <code>CMDLINE=podman login</code>  or grepping on  <code>This Is My Secret</code>  and check the lines before and after to see the content!</p>\n<figure class=\"highlight bash\"><figcaption><span>extract creds</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings data.raw | grep -Ei <span class=\"string\">&quot;CMDLINE=podman login&quot;</span>       </span><br><span class=\"line\">_CMDLINE=podman login -u 2ecf92b1-83a8-4355-8cb7-8354f4677894 -p fwO8Q~XTlBmpYoG43J~OusANA_azV02ZS3PuzaXb</span><br></pre></td></tr></table></figure>\n<p>OR</p>\n<figure class=\"highlight bash\"><figcaption><span>extract creds</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings data.raw | grep -Ei -C 2 <span class=\"string\">&quot;This Is My Secret&quot;</span> </span><br><span class=\"line\"> Documents  LiME         Music     Public      Templates</span><br><span class=\"line\">Desktop  Downloads  Linux64.mem  Pictures  secret.txt  Videos</span><br><span class=\"line\">raf-square@ubuntu:~$ <span class=\"built_in\">echo</span> <span class=\"string\">&quot;This Is My Secret&quot;</span> &gt; secret.txt</span><br><span class=\"line\">raf-square@ubuntu:~$</span><br><span class=\"line\">fctt</span><br><span class=\"line\">--</span><br><span class=\"line\">application/octet-stream</span><br><span class=\"line\">text/plain</span><br><span class=\"line\">This Is My Secret</span><br><span class=\"line\">Service principal ID: 2ecf92b1-83a8-4355-8cb7-8354f4677894</span><br><span class=\"line\">Service principal password: fwO8Q~XTlBmpYoG43J~OusANA_azV02ZS3PuzaXb</span><br><span class=\"line\">--</span><br></pre></td></tr></table></figure>\n<p>So the creds are  <code>2ecf92b1-83a8-4355-8cb7-8354f4677894:fwO8Q~XTlBmpYoG43J~OusANA_azV02ZS3PuzaXb</code></p>\n<p>But I didn’t think this is a normal creds for  <code>dockerhub</code>  or any public famous container registry! Espacially he pulled a container named nginx! I bet that nginx is a customized one and its a trick!</p>\n<p>Editing  <code>/etc/containers/registries.conf</code>  can confirm that change something! This configuration file used by the container runtime environment on Linux systems. This file specifies a list of container image registries that are trusted by the system and can be used to download container images.</p>\n<p>So let’s discover how to get the registry! Pulling nginx means he pulled the latest tag or at least he tried that! So let’s grep on  <code>nginx:latest</code></p>\n<figure class=\"highlight bash\"><figcaption><span>extract registry</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strings data.raw | grep -Ei <span class=\"string\">&quot;nginx:latest&quot;</span>  </span><br><span class=\"line\">Trying to pull qualsk8s.azurecr.io/nginx:latest...</span><br><span class=\"line\">Trying to pull qualsk8s.azurecr.io/nginx:latest...</span><br><span class=\"line\"><span class=\"string\">&quot;, &quot;</span>qualsk8s.azurecr.io/nginx:latest<span class=\"string\">&quot;) not found</span></span><br><span class=\"line\"><span class=\"string\">Trying to pull qualsk8s.azurecr.io/nginx:latest...</span></span><br><span class=\"line\"><span class=\"string\">Trying to pull qualsk8s.azurecr.io/nginx:latest...</span></span><br><span class=\"line\"><span class=\"string\">Trying to pull qualsk8s.azurecr.io/nginx:latest...</span></span><br></pre></td></tr></table></figure>\n<p>Bingo!  <code>qualsk8s.azurecr.io</code>  is the container registry! If you are an Azure guy you can get that from the previous step! when we get this output!</p>\n<figure class=\"highlight text\"><figcaption><span>creds</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Service principal ID: 2ecf92b1-83a8-4355-8cb7-8354f4677894</span><br><span class=\"line\">Service principal password: fwO8Q~XTlBmpYoG43J~OusANA_azV02ZS3PuzaXb</span><br></pre></td></tr></table></figure>\n<p>Ok it’s time to login and pull that image and run it!</p>\n<figure class=\"highlight bash\"><figcaption><span>login and pull</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker login qualsk8s.azurecr.io -u 2ecf92b1-83a8-4355-8cb7-8354f4677894 -p fwO8Q~XTlBmpYoG43J~OusANA_azV02ZS3PuzaXb </span><br><span class=\"line\"></span><br><span class=\"line\">docker pull nginx</span><br></pre></td></tr></table></figure>\n<p>After checking the image! I got that it’s a static web page so let’s run it!</p>\n<figure class=\"highlight bash\"><figcaption><span>run nginx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name chall -p 80:80 -d nginx </span><br></pre></td></tr></table></figure>\n<p>After running this container we got this web-page and guess what!! There is a flag icon! Let’s check it !<br>\n<img data-src=\"https://i.imgur.com/q3GSPiL.png\" alt=\"\"></p>\n<p>This flag icon lead you to this link  <code>https://pastebin.com/vjFtjMga</code>  which is protected pastebin<br>\nhow to get that password now! Let’s check the docker history!</p>\n<figure class=\"highlight bash\"><figcaption><span>docker history</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mohamed@RafSquare:~$ docker <span class=\"built_in\">history</span> qualsk8s.azurecr.io/nginx</span><br><span class=\"line\">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT</span><br><span class=\"line\">093f65335d3a   13 days ago   ENTRYPOINT [<span class=\"string\">&quot;nginx&quot;</span> <span class=\"string\">&quot;-g&quot;</span> <span class=\"string\">&quot;daemon off;&quot;</span>]         0B        buildkit.dockerfile.v0</span><br><span class=\"line\">&lt;missing&gt;      13 days ago   RUN /bin/sh -c <span class=\"built_in\">chmod</span> +r -R . <span class=\"comment\"># buildkit         563kB     buildkit.dockerfile.v0</span></span><br><span class=\"line\">&lt;missing&gt;      13 days ago   RUN /bin/sh -c <span class=\"built_in\">mv</span> password.txt .hidden.txt <span class=\"comment\">#…   11B       buildkit.dockerfile.v0</span></span><br><span class=\"line\">&lt;missing&gt;      13 days ago   COPY ./ ./ <span class=\"comment\"># buildkit                           563kB     buildkit.dockerfile.v0</span></span><br><span class=\"line\">&lt;missing&gt;      3 weeks ago   RUN /bin/sh -c <span class=\"built_in\">rm</span> -rf ./* <span class=\"comment\"># buildkit            0B        buildkit.dockerfile.v0</span></span><br><span class=\"line\">&lt;missing&gt;      3 weeks ago   WORKDIR /usr/share/nginx/html                   0B        buildkit.dockerfile.v0</span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"built_in\">set</span> -x     &amp;&amp; apkArch=<span class=\"string\">&quot;<span class=\"subst\">$(cat /etc…   29.2MB</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">&lt;missing&gt;      5 weeks ago   /bin/sh -c #(nop)</span>  ENV NJS_VERSION=0.7.9        0B</span></span><br><span class=\"line\"><span class=\"string\">&lt;missing&gt;      5 weeks ago   /bin/sh -c #(nop)  CMD [&quot;</span>nginx<span class=\"string\">&quot; &quot;</span>-g<span class=\"string\">&quot; &quot;</span>daemon…   0B</span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop)  STOPSIGNAL SIGQUIT           0B</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop)  EXPOSE 80                    0B</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop)  ENTRYPOINT [&quot;/docker-entr…   0B</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop) COPY file:e57eef017a414ca7…   4.62kB</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop) COPY file:abbcbf84dc17ee44…   1.27kB</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop) COPY file:5c18272734349488…   2.12kB</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop) COPY file:7b307b62e82255f0…   1.62kB</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"built_in\">set</span> -x     &amp;&amp; addgroup -g 101 -S …   4.45MB</span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop)  ENV PKG_RELEASE=1            0B</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop)  ENV NGINX_VERSION=1.23.3     0B</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop)  LABEL maintainer=NGINX Do…   0B</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop)  CMD [&quot;/bin/sh&quot;]              0B</span></span><br><span class=\"line\">&lt;missing&gt;      5 weeks ago   /bin/sh -c <span class=\"comment\">#(nop) ADD file:40887ab7c06977737…   7.05MB</span></span><br></pre></td></tr></table></figure>\n<p>And yes!! There is  <code>.hidden.txt</code>  that contain a password for sure ! let’s get that password!</p>\n<figure class=\"highlight bash\"><figcaption><span>docker exec</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">exec</span> -it 460fc5a977c5 <span class=\"built_in\">cat</span> .hidden.txt</span><br><span class=\"line\">vT56X19Qu3</span><br></pre></td></tr></table></figure>\n<p>We got this pastebin !</p>\n<p><img data-src=\"https://i.imgur.com/N4B9j4z.png\" alt=\"\"></p>\n<p>This is will lead us to word sheet that contains a hex data!</p>\n<p><img data-src=\"https://i.imgur.com/P0hrYhX.png\" alt=\"\"></p>\n<p>The hex data seams introducing spaces and tabs! I don’t care let’s decode it and see what’s will be!<br>\nI’ll try to convert it to a file using  <code>xxd</code>  and import that file to <span class=\"exturl\" data-url=\"aHR0cDovL2Rjb2RlLmZy\">dcode.fr</span></p>\n<figure class=\"highlight bash\"><figcaption><span>xxd</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xxd -r -p hex.txt &gt; result.txt</span><br></pre></td></tr></table></figure>\n<p>Yeah it’s a file that contains a lot of spaces! Its whitespaces</p>\n<p>Bingo! This is the flag  <code>Securinets&#123;208e5976c9d654e47d73ef44cabc272d&#125;</code></p>\n<h1 id=\"digital-forensics-recover-my-work\"><a class=\"markdownIt-Anchor\" href=\"#digital-forensics-recover-my-work\">#</a> Digital Forensics: Recover my Work 😦</h1>\n<p><img data-src=\"https://i.imgur.com/DWMzUMB.png\" alt=\"\"></p>\n<p>We got a file named  <code>memory.dmp</code> . It’s a memory dump for sure! Let’s run imageinfo plugin to get our profile!</p>\n<figure class=\"highlight bash\"><figcaption><span>profile</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vol.py -f memory.dmp imageinfo</span><br><span class=\"line\">Volatility Foundation Volatility Framework 2.6.1</span><br><span class=\"line\">INFO    : volatility.debug    : Determining profile based on KDBG search...</span><br><span class=\"line\">WARNING : volatility.debug    : Alignment of WindowsCrashDumpSpace64 is too small, plugins will be extremely slow</span><br><span class=\"line\">WARNING : volatility.debug    : Alignment of WindowsCrashDumpSpace64 is too small, plugins will be extremely slow</span><br><span class=\"line\">WARNING : volatility.debug    : Alignment of WindowsCrashDumpSpace64 is too small, plugins will be extremely slow</span><br><span class=\"line\">WARNING : volatility.debug    : Alignment of WindowsCrashDumpSpace64 is too small, plugins will be extremely slow</span><br></pre></td></tr></table></figure>\n<p>But sadly we got this type of outpût! I bet that the suggested profile (in case it exists) will be wrong! Let’s know the exact profile with my own way! Let’s run strings the file and grep “service pack”</p>\n<figure class=\"highlight text\"><figcaption><span>Extract info</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Windows 7 Professional, 64-bit Service Pack 1 (Build 7601)</span><br></pre></td></tr></table></figure>\n<p>Cool, This build and service pack is supported by  <code>Win7SP1x64</code> ! I guess that imageinfo plugin got problem because the iso is customizated !</p>\n<p>Let’s start checking our memory dump! First thing should be checked is the running processes! I’ll use pstree for that thing!</p>\n<p><img data-src=\"https://i.imgur.com/1xA56pZ.png\" alt=\"\"></p>\n<p>MMMM intersting! Found chrome, firefox, outlook and RDP opened! what a trip! After digging on chrome history and firefox, I found rabbit holes and some links to wordlists! Bad Author (Me).</p>\n<p>Checking the consoles plugin too. Another rabbit hole! rabbit hole everywhere!</p>\n<p>It’s time to check and figure out that outlook process!<br>\nOutlook save the mails as pst or ost files! These files contains the mails data such as the message, attachements, sender/receiver information!</p>\n<p>So let’s try to extract these files !</p>\n<figure class=\"highlight bash\"><figcaption><span>check files</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vol.py -f memory.dmp --profile=Win7SP1x64 filescan | grep -i pst$</span><br><span class=\"line\">0x000000007d81a490      5      5 RW-r-- \\Device\\HarddiskVolume2\\Users\\Raf_Square\\AppData\\Local\\Microsoft\\Outlook\\Outlook.pst</span><br><span class=\"line\">0x000000007dd59340      5      5 RW-r-- \\Device\\HarddiskVolume2\\Users\\Raf_Square\\AppData\\Local\\Microsoft\\Outlook\\Work Progress.pst</span><br><span class=\"line\">0x000000007dd73220      1      0 R--rw- \\Device\\HarddiskVolume2\\Users\\Raf_Square\\AppData\\Local\\Microsoft\\Outlook\\Work Progress.pst</span><br><span class=\"line\">0x000000007e3f8b30      5      5 RW-r-- \\Device\\HarddiskVolume2\\Users\\Raf_Square\\AppData\\Local\\Microsoft\\Outlook\\Forgot the password.pst</span><br><span class=\"line\">0x000000007e5297a0      1      0 R--rw- \\Device\\HarddiskVolume2\\Users\\Raf_Square\\AppData\\Local\\Microsoft\\Outlook\\Forgot the password.pst</span><br><span class=\"line\">0x000000007e5eee60     30      0 RW-r-- \\Device\\HarddiskVolume2\\Users\\Raf_Square\\AppData\\Local\\Microsoft\\Outlook\\Outlook.pst</span><br></pre></td></tr></table></figure>\n<p>After extracting the files using  <code>dumpfiles</code>  plugin and making sure that the files are safe and not corrupted. I opened them using a pst online viewer!</p>\n<p>The 1st mail i got it is from Adam! He send to me a zip file inside mega storage after our online meeting! I bet that zip is protected with that boring password</p>\n<p><img data-src=\"https://i.imgur.com/9a0GCzz.png\" alt=\"\"></p>\n<p>Ah my bad! The mega too is protected! We need the encryption key!</p>\n<p><img data-src=\"https://i.imgur.com/hEG0dsu.png\" alt=\"\"></p>\n<p>Let’s check the other mail! and as expected Adam forget to share the decryption key of the mega link to open the zip!</p>\n<p><img data-src=\"https://i.imgur.com/wB3m3QV.png\" alt=\"\"></p>\n<p>Bingo we got the zip! But it’s protected! Tried bruteforcing the password. But I failed!</p>\n<p>Mmmm Let’s think a little bit! The author said that he used to use the same password! We need to find another usage of that password to open the zip and get the flag!</p>\n<p>And It’s time to investigate the  <code>mstsc.exe</code>  or let’s just say the RDP! Remote Desktop?? Mmmm how to extract information from that thing?</p>\n<p>Let’s talk brievly! Extracting the memory part used by RDP can save our life! I’ll try to recover what the user see when he used RDP!!!</p>\n<p>Yes this possible dear reader, Don’t worry You’ll see how! Just make sure that you have  <code>Gimp</code></p>\n<p>Let’s now extract the memory part used by RDP process using the  <code>memdump</code>  plugin in volatility!</p>\n<figure class=\"highlight bash\"><figcaption><span>memdump</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vol.py -f memory.dmp --profile=Win7SP1x64 memdump -p 360 -D .</span><br><span class=\"line\">Volatility Foundation Volatility Framework 2.6.1</span><br><span class=\"line\">************************************************************************</span><br><span class=\"line\">Writing mstsc.exe [   360] to 360.dmp</span><br></pre></td></tr></table></figure>\n<p>After getting that file! Let’s change its extension from  <code>.dmp</code>  to  <code>.data</code>  and open that file with gimp!</p>\n<p><img data-src=\"https://i.imgur.com/k3uwJ0M.png\" alt=\"\"></p>\n<p>Now it’s time for focusing! Yeah focusing will save your time! Many people can’t figure or recover images quickly! But believe me focusing on the noise will help you recover the data in a short time!</p>\n<p>After 4 mins of playing with offset and width i got it!</p>\n<p>Check the offset and the width!</p>\n<p><img data-src=\"https://i.imgur.com/wI2SQK7.png\" alt=\"\"></p>\n<p>Ohhh man! The user was opened <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jdGYuc2VjdXJpbmV0cy50bg==\">https://ctf.securinets.tn</span> (check it for know more information about our CTFs events xD ) and tried to secure a zip file with that shitty password!</p>\n<p>Finally This is the flag  <code>Securinets&#123;R3M0tE_DeSKtOp_1s_FunNy_!_!&#125;</code></p>\n<h1 id=\"hardware-liquid-display\"><a class=\"markdownIt-Anchor\" href=\"#hardware-liquid-display\">#</a> Hardware: Liquid Display</h1>\n<p><img data-src=\"https://i.imgur.com/YVrQJqG.png\" alt=\"\"></p>\n<p>We got an image and a data file!<br>\n<img data-src=\"https://i.imgur.com/5Enx08x.png\" alt=\"\"></p>\n<p>The image contains an LCD 16x2 SPI connected to something called  <code>WOKWI LOGIC</code></p>\n<p>After some searching I got that this component is a logic analyzer. But wait!! What is that??</p>\n<p>A logic analyzer is an electronic instrument that captures and displays multiple signals from a digital system or digital circuit. A logic analyzer may convert the captured data into timing diagrams, protocol decodes, state machine traces…</p>\n<p><img data-src=\"https://imgur.com/WEzP4bO.png\" alt=\"\"></p>\n<p>As my friend said this is the hardware wireshark xD</p>\n<p>So we can understand now that this circuit capture the signals of each pin of the LCD and the data file is the capture file that contains the files!</p>\n<p>So after some searching we get how to open that data file (which is a ASCII text file, I didn’t recommend to analyse it as text file).</p>\n<p>You can check this <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLndva3dpLmNvbS9ndWlkZXMvbG9naWMtYW5hbHl6ZXI=\">link</span> to get more information about the logic analyzer!</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaWdyb2sub3JnL3dpa2kvRG93bmxvYWRz\">PulseView</span> is an open source Logic Analyzer GUI belongs to The sigrok project that aims at creating a portable, cross-platform, Free/Libre/Open-Source signal analysis software suite that supports various device types</p>\n<p>I’ll use that Logic Analyzer GUI for this challenge!</p>\n<p><img data-src=\"https://imgur.com/6HyLxUY.png\" alt=\"\"></p>\n<p>Import the file data in this way! and let’s the show begin!</p>\n<p><img data-src=\"https://imgur.com/MLrvWUk.png\" alt=\"\"></p>\n<p>A lot of fun wait us right?! Don’t worry man! This is not that super hard! Just all what we need to do now is to simulate these signals manually! These signals are sent to the LCD and that LCD display something (It should be the flag!). So we need to understand how LCD works! I recommend to read the datasheet this thing!</p>\n<p>I will not re-write what the datasheet said! so read it! You should understand how the LCD dispaly chars!</p>\n<p><img data-src=\"https://imgur.com/vnZLXyb.png\" alt=\"\"></p>\n<p>Also don’t forget to check the instruction table and understand how these instruction works!</p>\n<p><img data-src=\"https://imgur.com/xsRciDM.png\" alt=\"\"></p>\n<p>Let’s just take an example of the 1st instruction! The  <code>Clear Display</code> . This instruction clear all the data and return the cursor to the original status! Ah yeah of course you must to understand that LCD have cursors, display modes …</p>\n<p>After understand how this LCD works it’s time to check how characters are written on that LCD!</p>\n<p><img data-src=\"https://imgur.com/5JQEtHj.png\" alt=\"\"></p>\n<p>This table will help us to convert the signals to chars and recover our flag!</p>\n<p>After reading the datasheet. You will understand that the D0 (that correspond to RS pin) can help you to understand when the display device clear the chars and reset the cursor or write something on the screen!</p>\n<p><img data-src=\"https://imgur.com/QTfwCZC.png\" alt=\"\"></p>\n<p>If you take a closer look you’ll get it! The guy who write the program write something and clear it then write another thing then delete it and so on!<br>\n<img data-src=\"https://imgur.com/GSgaCKF.png\" alt=\"\"></p>\n<p>So now it’s time to check the write blocks and check what that guy try to do! After reversing all the block i got the flag! It’s on the last block! Let me show you how I recover that data!</p>\n<p><img data-src=\"https://imgur.com/HZcwRyX.png\" alt=\"\"></p>\n<p>Using the characters table you can recover the flag! Mapping the signal and the Big table lead you to the flag!</p>\n<p>And This is will be our flag!  <code>Securinets&#123;LcD_1s_H4rD_!:(&#125;</code></p>\n<h1 id=\"game-hacking-platformer\"><a class=\"markdownIt-Anchor\" href=\"#game-hacking-platformer\">#</a> Game Hacking: Platformer:</h1>\n<p><img data-src=\"https://imgur.com/OAyXmNQ.png\" alt=\"\"></p>\n<p>In this challenge we have a game made by unity! It’s 2D platformer game where the player can jump and run in the map! But where is the flag??<br>\n<img data-src=\"https://imgur.com/oIzwhG8.png\" alt=\"\"></p>\n<p>Mmmmm my sixth sense told me that the flag is hidden somewhere in the map and the player can’t reach it! Hack Time!!!</p>\n<p>Let’s change the player ability and let him can move in any place we want it. By disabling the collision and physics mechanism! Good bye gravitiy,Rigidbody,collisions!</p>\n<p>To do this let’s open  <code>Assembly-CSharp.dll</code>  located in  <code>Platformer_Data/Managed</code>  folder.</p>\n<p>Wow! This is the player controller code! that allow the player to move and the animation to be played and responsable for jumping and detect ground detection to deny player to jump many times on the air!</p>\n<p><img data-src=\"https://imgur.com/eD0vAq0.png\" alt=\"\"></p>\n<p>Boring mechanism!! Let me change this shitty code by mine! I’ll let the player move to any point he want!</p>\n<p><img data-src=\"https://imgur.com/DZqPB6p.png\" alt=\"\"><br>\nYou can copy that code</p>\n<figure class=\"highlight csharp\"><figcaption><span>change mechanism</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Start</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.rb = <span class=\"keyword\">base</span>.GetComponent&lt;Rigidbody2D&gt;();</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.rb.isKinematic = <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.anim = <span class=\"keyword\">base</span>.GetComponent&lt;Animator&gt;();</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.mySpriteRenderer = <span class=\"keyword\">base</span>.GetComponent&lt;SpriteRenderer&gt;();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Token: 0x06000005 RID: 5</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">FixedUpdate</span>()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">float</span> axisRaw = Input.GetAxisRaw(<span class=\"string\">&quot;Horizontal&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">float</span> verticalInput = Input.GetAxisRaw(<span class=\"string\">&quot;Vertical&quot;</span>);</span><br><span class=\"line\">\tVector3 movement = <span class=\"keyword\">new</span> Vector3(axisRaw, verticalInput, <span class=\"number\">0f</span>).normalized * <span class=\"number\">10f</span> * Time.deltaTime;</span><br><span class=\"line\">\t<span class=\"keyword\">base</span>.transform.Translate(movement);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>After applying the changes our player can now go to any place we want! But i didn’t find the flag! Oh god! This is what i found!<br>\n<img data-src=\"https://imgur.com/6PRgDFo.png\" alt=\"\"></p>\n<p>I checked all the map and sadly nothing interesting 😦</p>\n<p>Let’s check the files again! Maybe we will find something!</p>\n<p><img data-src=\"https://imgur.com/MZ9tbCH.png\" alt=\"\"></p>\n<p>Oh man look here! I found that there is levels on this game! Let me back to the decompiled code!</p>\n<p><img data-src=\"https://imgur.com/yM0C7nL.png\" alt=\"\"></p>\n<p>Oh no! The game is opened on the 2nd level! Let’s change this room to “Level1” and Play again! And yes It’s a new Level</p>\n<p><img data-src=\"https://imgur.com/me4efrx.png\" alt=\"\"></p>\n<p>After moving right and left, I found the flag!</p>\n<p><img data-src=\"https://imgur.com/gj4wGE9.png\" alt=\"\"></p>\n<p>And Yes We did it! Just move right and left and collect the letters ! and you’ll get this one ! Wrap it in Securinets{}<br>\n<img data-src=\"https://imgur.com/cpA2O6c.png\" alt=\"\"></p>\n<p>Flag:  <code>Securinets&#123;Gam1ng_AnD_L0VE&#125;</code></p>\n<h1 id=\"misc-full-difference\"><a class=\"markdownIt-Anchor\" href=\"#misc-full-difference\">#</a> Misc: Full Difference</h1>\n<p><img data-src=\"https://imgur.com/dROW4SQ.png\" alt=\"\"></p>\n<p>Full Difference, The difference will make a difference! What is that thing ?? we got 2 images with different type but same picture!<br>\n<img data-src=\"https://imgur.com/dr87PxX.png\" alt=\"\"></p>\n<p>Thinking a little bit can we understand what the author means! Full difference! It means that the pixels should be different a full difference! which means the Red,Green and Blue channels should be differents!</p>\n<p>“Will make a difference!” After extracting the different pixels we should calculate the difference between each channels ?? Mmmmm makes sense!</p>\n<figure class=\"highlight python\"><figcaption><span>solver</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"><span class=\"keyword\">import</span> string </span><br><span class=\"line\">im1=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;tobi.jpg&quot;</span>)</span><br><span class=\"line\">im2=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;tobi.png&quot;</span>)</span><br><span class=\"line\">pix2=im2.load()</span><br><span class=\"line\">pix1=im1.load()</span><br><span class=\"line\">width,height=im1.size</span><br><span class=\"line\">result=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">data=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,width):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,height):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> pix1[i,j] != pix2[i,j] <span class=\"keyword\">and</span> pix1[i,j][<span class=\"number\">0</span>] != pix2[i,j][<span class=\"number\">0</span>] <span class=\"keyword\">and</span> pix1[i,j][<span class=\"number\">1</span>] != pix2[i,j][<span class=\"number\">1</span>] <span class=\"keyword\">and</span> pix1[i,j][<span class=\"number\">2</span>] != pix2[i,j][<span class=\"number\">2</span>]:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">3</span>):</span><br><span class=\"line\">                data.append(<span class=\"built_in\">chr</span>(<span class=\"built_in\">abs</span>(pix1[i,j][k] - pix2[i,j][k])))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> data:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> char <span class=\"keyword\">in</span> string.ascii_letters + string.digits + string.punctuation:</span><br><span class=\"line\">        result+=char</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n<p>So the logic behind that code is to extract the pixels that have a full difference then calculate the difference between them. After that we convert the numbers to chars (should be printable!)</p>\n<p>This expression will give us the different pixels</p>\n<figure class=\"highlight python\"><figcaption><span>exp</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pix1[i,j] != pix2[i,j] <span class=\"keyword\">and</span> pix1[i,j][<span class=\"number\">0</span>] != pix2[i,j][<span class=\"number\">0</span>] <span class=\"keyword\">and</span> pix1[i,j][<span class=\"number\">1</span>] != pix2[i,j][<span class=\"number\">1</span>] <span class=\"keyword\">and</span> pix1[i,j][<span class=\"number\">2</span>] != pix2[i,j][<span class=\"number\">2</span>]</span><br></pre></td></tr></table></figure>\n<p>In addition this expression collect the result of calculation the diff between the 2 pixels of each image!</p>\n<figure class=\"highlight python\"><figcaption><span>diff</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data.append(<span class=\"built_in\">chr</span>(<span class=\"built_in\">abs</span>(pix1[i,j][k] - pix2[i,j][k])))</span><br></pre></td></tr></table></figure>\n<p>Then it’s time to convert it to printable data!</p>\n<figure class=\"highlight python\"><figcaption><span>print</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> data:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> char <span class=\"keyword\">in</span> string.ascii_letters + string.digits + string.punctuation:</span><br><span class=\"line\">        result+=char</span><br></pre></td></tr></table></figure>\n<p>Running this code will give you this base64 encoding!  <code>dGgxNV8xNV9zaDB1TGRfYjNfaDRyRA==</code></p>\n<p>Bingo we got this statement!  <code>th15_15_sh0uLd_b3_h4rD</code> . Let’s wrap it in Securinets! Oh nooo! Didn’t work. I guess the challenge is not finished!</p>\n<p>We have 2 images! PNG and JPEG. Mmmm Let’s try to do some steganography on these images using the password/key that we got previously.</p>\n<p>The 1st idea in my mind is to try steghide! Nothing else! Let’s try it</p>\n<p><img data-src=\"https://imgur.com/VLbBAGf.png\" alt=\"\"></p>\n<p>YEEES MAAN! We got a flag.zip file! But wait it’s protected again 😦. I tried to brute force that thing using rockyou but failed !!! What is going on here! The flag is inside that zip what we should to do now!</p>\n<p>Let’s extract more information about the zip using  <code>7z</code>  utility</p>\n<figure class=\"highlight bash\"><figcaption><span>7z</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">7z l  -slt flag.zip</span><br><span class=\"line\"></span><br><span class=\"line\">Path = flag.txt</span><br><span class=\"line\">Folder = -</span><br><span class=\"line\">Size = 40</span><br><span class=\"line\">Packed Size = 52</span><br><span class=\"line\">Modified = 2022-11-18 21:17:23</span><br><span class=\"line\">Created =</span><br><span class=\"line\">Accessed =</span><br><span class=\"line\">Attributes = A</span><br><span class=\"line\">Encrypted = +</span><br><span class=\"line\">Comment =</span><br><span class=\"line\">CRC = 4F639BBA</span><br><span class=\"line\">Method = ZipCrypto Store</span><br><span class=\"line\">Host OS = FAT</span><br><span class=\"line\">Version = 20</span><br><span class=\"line\">Volume Index = 0</span><br></pre></td></tr></table></figure>\n<p>Nice the flag.txt size is 40 bytes! So our flag is 40-chars strings! The encryption method is  <code>ZipCrypto</code> !</p>\n<p>Bingoo! This method is vulnerable! Let’s check how can we get our flag!</p>\n<p>After some searching we found a repository talking about “Crack legacy zip encryption with Biham and Kocher’s known plaintext attack.”</p>\n<p>I recommend to check this <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2tpbWNpODYvYmtjcmFjaw==\">repo</span> and understand how this attack can be manipulated and how to install that tool!</p>\n<p>Let’s now start downloading the tool</p>\n<figure class=\"highlight bash\"><figcaption><span>wget</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/kimci86/bkcrack/releases/download/v1.5.0/bkcrack-1.5.0-Linux.tar.gz</span><br></pre></td></tr></table></figure>\n<p>We need to recover the internal key that will allow us to extract the file!</p>\n<p>The attack requires at least 12 bytes of known plaintext. At least 8 of them must be contiguous. The larger the contiguous known plaintext, the faster the attack. In our case we have a flag.txt that contains  <code>Securinets&#123;*&#125;</code></p>\n<p>In our case we know 11 chars ( <code>Securinets&#123;</code> ) and the last char  <code>&#125;</code></p>\n<p>Let’s recover our key now!</p>\n<figure class=\"highlight bash\"><figcaption><span>prepare our data</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"string\">&quot;Securinets&#123;&quot;</span> &gt; plaintext.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"string\">&quot;&#125;&quot;</span> | xxd <span class=\"comment\"># 7d is the result</span></span><br></pre></td></tr></table></figure>\n<p>The attack requires the plain text content and in case there is another seperate bytes we can specify the offset and the byte value in hex</p>\n<p>Now time to work !</p>\n<figure class=\"highlight bash\"><figcaption><span>get the key</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bkcrack-1.5.0-Linux/bkcrack -C flag.zip -c flag.txt -p plaintext.txt -x 39 7d </span><br><span class=\"line\"></span><br><span class=\"line\">bkcrack 1.5.0 - 2022-07-07</span><br><span class=\"line\">[16:21:19] Z reduction using 4 bytes of known plaintext</span><br><span class=\"line\">100.0 % (4 / 4)</span><br><span class=\"line\">[16:21:19] Attack on 1405963 Z values at index 6</span><br><span class=\"line\">Keys: 184a904b d4557686 2222c7f2</span><br><span class=\"line\">9.2 % (129555 / 1405963)</span><br><span class=\"line\">[16:24:40] Keys</span><br><span class=\"line\">184a904b d4557686 2222c7f2</span><br></pre></td></tr></table></figure>\n<p>We got the keys !  <code>184a904b d4557686 2222c7f2</code> . Now we can decipher/decrypt the file! which means extract it from the zip!</p>\n<figure class=\"highlight bash\"><figcaption><span>extract</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bkcrack-1.5.0-Linux/bkcrack -C flag.zip -c flag.txt -k 184a904b d4557686 2222c7f2 -d my_flag.txt   </span><br><span class=\"line\"></span><br><span class=\"line\">bkcrack 1.5.0 - 2022-07-07</span><br><span class=\"line\">[16:32:25] Writing deciphered data my_flag.txt (maybe compressed)</span><br><span class=\"line\">Wrote deciphered data.</span><br></pre></td></tr></table></figure>\n<p>Bingo We got the flag!!! How 2 images can hide data like that!</p>\n<p><img data-src=\"https://imgur.com/O8uXhZV.png\" alt=\"\"></p>\n<p>Flag:  <code>Securinets&#123;Z1p_CRyPt0_&amp;_5t3gH1d3_1s_BAd&#125;</code></p>\n<h1 id=\"kubernetes-challenge-serie\"><a class=\"markdownIt-Anchor\" href=\"#kubernetes-challenge-serie\">#</a> Kubernetes challenge serie</h1>\n<p>NCSC’2023 consider the 1st tunisian CTF competition that have a whole Kubernetes Category! These are oriented for beginners/Intermediate users to consodilate their basic knowledge in Kubernetes!</p>\n<p><img data-src=\"https://imgur.com/U69KQtM.png\" alt=\"\"></p>\n<h2 id=\"kubernetes-secrets\"><a class=\"markdownIt-Anchor\" href=\"#kubernetes-secrets\">#</a> Kubernetes: Secrets:</h2>\n<p>In this challenge we get an IP and the author told us that he have a secret in the cluster!<br>\n<img data-src=\"https://imgur.com/PCmO273.png\" alt=\"\"></p>\n<p>Visiting the IP on the browser will lead us to the author page! This is not our objective!</p>\n<p>We need to access to the API-Server. Let’s check the default port 6443</p>\n<figure class=\"highlight bash\"><figcaption><span>curl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -sk https://20.169.73.19:6443/version</span><br></pre></td></tr></table></figure>\n<p>And this request is failed! Mmmm The author change the default api-server?? Nmap time! Let’s scan that IP!</p>\n<p>After checking the IP we get that port opened 7443!</p>\n<p><img data-src=\"https://imgur.com/GunNYhA.png\" alt=\"\"></p>\n<p>And Yes! We got a response! It’s KUBERNETES TIME!!</p>\n<p>Let’s check what permission we have as an anonymous users! To be honest I’ll try to check if I can got namespaces Or secrets first! Let me check that!</p>\n<figure class=\"highlight bash\"><figcaption><span>curl-namespaces</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -sk https://20.169.73.19:7443/api/v1/namespaces | grep <span class=\"string\">&#x27;&quot;name&quot;: &quot;&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>And we got a list of namespaces! This is cool! We have  <code>task1,task2,task3 and task4</code>  namespaces! I bet that each challenge is in single namespace! This is Great!<br>\n<img data-src=\"https://imgur.com/vZrtZLd.png\" alt=\"\"></p>\n<p>Hummm We need secrets and this is the 1st challenge! So We are sure that we can list the secrets in the  <code>task1</code>  namespace!</p>\n<figure class=\"highlight bash\"><figcaption><span>curl-namespaces</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -sk https://20.169.73.19:7443/api/v1/namespaces/task1/secrets</span><br></pre></td></tr></table></figure>\n<p>Bingo We got the Secrets List! We are on the right way!<br>\n<img data-src=\"https://imgur.com/0PFJsCI.png\" alt=\"\"></p>\n<p>Flag :  <code>Securinets&#123;S3crEts_Ar3_S0_CriT1c4LL&#125;</code></p>\n<blockquote>\n<p>We got a message! We must check it for sure!</p>\n</blockquote>\n<p>Look what we got here !</p>\n<figure class=\"highlight text\"><figcaption><span>check</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Look here YOU will need this one believe me!!!</span><br><span class=\"line\"> eyJhbGciOiJSUzI1NiIsImtpZCI6IkZwcWlIMGR2QlJ5Q0ZwTHV5a0JFQnlEcVI5UWZHLUdsY2NLQkkyMGlZWU0ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJ0YXNrMiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJwb2QtbGlzdGVyLXRva2VuLXpoNHM2Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InBvZC1saXN0ZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIyZjc2YjA3ZS0wY2NjLTRhMDQtYWUxZi1jNGJhMzIxZjYzZmQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6dGFzazI6cG9kLWxpc3RlciJ9.cewI8cdU8u-MxhLW5enn9bqj2DnD6Kn6iJZD2Y70uSIN-Pdq4VGrCNN0oB0edWaNZd_2o3NCVfE1GY9JRIjQeMuV_Uk5-tEQ62TS1b2hpHPoq8FtRFDyji26LyTR2XGU7gSYdQV6G8axOU3z8_RRWQarN5VfSgDp-WmwizjwWJLMhENGgvWBxOKjHrF0tDCEmshH1g841NB4XtzeiXRxEC1AN9kNv-7SZvYWasHbPuva-fsGBp-AvhUUTStcCVahZ8VElJ51q3VxKBTXX-DoDWfsVD5rOcCse0yj4jxgN3GIqjIaAcjBiPI2XmhQv-tMMbYpj7gfAxrzhdh77UfaBg</span><br></pre></td></tr></table></figure>\n<h2 id=\"kubernetes-pody\"><a class=\"markdownIt-Anchor\" href=\"#kubernetes-pody\">#</a> Kubernetes: Pody:</h2>\n<p>After getting the secrets we can move to the next challenge that named  <code>Pody</code></p>\n<p><img data-src=\"https://imgur.com/hZQya2W.png\" alt=\"\"></p>\n<p>In this challenge the author told us that the container is inside a pod! So how can we get inside that pod? Thinking a little bit we didn’t get any solution expect opening a shell session inside the pod!</p>\n<p>Kubectl Are you there?? Yes! It’s Kubectl time! I love to work with kubectl I will not waste my time curling endpoints 😃 So I’ll make my kubeconfig file for this challenge!</p>\n<p>When I checked the secrets in the previous challenge I got the certificate authority Certifcate. And of course don’t forget the token that we got!</p>\n<blockquote>\n<p>This token is used for authentication and authorization in kubernetes. This authorization is occur on the api-server level not the etcd!</p>\n</blockquote>\n<p>Let’s make our kubeconfig! But wait! In case you don’t have kubectl, it’s time to install it! You can follow this <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL2RvY3MvdGFza3MvdG9vbHMvaW5zdGFsbC1rdWJlY3RsLWxpbnV4Lw==\">guide</span> to install it</p>\n<figure class=\"highlight yaml\"><figcaption><span>kubeconfig</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Config</span></span><br><span class=\"line\"><span class=\"attr\">clusters:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">cluster:</span></span><br><span class=\"line\">    <span class=\"attr\">certificate-authority-data:</span>  <span class=\"string\">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1ETXdOVEV5TWpVMU1sb1hEVE16TURNd01qRXlNalUxTWxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTDEzCm0rOG5ySVlXU21hQjREMU9yWWJVS1hycE4rS2ZUZDk1TjA2UTQ5U3IyUU1FZkZXZHhjSGJadThRVWRIVXo1dFcKdmVvRnk4cFBpcmhhNHdGYnJEbXczdFp4NlgxbGxEZlp4b29jd1ZBOS9pMTBjNGE4TURvOGVuc1hlYWU1TytZcQpMZmdiM04zcWZYYjZmSHAzekwxeHJzWThPUEZVeHhmU3AxaElXa0RNZ0tZY0lhU2NoRVUzYTk0ZityY2tIOUFwCnltRi95TlB3bXgyU1RFZUVFSkZoZFdWUzVVamdSTmxnNzFPWklyb05DMXMzWEJxb2RiZ1FWUjBUeTI5bnJGc0QKQnBJQW1WQVRCS3QxTjcyRjRMRDA0c3M3QVUxU0NDSCtoUmlrTWE1ZkdtOTBjMWRacEVuZ1IyVEUwSzZ4WVY3TAplOElrcE5WOVBaLy9RT2ZqSnFFQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZBWWUzVktNRDY3T3V5NWhWTGxTN0RWeU52SExNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSE9EMUNTNGQzNjJLRXE1dTZyQwpQOEF6a3hDMTJDdVF1bDh4aUVTajZ4M25wb25oT2M3WU0zRUhQZk5wNHRDZmNsdFpDMU51SXNrVDRuSkRLRTFYCjRNVFNOL0kxVDlGSHd5SUhNbDZMZm1RL1ZLVlo1YlZJMEZlUENQanFnOWZSbHFYaitsRUxJQnRJVE0xbUlmeW0KZlZmMisrS3h4OTFTME54bWRKUzU0amY1SUJMRVh2SnRiWFYrblZ1ekhER3l5eDREblVDMm4zR3NrcEtBOGRJRQpZZktRWk5IZjJ4L0FySWM2a3A0em9TSWI1RVQvdDk4b3p5R2pldlVnbDd1L0orUzkwTS9pWWgyaGlGSXRRVE1WCnBTa0pQM1lIbDlzWVRSS0dXZTBtcEtnVm1RZm9VTVNzdURrRnZ4ZFNhVG9QQUN6aUdxdUNnVXVyWHMxNXJjOWkKR2xBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==</span></span><br><span class=\"line\">    <span class=\"attr\">server:</span> <span class=\"string\">https://20.169.73.19:7443</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">raf-k8s</span></span><br><span class=\"line\"><span class=\"attr\">contexts:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">context:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ncsc-sa@raf-k8s</span></span><br><span class=\"line\">  <span class=\"attr\">context:</span></span><br><span class=\"line\">    <span class=\"attr\">cluster:</span> <span class=\"string\">raf-k8s</span></span><br><span class=\"line\">    <span class=\"attr\">user:</span> <span class=\"string\">ncsc-sa</span></span><br><span class=\"line\"><span class=\"attr\">current-context:</span> <span class=\"string\">ncsc-sa@raf-k8s</span></span><br><span class=\"line\"><span class=\"attr\">users:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ncsc-sa</span></span><br><span class=\"line\">  <span class=\"attr\">user:</span></span><br><span class=\"line\">    <span class=\"attr\">token:</span> <span class=\"string\">eyJhbGciOiJSUzI1NiIsImtpZCI6IkZwcWlIMGR2QlJ5Q0ZwTHV5a0JFQnlEcVI5UWZHLUdsY2NLQkkyMGlZWU0ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJ0YXNrMiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJwb2QtbGlzdGVyLXRva2VuLXpoNHM2Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InBvZC1saXN0ZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIyZjc2YjA3ZS0wY2NjLTRhMDQtYWUxZi1jNGJhMzIxZjYzZmQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6dGFzazI6cG9kLWxpc3RlciJ9.cewI8cdU8u-MxhLW5enn9bqj2DnD6Kn6iJZD2Y70uSIN-Pdq4VGrCNN0oB0edWaNZd_2o3NCVfE1GY9JRIjQeMuV_Uk5-tEQ62TS1b2hpHPoq8FtRFDyji26LyTR2XGU7gSYdQV6G8axOU3z8_RRWQarN5VfSgDp-WmwizjwWJLMhENGgvWBxOKjHrF0tDCEmshH1g841NB4XtzeiXRxEC1AN9kNv-7SZvYWasHbPuva-fsGBp-AvhUUTStcCVahZ8VElJ51q3VxKBTXX-DoDWfsVD5rOcCse0yj4jxgN3GIqjIaAcjBiPI2XmhQv-tMMbYpj7gfAxrzhdh77UfaBg</span></span><br></pre></td></tr></table></figure>\n<p>This kubeconfig file will allow us to authenticate to the api-server using kubectl utility without wasting time specifying the token and other stuff!</p>\n<p>Assume that you save that file in name  <code>ncsc-k8s.conf</code> . Let’s export the KUBECONFIG env var.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">export</span> KUBECONFIG=ncsc-k8s.conf</span><br><span class=\"line\">$ kubectl get pods -n task2 </span><br><span class=\"line\">NAME      READY   STATUS    RESTARTS        AGE</span><br><span class=\"line\">web-app   1/1     Running   3 (2d19h ago)   17d</span><br></pre></td></tr></table></figure>\n<p>Bingo !! We got access and everything is ok until now. Let’s describe the pod and check what we have first before getting a shell !</p>\n<figure class=\"highlight bash\"><figcaption><span>describe pod</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe pod web-app -n task2   </span><br><span class=\"line\">Name:             web-app</span><br><span class=\"line\">Namespace:        task2</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">    Mounts:</span><br><span class=\"line\">      /etc/nginx/flag.txt from flag-configmap (rw,path=<span class=\"string\">&quot;flag.txt&quot;</span>)</span><br><span class=\"line\">      /var/cache/nginx from tmpfs-2 (rw)</span><br><span class=\"line\">      /var/run from tmpfs-1 (rw)</span><br><span class=\"line\">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-wrfpc (ro)</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>Wow there is  <code>flag.txt</code>  file inside the pod! Let’s be more accurate! The flag is in  <code>/etc/nginx/flag.txt</code></p>\n<p>Let’s get a shell or run a command from the pod using the  <code>kubectl exec</code>  command!</p>\n<p><img data-src=\"https://imgur.com/6QTqehO.png\" alt=\"\"></p>\n<p>Yes we got the flag! And another message: Your current token is enough!</p>\n<blockquote>\n<p>I tried to delete the flag! But as expected the author make the pod Read-only file system</p>\n</blockquote>\n<p>Flag :  <code>Securinets&#123;Ex3c_1s_DAnGer0uS_B3_C4r3fUL&#125;</code></p>\n<h2 id=\"kubernetes-hidden\"><a class=\"markdownIt-Anchor\" href=\"#kubernetes-hidden\">#</a> Kubernetes: Hidden? :</h2>\n<p>We still have the same token! Our kubectl works fine. So no worries we can do it!</p>\n<p><img data-src=\"https://imgur.com/1Eny78d.png\" alt=\"\"></p>\n<p>In this challenge the flag is hidden?? But how!? Let’s check first what can we do in our  <code>task3</code>  namespace</p>\n<figure class=\"highlight bash\"><figcaption><span>service</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get service -n task3        </span><br><span class=\"line\">NAME      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span><br><span class=\"line\">web-app   ClusterIP   10.109.128.98   &lt;none&gt;        80/TCP    17d</span><br></pre></td></tr></table></figure>\n<p>We can access to services! In case you don’t know what is service I recommend to check this <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL2RvY3MvY29uY2VwdHMvc2VydmljZXMtbmV0d29ya2luZy9zZXJ2aWNlLw==\">page</span>. As we understand, There is a pod inside task3 namespace but we don’t have any access to it 😦!. No worries we still have services! This service as we can see its attached to that pod. Let’s get our flag!</p>\n<p>After a little bit of thinking, I got an idea! Let’s access to the service from our previous pod!</p>\n<p>YES MAN! pods and services can communicate between each others</p>\n<p><img data-src=\"https://imgur.com/uq3xAoV.png\" alt=\"\"></p>\n<p>Ok let’s do it then, we have the service internal IP and we can run curl command inside our previous pod!</p>\n<p><img data-src=\"https://imgur.com/DuPq2Sp.png\" alt=\"\"></p>\n<p>Bingo! Flag:  <code>Securinets&#123;K8s_S3rV1cEs_ArE_P0wErFull&#125;</code> <br>\nAnd as Usual! another token for the next challenge :</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In The Next Challenge You will Need This one!</span><br><span class=\"line\"> eyJhbGciOiJSUzI1NiIsImtpZCI6IkZwcWlIMGR2QlJ5Q0ZwTHV5a0JFQnlEcVI5UWZHLUdsY2NLQkkyMGlZWU0ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJ0YXNrNCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJuY3NjLXBhcnRpY2lwYW50LXRva2VuLTdnZ2JxIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6Im5jc2MtcGFydGljaXBhbnQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwNmM3OGJhZC01NjAwLTQ2N2QtYjdhYi0wNWQzN2RjMjg0MzIiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6dGFzazQ6bmNzYy1wYXJ0aWNpcGFudCJ9.exWa8skN0HdscxzG2PBFYn9eU9l_sL7hAjUw8sFPsnjUKHPHzmqwDpN4WfSPCHFOfv7KKimYvr9SuMjB75KuapxXKnyBwEaIZEkH3c0lavBCPYfGou_BrVsAHVSdbw6pQ9YYonuc3WTiGkcXC-XjKXfY8PGppmnGh7gUsuxY9xwpju10PutjIs8s0g9z2tTBYUhOraa54WRCODDGw-o415rXsaVHuV8A2Cj3jQZVBzXXi5-snfvjX27-nMyGDh4F0gu8sXD3PZfLjLdrOQpP6s_jzbUN9G1g8iLQTXNjCvgUw2cnBOvWtRGLtbdizOazlKUyJAOSXfmu3W45bMJPOg</span><br></pre></td></tr></table></figure>\n<h2 id=\"kubernetes-special\"><a class=\"markdownIt-Anchor\" href=\"#kubernetes-special\">#</a> Kubernetes: Special :</h2>\n<p>After getting the new token it’s time to edit the kubeconfig file! Just replace the old toke by the new one! To work with kubectl correctly!</p>\n<p><img data-src=\"https://imgur.com/iFClk1V.png\" alt=\"\"></p>\n<p>Something Special?? What a special? Everything in Kubernetes is SO Special!! So no worries, We can deal with that kind of things!</p>\n<p>Talking about something special take me to think about what we can call it  <code>Custom Resources Definition</code>  in Kubernetes!</p>\n<p>In Kubernetes, a custom resource is an extension of the Kubernetes API that allows you to define your own custom resources with their own custom controllers.</p>\n<p>A custom resource definition (CRD) is used to create a new custom resource type in Kubernetes. A CRD defines the structure and behavior of the new custom resource, including its name, attributes, and API endpoints. Once a CRD is defined, instances of the custom resource can be created and managed using Kubernetes tools like kubectl and the Kubernetes API.</p>\n<figure class=\"highlight bash\"><figcaption><span>api-resources</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl api-resources</span><br><span class=\"line\">NAME                              SHORTNAMES                                      APIVERSION                             NAMESPACED   KIND</span><br><span class=\"line\">bindings                                                                          v1                                     <span class=\"literal\">true</span>         Binding</span><br><span class=\"line\">componentstatuses                 cs                                              v1                                     <span class=\"literal\">false</span>        ComponentStatus</span><br><span class=\"line\">configmaps                        cm                                              v1                                     <span class=\"literal\">true</span>         ConfigMap</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">rolebindings                                                                      rbac.authorization.k8s.io/v1           <span class=\"literal\">true</span>         RoleBinding</span><br><span class=\"line\">roles                                                                             rbac.authorization.k8s.io/v1           <span class=\"literal\">true</span>         Role</span><br><span class=\"line\">priorityclasses                   pc                                              scheduling.k8s.io/v1                   <span class=\"literal\">false</span>        PriorityClass</span><br><span class=\"line\">ncscctfs                                                                          securinets.com/v1alpha1                <span class=\"literal\">true</span>         NCSCCtf</span><br></pre></td></tr></table></figure>\n<p>But wait! I am right! There is an api-group and a custom resource called ncscctfs!</p>\n<p>Now it’s time to get the flag!</p>\n<figure class=\"highlight bash\"><figcaption><span>get</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get ncscctfs -n task4           </span><br><span class=\"line\">NAME   AGE</span><br><span class=\"line\">flag   17d</span><br></pre></td></tr></table></figure>\n<p>And yes there is a ncscctf resource named flag! Let’s describe that thing and get the flag!</p>\n<figure class=\"highlight bash\"><figcaption><span>describe</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe ncscctfs flag -n task4 </span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://imgur.com/DhelAJU.png\" alt=\"\"></p>\n<p>Flag:  <code>Securinets&#123;CuSt0m_REs0urcEs_ArE_P0wErFul&#125;</code></p>\n<h1 id=\"final-words\"><a class=\"markdownIt-Anchor\" href=\"#final-words\">#</a> Final Words</h1>\n<p>In conclusion, the success of this event and competition is due in no small part to the dedication and hard work of the technical team. Their expertise and professionalism were instrumental in overcoming the various challenges we faced throughout the event lifecycle, and their tireless efforts ensured that we delivered a product that met the highest standards of quality and performance. On behalf of the team, I would like to express our sincere gratitude to our technical colleagues for their unwavering commitment to the project, and for their invaluable contributions to its success</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/09/12/Writeups/csaw2022/",
            "url": "http://example.com/2022/09/12/Writeups/csaw2022/",
            "title": "CSAW'2022 Forensics Writeup",
            "date_published": "2022-09-12T10:33:37.000Z",
            "content_html": "<p>CSAW CTF is one of the oldest and biggest CTFs in the world, with more than 900 teams participating in the 2022 edition. We would like to thank the organizers for the stable infrastructure and the creative challenges.</p>\n<p>we finished first in the MENA region and 14th globally</p>\n<p>Kudos to everyone in my team SOter14 for their huge work and efforts, you can catch up with out latest news at <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb3RlcjE0LnRlY2g=\">our website</span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9TT3RlcjE0VGVhbQ==\">twitter page</span></p>\n<p>The contest was fun and challenging, we managed to solve 25 out of the 28 challenges in Pwn, Web, OSINT, Forensics, Steganography, Misc, Quantum Computing, AI, Cryptography, and Reverse Engineering.</p>\n<p>Below are the writeups for forensics challs: Noir, Not Too Taxing (Crypto), and Encrypted disk.</p>\n<h1 id=\"noir-digital-forensics-steganography\"><a class=\"markdownIt-Anchor\" href=\"#noir-digital-forensics-steganography\">#</a> Noir: Digital Forensics / Steganography</h1>\n<details class=\"info\"><summary>Description</summary><div>\n<p>I am a forest, and a night of dark trees: but he who is not afraid of my darkness, will find banks full of roses under my cypresses. Friedrich Nietzsche.</p>\n<p>The image contains a flag in the format (flag)this_is_the_flag</p>\n</div></details>\n<p>Challenge Link &amp; Author</p>\n<div class=\"links\"><div class=\"item\" title=\"Challenge Link\" style=\"--block-color:#2296fd;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xQnVkYW1uZGdNNlRpb3l6VlhpY01LVkRqQTJGLUtVUHovdmlldz91c3A9c2hhcmluZw==\" data-background-image=\"https://ctftime.org/media/events/logo_48.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xQnVkYW1uZGdNNlRpb3l6VlhpY01LVkRqQTJGLUtVUHovdmlldz91c3A9c2hhcmluZw==\">Challenge Link</span>\n          <p class=\"desc\">CSAW 2022 - Noir</p>\n          </div></div><div class=\"item\" title=\"Author - Wen Jun L.\" style=\"--block-color:#de2336;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL3dlbmpsLw==\" data-background-image=\"https://media-exp1.licdn.com/dms/image/C5603AQGZdulNxGshvg/profile-displayphoto-shrink_400_400/0/1602081502952?e=1668643200&v=beta&t=XeXg__QTpf__BhQHFkZD7sSsL7PeCEbEXdi-J66JfeU\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL3dlbmpsLw==\">Author - Wen Jun L.</span>\n          <p class=\"desc\">Wen Jun L. Linkedin Profile</p>\n          </div></div></div>\n<p>This challenge blowed our minds, it was part of CSAW’21 Finals and it is a 0-solves chall, so it was offered in the Quals of 2022. We’ve got an image, bit heavy around 9 MB that looks like a scene from a horror game, storm, forest, and darkness. It was a twisted chall!</p>\n<p><img data-src=\"https://github.com/u91o/noir/blob/main/noir.png?raw=true\" alt=\"\"></p>\n<p>First, we tried the normal steganogrpahy ways around it, but obviously that is a total waster of time.</p>\n<p>It had 100+ on Aperisolve alone!</p>\n<p>Technically, the image is merely noise in the three RGB channels whith contrast on few areas, that when included with the alpha channel gives the image as you see it! Amazing, it really feels like some streaming technique, a kind of standard that’s used by TVs to show pictures we can understand. But we neglected the thought of getting a video out of an image, how unfair! Instead we’ve thought of the noise as a raw data that we can feed to Audacity and hopefully get an audible thing out of it, using U-LAW since we’re dealing with RAW data, it made much sense, because we have seen some images filled with noise turning into audio. But a video, insane!</p>\n<p><img data-src=\"https://i.imgur.com/dpalAg1.png\" alt=\"\"></p>\n<p>And of course, it was a video!</p>\n<p>Noir represents a kind of movies, black and white, crime generally, and that’s how we finally went into the idea that we’re dealing with a video rather than an audio.</p>\n<p>The Noir movies are taped to a stripe and played through a wheel showing still images 24 frames a second - Oh, keep that in mind! Still images mean also RAW data. That could help.</p>\n<p>But still we wonder, how to extract the video.<br>\nWell it can’t be manually, there must be a tool, or it would be a total nightmare.</p>\n<p>To save you some time, it was  <code>FFmpeg</code> !!</p>\n<p>FFmpeg is a free and open-source software project consisting of a suite of libraries and programs for handling video, audio, and other multimedia files and streams. At its core is the command-line ffmpeg tool itself, designed for processing of audiovisual files. Per Wikipedia.</p>\n<p>Well, that means some sort of conversion, right? Yep, but from a single png to what? There are hundreds of video formats out there, some of them are no longer being used.</p>\n<p>But we can narrow our results, to lightweight ones since the image is just 9 MB, 24 fps if that helps, RAW data, so no codecs!</p>\n<p>FFmpeg command to convert formats is basically:</p>\n<figure class=\"highlight bash\"><figcaption><span>ffmpeg command</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i <span class=\"built_in\">source</span> -pix_fmt pixelformat  -f rawvideo - &gt; output.extension</span><br></pre></td></tr></table></figure>\n<p>You can specify the frames, although ffmpeg can pretty much detect that automatically.</p>\n<p>We need the pixelformat and the extension. We’re getting close!</p>\n<p>Hmm, since we’re dealing with an image, can’t the extension of the video we’re looking for be both an image extension and a video extension. WEBM answers that. How clever!</p>\n<p>Webm is actually the only extension we’ve found thats a Joker, can be an image/audio/video. Which makes it special. That’s it, by luck, we got it, WEBM.</p>\n<p>However we tried a lot of extenison, it was a game of trial and error, for instance we checked mp4, wmv, avi, mkv, flv, mov, you name it…</p>\n<p>FFmpeg needs a pixel format, well, there is a hude table of these formats…</p>\n<figure class=\"highlight bash\"><figcaption><span>pixels format</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name=     yuv420p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=     yuyv422, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=       rgb24, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=       bgr24, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=     yuv422p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=     yuv444p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=       rgb32, nb_channels=   4, depth=   8, is_alpha=y</span><br><span class=\"line\">name=     yuv410p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=     yuv411p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=      rgb565, nb_channels=   3, depth=   5, is_alpha=n</span><br><span class=\"line\">name=      rgb555, nb_channels=   3, depth=   5, is_alpha=n</span><br><span class=\"line\">name=        gray, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=       monow, nb_channels=   1, depth=   1, is_alpha=n</span><br><span class=\"line\">name=       monob, nb_channels=   1, depth=   1, is_alpha=n</span><br><span class=\"line\">name=        pal8, nb_channels=   4, depth=   8, is_alpha=y</span><br><span class=\"line\">name=    yuvj420p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=    yuvj422p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=    yuvj444p, nb_channels=   3, depth=   8, is_alpha=n</span><br><span class=\"line\">name=      xvmcmc, nb_channels=   0, depth=   0, is_alpha=n</span><br><span class=\"line\">name=    xvmcidct, nb_channels=   0, depth=   0, is_alpha=n</span><br><span class=\"line\">name=     uyvy422, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=   uyyvyy411, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=       bgr32, nb_channels=   4, depth=   8, is_alpha=y</span><br><span class=\"line\">name=      bgr565, nb_channels=   3, depth=   5, is_alpha=n</span><br><span class=\"line\">name=      bgr555, nb_channels=   3, depth=   5, is_alpha=n</span><br><span class=\"line\">name=        bgr8, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=        bgr4, nb_channels=   1, depth=   4, is_alpha=n</span><br><span class=\"line\">name=   bgr4_byte, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=        rgb8, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=        rgb4, nb_channels=   1, depth=   4, is_alpha=n</span><br><span class=\"line\">name=   rgb4_byte, nb_channels=   1, depth=   8, is_alpha=n</span><br><span class=\"line\">name=        nv12, nb_channels=   2, depth=   8, is_alpha=n</span><br><span class=\"line\">name=        nv12, nb_channels=   2, depth=   8, is_alpha=n</span><br><span class=\"line\">name=     rgb32_1, nb_channels=   4, depth=   8, is_alpha=y</span><br><span class=\"line\">name=     bgr32_1, nb_channels=   4, depth=   8, is_alpha=y</span><br><span class=\"line\">name=    gray16be, nb_channels=   1, depth=  16, is_alpha=n</span><br><span class=\"line\">name=    gray16le, nb_channels=   1, depth=  16, is_alpha=n</span><br></pre></td></tr></table></figure>\n<p>Well, we didn’t guess, we, at this stage, after looking deeply into the image, and as said before, the RGB channels are carrying noise that surely represent the video, however the alpha channel is the one that shape the picture as we see it in the previews. So the pixel format we choose is rgb24 excluding the alpha channel.</p>\n<p>The final command is:</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i noir.png -pix_fmt rgb24  -f rawvideo - &gt; vid.webm</span><br></pre></td></tr></table></figure>\n<p>Coool, after all the hustle we’ve got a video, a subway with blinking lights, or should I say, Morse Code!<br>\nThe clock was ticking, we’re at the final hours of the CTF, and the video is 2 mins long.<br>\nCould there be any OpenCV tool for this! Of course, here is a link you might need it as well <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JhemVyMjAxNS9Nb3JzZURlY29kZXI=\">MorseDecoder</span></p>\n<p>Here is a link for the video as well <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xOU5TOTJXblZZMUlNbEc0aHlFWVh2c0U3MWpfbTFDcG8vdmlldz91c3A9c2hhcmluZw==\">video.webm</span></p>\n<p>Using the tool, I let it record my screen and positioned the cross selection on the train lights. Within a minute we’ve got the flag!</p>\n<p><img data-src=\"https://i.imgur.com/wh0uUv2.png\" alt=\"\"></p>\n<p>Finally, it was a creative challenge we must say!</p>\n<p>The flag is  <code>(flag)sil3nt_refl3ct1on</code></p>\n<h1 id=\"not-too-taxing-digital-forensics-cryptography\"><a class=\"markdownIt-Anchor\" href=\"#not-too-taxing-digital-forensics-cryptography\">#</a> Not Too Taxing: Digital Forensics / Cryptography</h1>\n<details class=\"info\"><summary>Description</summary><div>\n<p>We intercepted some email communications between a tax consultant and his client that contained some important tax documents. We were able to successfully extract two of the documents, but we can’t figure out the password to the file in order to extract the data. Attached are the two extracted files, Tax_Ret_Form_Blank.pdf and Tax_Ret_Form_Nov_2021.zip, and a transcript of the emails we found, SPBlock_Email.pdf.</p>\n<p>Can you figure out the password so we can get this guy’s info?</p>\n</div></details>\n<p>Challenge Link &amp; Author</p>\n<div class=\"links\"><div class=\"item\" title=\"Challenge Link\" style=\"--block-color:#2296fd;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2RyaXZlL2ZvbGRlcnMvMXo1SGxYR1lhVnhtTndWbXhkRFhGQk9PSUFlZEt6c1pNP3VzcD1zaGFyaW5n\" data-background-image=\"https://ctftime.org/media/events/logo_48.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2RyaXZlL2ZvbGRlcnMvMXo1SGxYR1lhVnhtTndWbXhkRFhGQk9PSUFlZEt6c1pNP3VzcD1zaGFyaW5n\">Challenge Link</span>\n          <p class=\"desc\">CSAW 2022 - Not Too Taxing</p>\n          </div></div></div>\n<p>In this challenge we were given, an encrypted zip archive containing a filled state tax form document for the month of Novemeber 2021, the emails transmitted between … and the client, as well as the template of the tax form blank.</p>\n<p>We’ve noticed the zip was using the ZipCrypto Store compression, which is breakable if you can find 12 bytes of the data inside the zip, 8 of which got to be contiguous.</p>\n<p>ZipCrypto is considered as the legacy encryption of archives, you must be aware that it is the default method used in most Linux distros: ZipCrypto Deflate. Thus you might want to manually change that method when compressing to AES for higher security.</p>\n<p>The ZipCrypto algorithm generates a pseudo-random stream of bytes/keystream, which is XORed to the entry’s content. to produce the encrypted data. The generator’s state made of three 32-bits integers (keys), is initialized using the password and then contiuously updating as encryption goes on.</p>\n<p>This encryption algorithm is vulnerable to known plaintext attacks to recover the content fully.</p>\n<p>We’re going to use  <code>bkcrack</code>  tool which can recover the content of the archive, change a zip archive’s password, and recover the original password. All by retrieving the zip archive three generated keys.</p>\n<p>The installation is pretty straight forward, just git clone the repo then,</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cmake -S . -B build -DCMAKE_INSTALL_PREFIX=install</span><br><span class=\"line\">cmake --build build --config Release</span><br><span class=\"line\">cmake --build build --config Release --target install</span><br></pre></td></tr></table></figure>\n<p>Well, we must use the blank tax form as our plaintext attack, as it shares a lot of identical bytes with the filled form inside the zip.</p>\n<p>However you can’t just feed the pdf to bkcrack and hope for it to crack the zip. The tool requires a non encrypted zip with the similar bytes inside to attack the encrypted zip.</p>\n<p>So let’s get our blank form inside a zip and specify the method of encryption as ZipCrypto and the compression level as store. Now we guarantee there are plenty of similar bytes to execute the attack.</p>\n<p><img data-src=\"https://i.imgur.com/ouMza3O.png\" alt=\"\"></p>\n<p>First we retrieve the three keys from the zip archive using</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bkcrack -C Tax_Ret_Form_Nov_2021.zip -c Tax_Ret_Form_Nov_2021.zip -P Tax_Ret_Blank.zip -p Tax_Ret_Form_Blank.pdf</span><br></pre></td></tr></table></figure>\n<p>-C: Specifies the encrypted zip archive<br>\n-c: Specifies the target file within the archive<br>\n-P: Specifies the plaintext zip archive<br>\n-p: specifies the plaintext file within the non encrypted archive.</p>\n<p>Now let it process for a while, it should not take long, as we provided more than enough data to bkcrack.</p>\n<p>Here are they keys I have got:</p>\n<figure class=\"highlight bash\"><figcaption><span>result</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">b2c4a24e f036ff3a 998f6727</span><br></pre></td></tr></table></figure>\n<p>If the compression wasn’t Store, and instead it was Deflate, then the Github repo provides some python scripts to decompress those types, just first include  <code>-d deciphered</code>  at the end of the previous command.</p>\n<p>Then run:</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 tools/inflate.py deciphered decompressed</span><br></pre></td></tr></table></figure>\n<p>In our case, it was just Store, so we move on to the next step, we’re going to recreate the very same archive with a password of our choise, this is the fastest way around Zip crypto archives, you can go ahead and retrieve the password, we will show that. However that process will take a bit longer.</p>\n<figure class=\"highlight plaintext\"><figcaption><span>command Line</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bkcrack -C Tax_Ret_Form_Nov_2021.zip -k b2c4a24e f036ff3a 998f6727 -U unlocked.zip 1234</span><br></pre></td></tr></table></figure>\n<p>And within a second, we got our new archive with the filled document restored successfully!</p>\n<p><img data-src=\"https://i.imgur.com/8x38gOi.png\" alt=\"\"></p>\n<p>And the flag was:  <code>flag&#123;1f_y0u_u53_z1pcryp70_4ny0n3_c4n_aud17_y0u&#125;</code></p>\n<p>However if you want the hard way, you can retrieve the original password of the archive using the three keys, you might need to know the length though, or guess it. Tideous task…</p>\n<p>Anyways, here is the command you would use for that:</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bkcrack -k b2c4a24e f036ff3a 998f6727 -r 8..12 ?p</span><br></pre></td></tr></table></figure>\n<p>-r to specify the length, it can be a rough number or an interval.</p>\n<p>Sorry, I didnt bother to get the password 😃)</p>\n<p>It was a creative challenge. However I must say that we did not check the email content document at all lol!</p>\n<h1 id=\"encrypted-disk-digital-forensics\"><a class=\"markdownIt-Anchor\" href=\"#encrypted-disk-digital-forensics\">#</a> Encrypted Disk: Digital Forensics</h1>\n<details class=\"info\"><summary>Description</summary><div>\n<p>th31nk encrypted his disk and forgot the password, can you help him? Flag is what you find, no need to wrap</p>\n<p>HINT: Custom Profile</p>\n</div></details>\n<p>Challenge Link &amp; Author</p>\n<div class=\"links\"><div class=\"item\" title=\"Challenge Link\" style=\"--block-color:#2296fd;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xNnRJTHBaYTVHaXZZLVo4NGxybTg2VjhEQzVEV2FIemEvdmlldz91c3A9c2hhcmluZw==\" data-background-image=\"https://ctftime.org/media/events/logo_48.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL2ZpbGUvZC8xNnRJTHBaYTVHaXZZLVo4NGxybTg2VjhEQzVEV2FIemEvdmlldz91c3A9c2hhcmluZw==\">Challenge Link</span>\n          <p class=\"desc\">CSAW 2022 - Encrytped Disk</p>\n          </div></div><div class=\"item\" title=\"Author - Crazyman\" style=\"--block-color:#de2336;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9DcmF6eW1hbkFybXk=\" data-background-image=\"https://pbs.twimg.com/profile_images/1427918895424282628/NR5jaECn_400x400.jpg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9DcmF6eW1hbkFybXk=\">Author - Crazyman</span>\n          <p class=\"desc\">Crazyman Twitter Profile</p>\n          </div></div></div>\n<p>In this challenge we got a disk image &amp; a memory dump. The Description tell us that the user encrypted his disk and forgot the password! So we can understand that the memory dump will help us to decrypt the disk to get the flag! right?? Let’s Check what we have !</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line Prompt</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ file *</span><br><span class=\"line\">forensic.img: LUKS encrypted file, ver 1 [aes, ecb, sha1] UUID: 61478c6d-b04e-4f1a-aff6-b4bb3a29cfbe</span><br><span class=\"line\">memory.raw:   data</span><br></pre></td></tr></table></figure>\n<p>As you see we have LUKS encrypted file version1! I will say it again! it’s verion 1!!!<br>\nOh wait what is LUKS??!</p>\n<p>LUKS or the Linux Unified Key Setup is a disk encryption specification created by Clemens Fruhwirth in 2004 and was originally intended for Linux.<br>\nWhile most disk encryption softwares implement different, incompatible, and undocumented formats, LUKS implements a platform-independent on-disk format for use in various tools. This not only faciliates compatibility and interoperability among different programs, but also assures that they all implement password management in a secure and documented manner. Per Wikipedia.</p>\n<p>Unlike most blogs say, you should stick with LUKS2 if you are applying it to your disk, since it provides an extra layer of security by storing the master key in the kernel directly. However LUKS1 masterkey gets loaded in the RAM when you try to unlock it, and that what we are going to grab from the memory dump!</p>\n<p>The encrypted master key is stored as plaintext in the LUKS header. However once we mount it and get prompted to enter a passphrase, at least one of eight (LUKS support up to 8 passphrases), the decrypted master key (AES) is loaded into the memory.</p>\n<p><img data-src=\"https://i.imgur.com/GOTSIPB.png\" alt=\"\"><br>\n<em>Image courtesy: MDPI</em></p>\n<p>When we tried to use <span class=\"exturl\" data-url=\"aHR0cDovL1ZvbGF0aWxpdHkucHk=\">Volatility.py</span> against the memory dump we had some troubles finding the right profile.</p>\n<p>We are sure that this memory image is linux one, because we have LUKS. Let’s figure out what is the distrubition and the version to search or make our volatility profile to work with!</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line Prompt</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ strings memory.ram | grep <span class=\"string\">&quot;Linux version&quot;</span></span><br><span class=\"line\">Linux version 4.4.0-72-lowlatency (buildd@lcy01-17) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.4) ) <span class=\"comment\">#93-Ubuntu SMP PREEMPT Fri Mar 31 15:25:21 UTC 2017 (Ubuntu 4.4.0-72.93-lowlatency 4.4.49)</span></span><br></pre></td></tr></table></figure>\n<p>Oh it’s <span class=\"pinky\">Ubuntu 16.04.4</span> with low-latency kernel! oh wait what? what did you mean by low-latency kernel?<br>\nAs I know there is various type of linux kernel like Real-tim kernel, generic kernel, Low-latency kernel<br>\nThis types of kernel varies in the type of the scheduler and their algorithm, as well as the system interuption… etc! None is better than the other! Each one has its use case.</p>\n<p>For example the low-latency one can reduce audio latency and the context switches are more frequent. This type of kernel has a scheduler that is not suitable for a server environment! But it will be good for a professional audio or video editing!</p>\n<p>Ok now i guess you get it ! It’s time to make our profile! In this demo we will make a volatility profile with low-latency kernel using docker container. It’s better than downloading a whole VM! Don’t waste time in that!</p>\n<p>Let’s download volatiltiy man</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line Prompt</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ git <span class=\"built_in\">clone</span> https://github.com/volatilityfoundation/volatility</span><br><span class=\"line\">Cloning into <span class=\"string\">&#x27;volatility&#x27;</span>...</span><br><span class=\"line\">remote: Enumerating objects: 27411, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Cceiving objects:   7% (1919/27411), 340.01 KiB | 652.00 KiB/s</span><br></pre></td></tr></table></figure>\n<p>In Volatility repository there is  <code>/tools/linux</code>  directory that contains tools that allow us to make a linux profile. In this directory there is a file called <span class=\"pinky\">Makefile</span> that contains important information ! Let’s check it!</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line Prompt</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~volatility/tools/linux/$ <span class=\"built_in\">cat</span> Makefile</span><br><span class=\"line\">obj-m += module.o</span><br><span class=\"line\">KDIR ?= /</span><br><span class=\"line\">KVER ?= $(shell <span class=\"built_in\">uname</span> -r)</span><br><span class=\"line\"></span><br><span class=\"line\">-include version.mk</span><br><span class=\"line\"></span><br><span class=\"line\">all: dwarf</span><br><span class=\"line\"></span><br><span class=\"line\">dwarf: module.c</span><br><span class=\"line\">        $(MAKE) -C $(KDIR)/lib/modules/$(KVER)/build CONFIG_DEBUG_INFO=y M=<span class=\"string\">&quot;<span class=\"subst\">$(PWD)</span>&quot;</span> modules</span><br><span class=\"line\">        dwarfdump -di module.ko &gt; module.dwarf</span><br><span class=\"line\">        $(MAKE) -C $(KDIR)/lib/modules/$(KVER)/build M=<span class=\"string\">&quot;<span class=\"subst\">$(PWD)</span>&quot;</span> clean</span><br><span class=\"line\"></span><br><span class=\"line\">clean:</span><br><span class=\"line\">        $(MAKE) -C $(KDIR)/lib/modules/$(KVER)/build M=<span class=\"string\">&quot;<span class=\"subst\">$(PWD)</span>&quot;</span> clean</span><br><span class=\"line\">        <span class=\"built_in\">rm</span> -f module.dwarf</span><br></pre></td></tr></table></figure>\n<p>Look at the  <code>KVER</code>  variable , it contains your current kernel version! it’s an automatic kernel detection! in our case we will change it with the version of kernel that we will use it! Check the Linux Version from the output of the last strings command that we runed on the memory dump.<br>\nchange  <code>$(shell uname -r)</code>  with  <code>4.4.0-72-lowlatency</code> . Do it manually or use the magic of  <code>sed</code>  command</p>\n<figure class=\"highlight bash\"><figcaption><span>Sed Magic</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~volatility/tools/linux/$ sed -i <span class=\"string\">&#x27;s/$(shell uname -r)/4.4.0-72-lowlatency/g&#x27;</span> Makefile</span><br></pre></td></tr></table></figure>\n<p>Now it’s time to run a <span class=\"pinky\">Ubuntu 16.04.4</span> docker container and mount the current direcotry that contains the tools to build the profile. We can use the variable environment $PWD to indicate the current path easly. Don’t waste your time writing the whole path man !</p>\n<figure class=\"highlight bash\"><figcaption><span>Command Line Prompt</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -it --<span class=\"built_in\">rm</span> -v <span class=\"variable\">$PWD</span>:/volatility ubuntu:16.04 /bin/bash</span><br><span class=\"line\">Unable to find image <span class=\"string\">&#x27;ubuntu:16.04&#x27;</span> locally</span><br><span class=\"line\">16.04: Pulling from library/ubuntu</span><br><span class=\"line\">58690f9b18fc: Downloading [=========&gt;                                         ]  8.522MB/46.5MB</span><br><span class=\"line\">b51569e7c507: Download complete</span><br><span class=\"line\">da8ef40b9eca: Download complete</span><br></pre></td></tr></table></figure>\n<p>Just wait until the container is pulled &amp; get your bash !</p>\n<figure class=\"highlight bash\"><figcaption><span>The ubuntu container is ready</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Digest: sha256:91bd29a464fdabfcf44e29e1f2a5f213c6dfa750b6290e40dd6998ac79da3c41</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> ubuntu:16.04</span><br><span class=\"line\">root@507b1a4007ff:/<span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p>Since our ubuntu container is ready to use. Let’s install the low-latency kernel and the essentials packages for building the profile.</p>\n<figure class=\"highlight bash\"><figcaption><span>Install our packages</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@507b1a4007ff:/<span class=\"comment\"># apt update &amp;&amp; apt install -y linux-image-4.4.0-72-lowlatency linux-headers-4.4.0-72-lowlatency build-essential dwarfdump make zip</span></span><br><span class=\"line\">Get:1 http://security.ubuntu.com/ubuntu xenial-security InRelease [99.8 kB]</span><br><span class=\"line\">Get:2 http://archive.ubuntu.com/ubuntu xenial InRelease [247 kB]</span><br><span class=\"line\">Get:3 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [2051 kB]</span><br><span class=\"line\">Get:4 http://archive.ubuntu.com/ubuntu xenial-updates InRelease [99.8 kB]</span><br><span class=\"line\">Get:5 http://archive.ubuntu.com/ubuntu xenial-backports InRelease [97.4 kB]</span><br><span class=\"line\">Get:6 http://archive.ubuntu.com/ubuntu xenial/main amd64 Packages [1558 kB]</span><br><span class=\"line\">Get:7 http://security.ubuntu.com/ubuntu xenial-security/restricted amd64 Packages [15.9 kB]</span><br></pre></td></tr></table></figure>\n<p>Ah man you’ll wait again until the installation is done! After the installation is finished let’s check our volatility tools inside the container then make the profile !</p>\n<figure class=\"highlight bash\"><figcaption><span>Make The profile</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@507b1a4007ff:/<span class=\"comment\"># ls</span></span><br><span class=\"line\">bin   dev  home        lib    media  opt   root  sbin  sys  usr  vmlinuz</span><br><span class=\"line\">boot  etc  initrd.img  lib64  mnt    proc  run   srv   tmp  var  volatility</span><br><span class=\"line\"></span><br><span class=\"line\">root@507b1a4007ff:/<span class=\"comment\"># cd volatility/</span></span><br><span class=\"line\"></span><br><span class=\"line\">root@507b1a4007ff:/volatility<span class=\"comment\"># ls</span></span><br><span class=\"line\">Makefile  Makefile.enterprise  kcore  module.c</span><br><span class=\"line\"></span><br><span class=\"line\">root@507b1a4007ff:/volatility<span class=\"comment\"># make</span></span><br><span class=\"line\">make -C //lib/modules/4.4.0-72-lowlatency/build CONFIG_DEBUG_INFO=y M=<span class=\"string\">&quot;/volatility&quot;</span> modules</span><br><span class=\"line\">make[1]: Entering directory <span class=\"string\">&#x27;/usr/src/linux-headers-4.4.0-72-lowlatency&#x27;</span></span><br><span class=\"line\">  CC [M]  /volatility/module.o</span><br><span class=\"line\">  Building modules, stage 2.</span><br><span class=\"line\">  MODPOST 1 modules</span><br><span class=\"line\">  CC      /volatility/module.mod.o</span><br><span class=\"line\">  LD [M]  /volatility/module.ko</span><br><span class=\"line\">make[1]: Leaving directory <span class=\"string\">&#x27;/usr/src/linux-headers-4.4.0-72-lowlatency&#x27;</span></span><br><span class=\"line\">dwarfdump -di module.ko &gt; module.dwarf</span><br><span class=\"line\">make -C //lib/modules/4.4.0-72-lowlatency/build M=<span class=\"string\">&quot;/volatility&quot;</span> clean</span><br><span class=\"line\">make[1]: Entering directory <span class=\"string\">&#x27;/usr/src/linux-headers-4.4.0-72-lowlatency&#x27;</span></span><br><span class=\"line\">  CLEAN   /volatility/.tmp_versions</span><br><span class=\"line\">  CLEAN   /volatility/Module.symvers</span><br><span class=\"line\">make[1]: Leaving directory <span class=\"string\">&#x27;/usr/src/linux-headers-4.4.0-72-lowlatency&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>Now let’s zip the result of the make command (module.dwarf) and the system map file from the  <code>/boot</code>  :</p>\n<ul>\n<li>\n<p>The system map file contains the Symbols that will be used by volatility to run the plugin correctly. It list function entry points and addresses of kernel data structures of a particular build of a kernel!</p>\n</li>\n<li>\n<p>The  <code>module.dwarf</code>  contains the  <code>vtypes</code>  of this kernel module! To make we can call  <code>vtypes</code>  as the kernel’s data structures. To make it more easy  <code>vtypes</code>  is a small library to define  <code>Validating Types</code>  that will be used by the kernel !</p>\n</li>\n</ul>\n<p>Why we zip the  <code>module.dwarf</code>  and the  <code>System.map</code>  file? It’s simple man! These two files represent the whole profile that will be used by volatility! Volatility requires these 2 files to be in zip to deal with it as profile! Wow man, our profile is coming!</p>\n<p>zip Ubuntu1604.zip module.dwarf /boot/System.map-4.4.0-72-lowlatency</p>\n<figure class=\"highlight bash\"><figcaption><span>Zip the 2 files</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@507b1a4007ff:/volatility<span class=\"comment\"># zip Ubuntu1604-low.zip module.dwarf /boot/System.map-4.4.0-72-lowlatency</span></span><br><span class=\"line\">  adding: module.dwarf (deflated 89%)</span><br><span class=\"line\">  adding: boot/System.map-4.4.0-72-lowlatency (deflated 79%)</span><br></pre></td></tr></table></figure>\n<p>Now just leave our ubuntu container. we finished the 1st step of the challenge and you learn how to make a cool &amp; custom linux profile! Now you can copy this zip file to  <code>/plugins/overlays/linux/</code>  directory in your volatility environment.</p>\n<p>Sanity Check please ! Let’s list all the ubuntu profiles available!</p>\n<figure class=\"highlight bash\"><figcaption><span>check the availability of the profile</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ vol.py --info | grep -i ubuntu </span><br><span class=\"line\">Volatility Foundation Volatility Framework 2.6.1</span><br><span class=\"line\">LinuxUbuntu1604-lowx64     - A Profile <span class=\"keyword\">for</span> Linux Ubuntu1604-low x64</span><br></pre></td></tr></table></figure>\n<p>Cool! we found our new profile recognized by volatility ! Now it’s time to try use it.</p>\n<figure class=\"highlight bash\"><figcaption><span>Test the new profile</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ vol.py -f memory.raw --profile=LinuxUbuntu1604-lowx64 linux_banner    </span><br><span class=\"line\">Volatility Foundation Volatility Framework 2.6.1</span><br><span class=\"line\">Linux version 4.4.0-72-lowlatency (buildd@lcy01-17) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.4) ) <span class=\"comment\">#93-Ubuntu SMP PREEMPT Fri Mar 31 15:25:21 UTC 2017 (Ubuntu 4.4.0-72.93-lowlatency 4.4.49)</span></span><br></pre></td></tr></table></figure>\n<p>Bingo!! Our profile is ready to work! Let’s start the investigation now<br>\nI started checking the bash history!</p>\n<figure class=\"highlight bash\"><figcaption><span>Bash History</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vol.py -f memory.raw --profile=LinuxUbuntu1604-lowx64 linux_bash        </span><br><span class=\"line\">Volatility Foundation Volatility Framework 2.6.1</span><br><span class=\"line\">Pid      Name       Command Time             Command</span><br><span class=\"line\">-------- ---------- -----------------------  -------</span><br><span class=\"line\">    1229 bash       2017-04-14 07:58:36 UTC  <span class=\"built_in\">history</span></span><br><span class=\"line\">    1229 bash       2017-04-14 07:58:36 UTC  apt-get install linux-image-4.4.0-72-lowlatency linux-headers-lowlatency</span><br><span class=\"line\">    1229 bash       2017-04-14 07:58:36 UTC  reboot</span><br><span class=\"line\">    1229 bash       2017-04-14 07:58:36 UTC  apt-get insta</span><br><span class=\"line\">    1229 bash       2017-04-14 07:59:07 UTC  <span class=\"built_in\">history</span></span><br><span class=\"line\">    1229 bash       2017-05-05 12:04:44 UTC  apt-get install lynx gnupg</span><br><span class=\"line\">    1229 bash       2017-05-05 12:06:54 UTC  nano /etc/fstab</span><br><span class=\"line\">    1229 bash       2017-05-05 12:06:58 UTC  nano /etc/crypttab</span><br><span class=\"line\">    1229 bash       2017-05-05 12:07:08 UTC  <span class=\"built_in\">cd</span> /mnt/</span><br><span class=\"line\">    1229 bash       2017-05-05 12:07:29 UTC  <span class=\"built_in\">cp</span> -R /media/sf_DUMP/dir* .</span><br><span class=\"line\">    1229 bash       2017-05-05 12:07:38 UTC  ping 8.8.8.8</span><br><span class=\"line\">    1229 bash       2017-05-05 12:09:14 UTC  gpg --quick-gen-key <span class=\"string\">&#x27;Troll &lt;abuse@nothere.com&gt;&#x27;</span> rsa4096 cert 1y</span><br><span class=\"line\">    1229 bash       2017-05-05 12:09:49 UTC  lynx -accept_all_cookies <span class=\"string\">&quot;https://www.google.com/?=password+porno+collection&quot;</span></span><br><span class=\"line\">    1229 bash       2017-05-05 12:10:27 UTC  gpg --<span class=\"built_in\">yes</span> --batch --passphrase=1m_4n_4dul7_n0w -c findme.txt</span><br><span class=\"line\">    1229 bash       2017-05-05 12:10:37 UTC  lynx -accept_all_cookies <span class=\"string\">&quot;https://www.google.com/?=password+troll+memes&quot;</span></span><br><span class=\"line\">    1229 bash       2017-05-05 12:11:04 UTC  gpg --<span class=\"built_in\">yes</span> --batch --passphrase=Troll_Tr0ll_TrOll -c end.zip</span><br><span class=\"line\">    1229 bash       2017-05-05 12:11:20 UTC  nano dir1/dic_fr_l33t.txt</span><br><span class=\"line\">    1229 bash       2017-05-05 12:11:28 UTC  <span class=\"built_in\">rm</span> findme.txt</span><br><span class=\"line\">    1229 bash       2017-05-05 12:11:35 UTC  <span class=\"built_in\">rm</span> -rf dir1/</span><br><span class=\"line\">    1229 bash       2017-05-05 12:11:55 UTC  <span class=\"built_in\">dd</span> <span class=\"keyword\">if</span>=/dev/sdb of=/media/sf_DUMP/forensic.img bs=2048</span><br></pre></td></tr></table></figure>\n<p>Let’s analyse this history together to understand what is going on here!</p>\n<ul>\n<li>The user install low-latency kernel</li>\n<li>install lynx : a terminal-based web browser for all Linux distributions</li>\n<li>edit the /etc/fstab.</li>\n<li>edit /etc/crypttab</li>\n<li>copy the directories from media (it can be a flash) partition to  <code>/mnt/</code></li>\n<li>Check the connectivity by pinging the DNS server of google (I used to do the same test :3)</li>\n<li>generate a key with gpg using rsa4096. Something will be encrypted in the next commands! I am sure</li>\n<li>use lynx to search for porno password collection! mmm He want a premium account</li>\n<li>Encrypt  <code>findme.txt</code>  file using gpg !! This will generate an encrypted file  <code>findme.txt.gpg</code></li>\n<li>Search for troll password!</li>\n<li>Encrypt  <code>end.zip</code>  with gpg again! We have  <code>end.zip.gpg</code> , another encrypted file!</li>\n<li>edit a file text called  <code>dic_fr_l33t.txt</code></li>\n<li>remove  <code>findme.txt</code> . I guess we need to recover this file !</li>\n<li>remove the directory that contains the  <code>dic_fr_l33t.txt</code>  file</li>\n</ul>\n<blockquote>\n<p>/etc/fstab: is a configuration table designed to ease the burden of mounting and unmounting file systems to a machine. It is a set of rules used to control how different filesystems are treated each time they are introduced to a system</p>\n</blockquote>\n<blockquote>\n<p>The /etc/crypttab (encrypted device table) file is similar to the fstab file and contains a list of encrypted devices to be unlocked during system boot up. This file can be used for automatically mounting encrypted swap devices or secondary file systems.</p>\n</blockquote>\n<p>Ok the encrypted disk contains a  <code>end.zip.gpg</code>  and  <code>findme.text.gpg</code> . These 2 files are the key of the task! The flag is on these files! So we need to decrypt to disk and mount it!</p>\n<h2 id=\"decrypt-disk-and-mount-it\"><a class=\"markdownIt-Anchor\" href=\"#decrypt-disk-and-mount-it\">#</a> Decrypt Disk and MOUNT IT</h2>\n<p>Dealing with the disk we require  <code>cryptsetup</code>  --a tool to manage plain dm-crypt and LUKS encrypted volumes, to install it, use  <code>sudo apt install cryptsetup-bin</code> .</p>\n<p>Analyzing the disk image to understand what we need to next!</p>\n<p>command  <code>cryptsetup luksDump forensic.img</code>  will return some useful LUKS information:</p>\n<figure class=\"highlight bash\"><figcaption><span>LUKS INFO</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LUKS header information <span class=\"keyword\">for</span> forensic.img</span><br><span class=\"line\"></span><br><span class=\"line\">Version:        1</span><br><span class=\"line\">Cipher name:    aes</span><br><span class=\"line\">Cipher mode:    ecb</span><br><span class=\"line\">Hash spec:      sha1</span><br><span class=\"line\">Payload offset: 2048</span><br><span class=\"line\">MK bits:        128</span><br><span class=\"line\">MK digest:      a0 0c 4d c4 4a 53 5c 00 0c c3 33 63 13 5b 2c 41 8e a3 3f a9</span><br><span class=\"line\">MK salt:        5e 84 10 01 a8 19 06 22 6a 7b 1b <span class=\"built_in\">df</span> 35 73 46 8e</span><br><span class=\"line\">                0e 7e f4 68 b0 97 38 81 cf 6d 99 7c 22 82 bd 06</span><br><span class=\"line\">MK iterations:  117625</span><br><span class=\"line\">UUID:           61478c6d-b04e-4f1a-aff6-b4bb3a29cfbe</span><br><span class=\"line\"></span><br><span class=\"line\">Key Slot 0: ENABLED</span><br><span class=\"line\">        Iterations:             507935</span><br><span class=\"line\">        Salt:                   68 5e 9a ef 39 26 3a 09 3a a2 57 fa b8 a4 d9 6b</span><br><span class=\"line\">                                65 81 49 63 d7 43 41 2a 0e 0a <span class=\"built_in\">cd</span> cb d7 94 ac 01</span><br><span class=\"line\">        Key material offset:    8</span><br><span class=\"line\">        AF stripes:             4000</span><br><span class=\"line\">Key Slot 1: DISABLED</span><br><span class=\"line\">Key Slot 2: DISABLED</span><br><span class=\"line\">Key Slot 3: DISABLED</span><br><span class=\"line\">Key Slot 4: DISABLED</span><br><span class=\"line\">Key Slot 5: DISABLED</span><br><span class=\"line\">Key Slot 6: DISABLED</span><br><span class=\"line\">Key Slot 7: DISABLED</span><br></pre></td></tr></table></figure>\n<p>It is clear as day that once we have the master key --the one used to control the disk the way we want, we can add a key slot/passphrase.</p>\n<p>As said in the introduction, the master key must be loaded into the RAM, we know it is AES, so using  <code>findaes</code>  tool <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb3VyY2Vmb3JnZS5uZXQvcHJvamVjdHMvZmluZGFlcy8=\">here</span></p>\n<p>Then, extract the downloaded zip file<br>\n <code>unzip findaes*.zip</code> <br>\nCompile it<br>\n <code>cd findaes* ; make</code> <br>\nAnd run it against the memory dump<br>\n <code>./findaes memory.raw</code> <br>\nAnd you get this!</p>\n<figure class=\"highlight bash\"><figcaption><span>AES Finally !</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Found AES-128 key schedule at offset 0xad9f450:</span><br><span class=\"line\">8d 3f 52 7d e5 14 87 2f 59 59 08 95 8d bc 0e d1</span><br></pre></td></tr></table></figure>\n<p>Going further is a routinuous disk encryption operation, with the masterkey in hand, we can generate a new passphrase say  <code>1234</code>  or  <code>p@ssw0rd</code>  for us to access the content.</p>\n<figure class=\"highlight bash\"><figcaption><span>MasterKey !</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"string\">&quot;8d 3f 52 7d e5 14 87 2f 59 59 08 95 8d bc 0e d1&quot;</span> | <span class=\"built_in\">tr</span> -d <span class=\"string\">&quot; &quot;</span> | xxd -r -p  &gt; masterkey.key</span><br><span class=\"line\"></span><br><span class=\"line\">cryptsetup luksAddKey --master-key-file=masterkey.key forensic.img                               </span><br><span class=\"line\">Enter new passphrase <span class=\"keyword\">for</span> key slot:</span><br><span class=\"line\">Verify passphrase:</span><br></pre></td></tr></table></figure>\n<p>Let’s see if it is now placed as Key Slot 1!</p>\n<figure class=\"highlight bash\"><figcaption><span>LUKS</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cryptsetup luksDump forensic.img | grep Key.Slot</span><br><span class=\"line\">Key Slot 0: ENABLED</span><br><span class=\"line\">Key Slot 1: ENABLED</span><br><span class=\"line\">Key Slot 2: DISABLED</span><br><span class=\"line\">Key Slot 3: DISABLED</span><br><span class=\"line\">Key Slot 4: DISABLED</span><br><span class=\"line\">Key Slot 5: DISABLED</span><br><span class=\"line\">Key Slot 6: DISABLED</span><br><span class=\"line\">Key Slot 7: DISABLED</span><br></pre></td></tr></table></figure>\n<p>All good!<br>\nNow, we mount it!</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cryptosetup luksOpen forensic.img mydata</span><br><span class=\"line\">Enter passphrase for forensic.img: </span><br><span class=\"line\">mkdir ~/csaw</span><br><span class=\"line\">sudo mount /dev/mapper/mydata ~/csaw</span><br></pre></td></tr></table></figure>\n<p>Just fill in your new passphrase in the previous step, and you’ll have it!</p>\n<p>If you got some permission concern while trying to access the mount point, just switch to root!</p>\n<p>After decrypting the disk and mounting it! We find 2 directories!  <code>dir2</code>  and  <code>lost+found</code> . OK I can say skip &amp; ignore  <code>lost+found</code>  directory. The  <code>dir2</code>  is our target. Let’s get our flag man!</p>\n<figure class=\"highlight bash\"><figcaption><span>test</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ <span class=\"built_in\">ls</span> </span><br><span class=\"line\">end.png    findme.txt.gpg      readme.txt</span><br></pre></td></tr></table></figure>\n<p>Let’s check the readme.txt first, Just i am trying to be patient before attacking the  <code>findme.txt.gpg</code></p>\n<figure class=\"highlight bash\"><figcaption><span>Check readme</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ <span class=\"built_in\">cat</span> readme.txt</span><br><span class=\"line\">Do you know GPG? So just <span class=\"keyword\">do</span> it to decipher!!!</span><br></pre></td></tr></table></figure>\n<p>Ah man! We know that! We need to decrypt the gpg files. But wait! where is the  <code>end.zip.gpg</code>  file!<br>\nOk it’s not important for me! I guess  <code>findme.txt.gpg</code>  is the flag! Let’s decipher it with  <code>gpg</code>  command line utility. Of course we will use  <code>1m_4n_4dul7_n0w</code>  password!</p>\n<figure class=\"highlight bash\"><figcaption><span>test</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ gpg --output findme.txt --decrypt findme.txt.gpg <span class=\"comment\"># it will ask you for a password</span></span><br><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ <span class=\"built_in\">cat</span> findme.txt</span><br><span class=\"line\">The flag is not here of course !!!</span><br><span class=\"line\">You must find it :-)</span><br><span class=\"line\">Troll one day troll always ........</span><br></pre></td></tr></table></figure>\n<p>Ah man ! I don’t find the flag! OK still the  <code>end.zip.gpg</code> ! Let’s find this, i guess it’s hiding in  <code>end.png</code>  image</p>\n<figure class=\"highlight bash\"><figcaption><span>Investigate end.png</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ sudo binwalk end.png </span><br><span class=\"line\"></span><br><span class=\"line\">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class=\"line\">--------------------------------------------------------------------------------</span><br><span class=\"line\">0             0x0             PNG image, 850 x 300, 8-bit/color RGB, non-interlaced</span><br><span class=\"line\">320           0x140           Zlib compressed data, best compression</span><br><span class=\"line\">917           0x395           Zlib compressed data, best compression</span><br><span class=\"line\">493886        0x7893E         Zip archive data, at least v2.0 to extract, compressed size: 61917, uncompressed size: 61907, name: end.zip.gpg</span><br><span class=\"line\">555953        0x87BB1         End of Zip archive, footer length: 22</span><br></pre></td></tr></table></figure>\n<p>Finally we found it, let’s use  <code>foremost</code>  command to extract our target !</p>\n<figure class=\"highlight bash\"><figcaption><span>Investigate end.png</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ foremost end.png   </span><br><span class=\"line\">Processing: end.png</span><br><span class=\"line\">|foundat=end.zip.gpgUT</span><br><span class=\"line\">*|</span><br></pre></td></tr></table></figure>\n<p>A new directory called  <code>output</code>  is created and it contains the extracted files from  <code>end.png</code>  using</p>\n<figure class=\"highlight bash\"><figcaption><span>Investigate end.png</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ tree output</span><br><span class=\"line\">output</span><br><span class=\"line\">├── audit.txt</span><br><span class=\"line\">├── png</span><br><span class=\"line\">│   └── 00000000.png</span><br><span class=\"line\">└── zip</span><br><span class=\"line\">    └── 00000964.zip</span><br><span class=\"line\"></span><br><span class=\"line\">2 directories, 3 files</span><br></pre></td></tr></table></figure>\n<p>OK let’s unzip the  <code>00000964.zip</code>  file and decipher the  <code>end.zip.gpg</code>  file using  <code>Troll_Tr0ll_TrOll</code>  password and get our flag</p>\n<figure class=\"highlight bash\"><figcaption><span>Investigate end.png</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ unzip output/zip/00000964.zip </span><br><span class=\"line\">Archive:  output/zip/00000964.zip</span><br><span class=\"line\">  inflating: end.zip.gpg</span><br><span class=\"line\">4n6nk8s@csaw2022:~/csaw/dir2$ gpg --output end.zip --decrypt end.zip.gpg</span><br></pre></td></tr></table></figure>\n<p>Ah finally there is a flag.gif file in end.zip file but wait!! the zip file is protected!</p>\n<p>We’ve noticed that the encryption is ZipCrypto Deflate which is similar to the other chall, crackable by just knowing 12 bytes of whats inside the zip, 8 of which must be contiguous.<br>\nWe’ve went ahead, used the header of a GIF file, and digging more into the GIF file structure, we’ve came to know that in most of the GIF files there is a constant text ‘NETSCAPE’ at the hexadecimal offset 0x310 which fulfills our needs, 8 bytes contiguous plus the header, we’ve got more than 12 bytes.</p>\n<p>The header is just  <code>GIF89a</code>  at offset 0x0.</p>\n<p><img data-src=\"https://i.imgur.com/RH9goSf.png\" alt=\"\"></p>\n<p>You can get bkcrack from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2tpbWNpODYvYmtjcmFjaw==\">here</span></p>\n<p>-C to specify the ciphered zip, -c for the target file -x to specify known bytes at some offset and -d to get the deciphered data once the process is done, and keys were found!</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bkcrack -C end.zip -c flag.gif -x 0 474946383961 -x 0x310 4E4554534415045322E30 -d deciphered</span><br></pre></td></tr></table></figure>\n<p>Unfortunately, it ended with  <code>Could Not find the keys.</code></p>\n<p>However we were not lucky to crack the zip open using bkcrack again.</p>\n<p>Don’t worry dude! we have rockyou and john! Let’s give bruteforcing a chance. We can extract the password hash with  <code>zip2john</code>  command!</p>\n<figure class=\"highlight bash\"><figcaption><span>Extract the hash of the password</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/mnt/dir2$ zip2john end.zip &gt; zip.hash  </span><br><span class=\"line\">ver 2.0 efh 5455 efh 7875 end.zip/flag.gif PKZIP Encr: TS_chk, cmplen=61563, decmplen=90082, crc=18A1C7A3 ts=8050 cs=8050 <span class=\"built_in\">type</span>=8</span><br></pre></td></tr></table></figure>\n<p>Now it’s time to bruteforce the hash with rockyou!</p>\n<figure class=\"highlight bash\"><figcaption><span>Extract the hash of the password</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~/mnt/dir2$ john --wordlist=<span class=\"variable\">$rockyou</span> zip.hash</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password <span class=\"built_in\">hash</span> (PKZIP [32/64])</span><br><span class=\"line\">No password hashes left to crack (see FAQ)</span><br></pre></td></tr></table></figure>\n<p>Wait what??? The password wasn’t found on rockyou! What the hack?? After some investigating we remember that there is a text file called  <code>dic_fr_l33t.txt</code> ! dic means dictionary and fr means french right ? Oh man we need to recover this wordlist! But the user deleted it. I’ll give a chance to  <code>linux_find_file</code> . Let’s try to dump this text file. It might be stil loaded in the memory right?</p>\n<figure class=\"highlight bash\"><figcaption><span>Extract the hash of the password</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ vol.py -f memory.raw --profile=LinuxUbuntu1604-lowx64 linux_find_file -L | grep dic_fr</span><br><span class=\"line\">Volatility Foundation Volatility Framework 2.6.1</span><br><span class=\"line\">3 0xffff88000c135cd8 /media/sf_DUMP/dir1/dic_fr_l33t.txt</span><br><span class=\"line\">vol.py -f memory.raw --profile=LinuxUbuntu1604-lowx64 linux_find_file -i 0xffff88000c135cd8 -O dic_fr_l33t.txt</span><br><span class=\"line\">Volatility Foundation Volatility Framework 2.6.1</span><br></pre></td></tr></table></figure>\n<p>Ah God! The extracted file is empty. We need another way to recover the wordlist and with an elegent way<br>\nAfter some minutes of thinking. We decide to use a regex that allow us to collect words that not contains special chars like  <code>&#123;_;&#125;/][-</code></p>\n<figure class=\"highlight bash\"><figcaption><span>Extract the hash of the password</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ strings memory.raw | grep -v <span class=\"string\">&quot; \\|\\_\\|\\-\\|\\[\\|\\]\\|\\`\\|\\;\\|\\/\\|\\.\\|\\&#125;\\|\\&#123;&quot;</span> | <span class=\"built_in\">sort</span> | <span class=\"built_in\">uniq</span> | <span class=\"built_in\">sort</span> &gt; myrock.txt</span><br><span class=\"line\">4n6nk8s@csaw2022:~/mnt/dir2$ sudo john --wordlist=~/myrock.txt zip.hash</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password <span class=\"built_in\">hash</span> (PKZIP [32/64])</span><br><span class=\"line\">Will run 8 OpenMP threads</span><br><span class=\"line\">Press <span class=\"string\">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class=\"keyword\">for</span> status</span><br><span class=\"line\">Cyb3rs3curit3    (end.zip/flag.gif)</span><br><span class=\"line\">1g 0:00:00:00 DONE (2022-09-12 20:34) 6.666g/s 655360p/s 655360c/s 655360C/s Coup3ri3z..D3fouraillions</span><br><span class=\"line\">Use the <span class=\"string\">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class=\"line\">Session completed.</span><br></pre></td></tr></table></figure>\n<p>Oh man we did it! The password of the protected  <code>end.zip</code>  is  <code>Cyb3rs3curit3</code>  (CyberSecurité).Let’s extract the  <code>flag.gif</code>  file now…</p>\n<p><img data-src=\"https://imgur.com/jZoDJhE.gif\" alt=\"\"><br>\nLet’s convert this gif to frames using  <code>ffmpeg</code>  utility, the magical one xD</p>\n<figure class=\"highlight bash\"><figcaption><span>Split the gif</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ <span class=\"built_in\">mkdir</span> temp ; ffmpeg -i /mnt/dir2/flag.gif -vsync 0 temp/temp%d.png</span><br><span class=\"line\">Input <span class=\"comment\">#0, gif, from &#x27;flag.gif&#x27;:</span></span><br><span class=\"line\">  Duration: 00:00:03.60, start: 0.000000, bitrate: 200 kb/s</span><br><span class=\"line\">  Stream <span class=\"comment\">#0:0: Video: gif, bgra, 290x290, 10 fps, 10 tbr, 100 tbn</span></span><br><span class=\"line\">Stream mapping:</span><br><span class=\"line\">  Stream <span class=\"comment\">#0:0 -&gt; #0:0 (gif (native) -&gt; png (native))</span></span><br><span class=\"line\">Press [q] to stop, [?] <span class=\"keyword\">for</span> <span class=\"built_in\">help</span></span><br><span class=\"line\">Output <span class=\"comment\">#0, image2, to &#x27;temp/temp%d.png&#x27;:</span></span><br><span class=\"line\">  Metadata:</span><br><span class=\"line\">    encoder         : Lavf59.27.100</span><br><span class=\"line\">  Stream <span class=\"comment\">#0:0: Video: png, rgba(pc, gbr/unknown/unknown, progressive), 290x290, q=2-31, 200 kb/s, 10 fps, 10 tbn</span></span><br><span class=\"line\">    Metadata:</span><br><span class=\"line\">      encoder         : Lavc59.37.100 png</span><br><span class=\"line\">frame=   36 fps=0.0 q=-0.0 Lsize=N/A time=00:00:03.60 bitrate=N/A speed=14.8x</span><br><span class=\"line\">video:113kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: unknown</span><br></pre></td></tr></table></figure>\n<p>We got this images! oh we have 36 QR Code images! Seriously i don’t want to scan it manually!<br>\n<img data-src=\"https://imgur.com/aFiEzTR.png\" alt=\"\"><br>\nLet’s Write a small code that reads all these QRcode images! I am too lazy man !</p>\n<figure class=\"highlight python\"><figcaption><span>Scan QRCode</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> cv2</span><br><span class=\"line\"></span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">36</span>):</span><br><span class=\"line\"></span><br><span class=\"line\">    img=cv2.imread(<span class=\"string\">&quot;temp&quot;</span>+<span class=\"built_in\">str</span>(i+<span class=\"number\">1</span>)+<span class=\"string\">&quot;.png&quot;</span>)</span><br><span class=\"line\">    det=cv2.QRCodeDetector()</span><br><span class=\"line\">    val, pts, st_code=det.detectAndDecode(img)</span><br><span class=\"line\">    flag+=val[::-<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br></pre></td></tr></table></figure>\n<p>Let’s run the code now ! I wish this nightmare finish dude! I don’t another step please</p>\n<figure class=\"highlight bash\"><figcaption><span>Run Reader</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4n6nk8s@csaw2022:~$ python3 temp/solve.py</span><br><span class=\"line\">The_flag_is:1_Lik3_F0r3nS1c_4nd_y0u?</span><br></pre></td></tr></table></figure>\n<p>And Finally we got the flag!</p>\n<h1 id=\"quantum-leap-misc\"><a class=\"markdownIt-Anchor\" href=\"#quantum-leap-misc\">#</a> Quantum Leap : Misc</h1>\n<details class=\"info\"><summary>Description</summary><div>\n<p>My friend took the quantum leap and purchased a quantum computer with two qubits. They mentioned using a quantum logic gate to input the flag and they gave me the computers output. I have been stuck and Can NOT figure out the flag.</p>\n</div></details>\n<p>Challenge Link &amp; WriteUp Author</p>\n<div class=\"links\"><div class=\"item\" title=\"Challenge Link\" style=\"--block-color:#2296fd;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JhbmlhTWlkYW91aS9DVEYtd3JpdGV1cHMvYmxvYi9tYWluL0NTQVcyMi9RdWFudHVtJTIwTGVhcC9vdXRwdXQudHh0\" data-background-image=\"https://ctftime.org/media/events/logo_48.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JhbmlhTWlkYW91aS9DVEYtd3JpdGV1cHMvYmxvYi9tYWluL0NTQVcyMi9RdWFudHVtJTIwTGVhcC9vdXRwdXQudHh0\">Challenge Link</span>\n          <p class=\"desc\">CSAW 2022 - Quantum Leap</p>\n          </div></div><div class=\"item\" title=\"Writeup Author - Mida0ui\" style=\"--block-color:#de2336;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL3JhbmlhLW1pZGFvdWktYjAxNjNhMWJiLw==\" data-background-image=\"https://media-exp1.licdn.com/dms/image/C4D03AQHOP8zn9x9nKw/profile-displayphoto-shrink_800_800/0/1643659005590?e=1668643200&v=beta&t=FV5YWMygs2bbclfvgFIUtPgjIedq8tGiKWxopxK2_yU\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL3JhbmlhLW1pZGFvdWktYjAxNjNhMWJiLw==\">Writeup Author - Mida0ui</span>\n          <p class=\"desc\">Mida0ui Linkedin Profile</p>\n          </div></div></div>\n<p>The description mentions that we’re dealing with a quantum computer with two qubits, se we can assume that the gate the person used to get the output is a two-qubit quantum logic gate.</p>\n<p>A quantum gate is basic quantum circuit operating on a small number of qubits, they perform operations to change the state of the qubits, and unlike many classical logic gates, quantum logic gates are reversible.<br>\nEach quantum gate has its matrix, and since the qubit states are represented with vectors, the gates transform these vectors to get new states.<br>\nThe state vectors of the states |0&gt; and |1&gt; are:</p>\n<p><img data-src=\"https://user-images.githubusercontent.com/68945305/190504993-8094b514-dfa2-472f-8622-59867ef2e061.png\" alt=\"2022-09-15_19h32_37\"></p>\n<p>The CNOT gate was applied, it’s a two-qubit quantum gate that performs a controlled NOT where one qubit is the control and the second qubit is the target.<br>\nIts matrix is the following :</p>\n<p><img data-src=\"https://user-images.githubusercontent.com/68945305/190486028-970479de-3ff1-415e-bdd2-b4f0e6c8dab2.png\" alt=\"2022-09-15_19h33_11\"></p>\n<p>When applied:</p>\n<p><img data-src=\"https://user-images.githubusercontent.com/68945305/190497970-bd14060b-e413-43b6-982a-17da2d1c18a5.png\" alt=\"2022-09-15_20h47_02\"></p>\n<p>The mathematics behind these results are simple:</p>\n<p>Lets take |10&gt; and |11&gt;:</p>\n<p><img data-src=\"https://user-images.githubusercontent.com/68945305/190505635-f998a0df-a328-4230-a3f1-1e3be73a5cef.png\" alt=\"2022-09-15_21h46_45\"></p>\n<p>This ⊗ represents a tensor product, you can read about it here if you don’t know what it is : <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWF0aDNtYS5jb20vYmxvZy90aGUtdGVuc29yLXByb2R1Y3QtZGVteXN0aWZpZWQ=\">https://www.math3ma.com/blog/the-tensor-product-demystified</span></p>\n<p>The first qubit is usually referred to as the control qubit and the second qubit as the target qubit. Expressed in basis states, the CNOT gate:<br>\nleaves the control qubit unchanged and performs a Pauli-X gate or NOT gate (which just flips the state of the qubit) on the target qubit when the control qubit is in state ∣1⟩;<br>\nleaves the target qubit unchanged when the control qubit is in state ∣0⟩.</p>\n<p>As you may have noticed, this challenge can be done manually by converting the output string to binary, taking two bits at a time and checking the value of the most significant bit, if it’s 1, the other bit is flipped, else, nothing is done.</p>\n<p>I wanted to solve this task with the CNOT gate itself,using the qiskit module in python.<br>\nQiskit is an open-source SDK for working with quantum computers at the level of pulses, circuits, and application modules.</p>\n<p>As mentioned before quantum logic gates are reversible, in this case, when CNOT gate is applied once on the output, we get the flag.</p>\n<p>Here’s the script, you can run it on jupyter notebook:</p>\n<figure class=\"highlight py\"><figcaption><span>Solver</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> qiskit <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">output = <span class=\"string\">&#x27;wxqvn$Zae$&#123;deyZv$d&quot;i&#x27;</span></span><br><span class=\"line\">output_array = <span class=\"string\">&#x27;&#x27;</span>.join(<span class=\"built_in\">format</span>(i, <span class=\"string\">&#x27;08b&#x27;</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">bytearray</span>(output, encoding =<span class=\"string\">&#x27;utf-8&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">bin_flag = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">state_vect</span>(<span class=\"params\">bit</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(bit == <span class=\"string\">&#x27;0&#x27;</span>):</span><br><span class=\"line\">        vect = [<span class=\"number\">1</span>, <span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">else</span> : </span><br><span class=\"line\">        vect = [<span class=\"number\">0</span> ,<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> vect</span><br><span class=\"line\"></span><br><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i&lt;<span class=\"built_in\">len</span>(output_array):</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">#Initialize the quantum circuit</span></span><br><span class=\"line\">    q = QuantumRegister(<span class=\"number\">2</span>, <span class=\"string\">&quot;q&quot;</span>)</span><br><span class=\"line\">    c = ClassicalRegister(<span class=\"number\">2</span>, <span class=\"string\">&quot;c&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    qc = QuantumCircuit(q,c)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#get the initial state from the output</span></span><br><span class=\"line\">    vect0 = state_vect(output_array[i])</span><br><span class=\"line\">    vect1 = state_vect(output_array[i+<span class=\"number\">1</span>])</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">#initialize the register</span></span><br><span class=\"line\">    qc.initialize(vect1,<span class=\"number\">0</span>)</span><br><span class=\"line\">    qc.initialize(vect0,<span class=\"number\">1</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    qc.measure(q, c)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#apply the CNOT gate, q[1] is the control and q[0] is the target</span></span><br><span class=\"line\">    qc.cx(q[<span class=\"number\">1</span>],q[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">    qc.measure(q, c)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">#execute the circuit</span></span><br><span class=\"line\">    qobj = assemble(qc, shots=<span class=\"number\">1</span>)</span><br><span class=\"line\">    job = execute(qc,Aer.get_backend(<span class=\"string\">&#x27;qasm_simulator&#x27;</span>),shots=<span class=\"number\">1</span>)</span><br><span class=\"line\">    counts = job.result().get_counts()</span><br><span class=\"line\">    </span><br><span class=\"line\">    bin_flag += <span class=\"built_in\">str</span>(counts)[<span class=\"number\">2</span>:<span class=\"number\">4</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">#Increment the counter to get the next 2 qubits</span></span><br><span class=\"line\">    i=i+<span class=\"number\">2</span></span><br><span class=\"line\">    </span><br><span class=\"line\">flag = <span class=\"string\">&#x27;&#x27;</span>.join(<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(bin_flag[i*<span class=\"number\">8</span>:i*<span class=\"number\">8</span>+<span class=\"number\">8</span>],<span class=\"number\">2</span>)) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(bin_flag)//<span class=\"number\">8</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br></pre></td></tr></table></figure>\n<p>The flag is  <code>flag&#123;4_qu4ntum_g4t3&#125;</code></p>\n",
            "tags": []
        }
    ]
}